import{d as Pe,t as m,y as Q,c as ee,z as oe,b as h,X as c,Z as k,$ as o,i as l,J as g,a5 as Ve,am as we,W as le,o as p,Y as f,a1 as w,h as y,e as I,ak as Ce,G as Ee,a2 as xe,a3 as Ne}from"./index-DEM1Q7ah.js";import{E as ke}from"./dialog-OvK7FIEd.js";/* empty css                */import{E as Ie}from"./col-CzLH8SeH.js";import{E as Ue}from"./scrollbar-CyicQk5x.js";import{a as Fe,E as qe}from"./form-item-BqEwLgzp.js";/* empty css              */import{E as Se}from"./input-number-QG4fmXOd.js";import{E as Be}from"./button-BhsazfUD.js";/* empty css                      */import"./popper-6cDUjaRW.js";import"./tag-BOE4AccX.js";import{E as Oe,a as Re}from"./select-DycYLwTT.js";/* empty css                    */import{E as De,a as $e}from"./radio-cDeAVAMw.js";import{E as Je}from"./image-viewer-1i1B0ni1.js";import{a as Ge}from"./index-Offk-8XA.js";import{h as Le,p as Te}from"./index-DtUjHqe3.js";import{_ as U}from"./rules-F8IXRWD9.js";import{E as ze}from"./index-rUWjPUE6.js";import{E as Ae,a as je,b as He}from"./index-AZNK1TTm.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-apjzc23w.js";import"./use-form-item-FEc-havy.js";import"./scroll-CzTDrJbU.js";import"./vnode-Bod1Q6cQ.js";import"./focus-trap-OSNMQz79.js";import"./refs-D-YtBsDp.js";import"./event-BB_Ol6Sd.js";import"./castArray-DHLwE7Nc.js";import"./_baseClone-CM4Uj5KP.js";import"./_initCloneObject-B0so-X2S.js";import"./index-DE7zMLpQ.js";import"./isEqual-Dnbp5P_R.js";const We=F=>(xe("data-v-11458f3d"),F=F(),Ne(),F),Xe={class:"booth-reserve"},Ye={class:"l"},Ze={class:"title"},Ke={class:"img-box"},Qe={class:"r"},eo={class:"form-box"},oo=We(()=>c("div",null,"预定展位",-1)),lo={key:1,style:{width:"270px","text-align":"center",padding:"10px"}},to={style:{"text-align":"center"}},ao={style:{padding:"15px"}},io={class:"dialog-footer"},no=Pe({__name:"Reserve",setup(F){const te=Ve(),v=we(),L=v.query.clueId,q=v.query.exhibitionId,T=v.query.exhibitorId,P=m(v.query.hallCode),B=m([]),E=m([]),z=m([]),A=m([]),j=m([]),O=m([]),H={1:"%",2:"￥"},t=Q({clueId:L,exhibitionId:q,exhibitorId:T,add:[],discount:[],position:[{hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let d=JSON.parse(v.query.data);t.clueId=d.clueId,t.exhibitionId=d.exhibitionId,t.exhibitorId=d.exhibitorId,t.position=d.position,t.add=d.add,t.discount=d.discount}m({});const R=m(null),a=Q({show:!1,index:0,selected:{},form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ae=d=>{let e=O.value.find(s=>s.text===d);a.form.unitPrice=Number(e.price),a.form.product=e.text,a.form.num=e.num},ie=ee(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),ne=(d,e,s)=>{e.length===""||a.form.width===""?s(new Error("请填写尺寸")):e.length<=0||a.form.width<=0?s(new Error("尺寸不可为0和负数")):s()},re=()=>{let d=t.position.length;D(P.value,d),t.position.push({hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},D=(d,e)=>{E.value[e]=[],Le({exhibitionId:q,hallCode:d}).then(s=>{E.value[e]=s.data})};D(P.value,0);const de=(d,e,s,i)=>{if(!e)return s(new Error("必填项"));Te({exhibitionId:q,exhibitorId:T,hallCode:i,positionCode:e}).then(_=>{_.code===0&&_.data.status?s():s(new Error("该展位已锁定"))})},$=m(null),ue=()=>{$.value.validate().then(d=>{d&&te.push({name:"BoothCreateOrder",query:{...v.query,companyName:S.value,data:JSON.stringify(t)}})}).catch(()=>{})},se=d=>{a.index=d,a.form.product="",a.form.unitPrice="",a.form.length="",a.form.width="",a.form.num=1,a.show=!0},pe=()=>{R.value.validate().then(d=>{if(!d)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=M(s),_=W(s);t.position[a.index].product=a.form.product,t.position[a.index].unitPrice=a.form.unitPrice,t.position[a.index].length=a.form.length,t.position[a.index].width=a.form.width,t.position[a.index].area=e,t.position[a.index].costPrice=Number(s.toFixed(2)),t.position[a.index].addPrice=Number(i.toFixed(2)),t.position[a.index].discountPrice=Number(_.toFixed(2)),t.position[a.index].finalPrice=Number((s+i-_).toFixed(2)),$.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},M=d=>{let e=0;return t.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=d*i.price/100:i.unit===2&&(e+=i.price)}),e},W=d=>{let e=0;return t.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=d*i.price/100:i.unit===2&&(e+=i.price)}),e};oe(()=>t.add,d=>{t.position.forEach(e=>{e.addPrice=Number(M(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),oe(()=>t.discount,d=>{t.position.forEach(e=>{e.discountPrice=Number(W(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const S=m(""),J=m(!0);Ge({clueId:L,exhibitionId:q}).then(d=>{let e=d.data;z.value=e.attachPrice.add,A.value=e.attachPrice.discount,j.value=e.companyBrand,O.value=e.unitPrice,B.value=e.exhibitionHall,S.value=e.companyName,J.value=e.isNew});const X=ee(()=>{let d=B.value.find(e=>e.code===P.value);return d?d.img:""});return(d,e)=>{const s=Je,i=Fe,_=De,Y=$e,x=Oe,N=Re,C=Be,b=ze,ce=Ae,me=je,fe=He,_e=Se,he=le("DeleteFilled"),Z=Ee,K=qe,ve=Ue,G=Ie,be=le("Close"),ge=ke;return p(),h(g,null,[c("div",Xe,[c("div",Ye,[c("div",Ze,[c("span",null,k(S.value),1),c("span",null,"展馆号："+k(P.value),1)]),c("div",Ke,[o(s,{style:{width:"100%",height:"100%"},src:X.value,"preview-src-list":[X.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",Qe,[c("div",eo,[o(ve,{height:"100%"},{default:l(()=>[o(K,{ref_key:"formRef",ref:$,model:t,"label-width":"auto",class:"form","label-position":"left"},{default:l(()=>[oo,o(i,{label:"企业名称"},{default:l(()=>[f(k(S.value),1)]),_:1}),o(i,{label:"新展商"},{default:l(()=>[o(Y,{modelValue:J.value,"onUpdate:modelValue":e[0]||(e[0]=r=>J.value=r),disabled:""},{default:l(()=>[o(_,{value:!0},{default:l(()=>[f("是")]),_:1}),o(_,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:l(()=>[o(N,{modelValue:t.add,"onUpdate:modelValue":e[1]||(e[1]=r=>t.add=r),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(z.value,(r,n)=>(p(),y(x,{key:n,label:r.text+" "+r.price+H[r.unit],value:JSON.stringify(r)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:l(()=>[o(N,{modelValue:t.discount,"onUpdate:modelValue":e[2]||(e[2]=r=>t.discount=r),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(A.value,(r,n)=>(p(),y(x,{key:n,label:r.text+" "+r.price+H[r.unit],value:JSON.stringify(r)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:re},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(p(!0),h(g,null,w(t.position,(r,n)=>(p(),h("div",{class:"item",key:n},[o(i,{label:"展馆号",prop:`position[${n}].hallCode`,rules:I(U).required},{default:l(()=>[o(N,{modelValue:t.position[n].hallCode,"onUpdate:modelValue":u=>t.position[n].hallCode=u,placeholder:"请选择",onChange:()=>{D(r.hallCode,n),P.value=r.hallCode}},{default:l(()=>[(p(!0),h(g,null,w(B.value,(u,V)=>(p(),y(x,{key:V,label:u.code,value:u.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${n}].positionCode`,rules:[...I(U).required,{validator:(u,V,ye)=>de(u,V,ye,t.position[n].hallCode),trigger:"change"}]},{default:l(()=>[o(fe,{trigger:"click",style:{width:"100%"},"max-height":"300px",onCommand:u=>{t.position[n].positionCode=u}},{dropdown:l(()=>[E.value[n].length?(p(),y(me,{key:0},{default:l(()=>[(p(!0),h(g,null,w(E.value[n],(u,V)=>(p(),y(ce,{key:V,style:{width:"270px"},command:u},{default:l(()=>[f(k(u),1)]),_:2},1032,["command"]))),128))]),_:2},1024)):(p(),h("div",lo,"无数据"))]),default:l(()=>[o(b,{modelValue:t.position[n].positionCode,"onUpdate:modelValue":u=>t.position[n].positionCode=u,autocomplete:"off","suffix-icon":"ArrowDown"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onCommand"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:l(()=>[o(N,{modelValue:t.position[n].companyBrand,"onUpdate:modelValue":u=>t.position[n].companyBrand=u,multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(j.value,(u,V)=>(p(),y(x,{key:V,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:l(()=>[o(Y,{modelValue:t.position[n].type,"onUpdate:modelValue":u=>t.position[n].type=u},{default:l(()=>[o(_,{value:1},{default:l(()=>[f("标准")]),_:1}),o(_,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${n}].product`,rules:I(U).required},{default:l(()=>[o(C,{onClick:u=>se(n)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),t.position[n].product?(p(),y(i,{key:0,label:" "},{default:l(()=>[c("div",null,k(t.position[n].product+" "+t.position[n].area+"㎡"),1)]),_:2},1024)):Ce("",!0),o(i,{label:"展位原价"},{default:l(()=>[o(b,{modelValue:t.position[n].costPrice,"onUpdate:modelValue":u=>t.position[n].costPrice=u,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:l(()=>[o(b,{"model-value":t.position[n].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:l(()=>[o(b,{"model-value":t.position[n].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${n}].finalPrice`,rules:I(U).required},{default:l(()=>[o(_e,{modelValue:t.position[n].finalPrice,"onUpdate:modelValue":u=>t.position[n].finalPrice=u,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",to,[o(C,{link:"",type:"danger",onClick:u=>{t.position.splice(n,1),E.value.splice(n,1)}},{default:l(()=>[o(Z,null,{default:l(()=>[o(he)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",ao,[o(C,{type:"primary",onClick:ue,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(ge,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=r=>a.show=r),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{R.value.resetFields()})},{footer:l(()=>[c("div",io,[o(C,{onClick:e[6]||(e[6]=r=>a.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:pe},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(K,{ref_key:"ggFormRef",ref:R,model:a.form,"label-width":"auto","label-position":"left"},{default:l(()=>[o(i,{label:"产品名称",prop:"product",rules:I(U).required},{default:l(()=>[o(N,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=r=>a.form.product=r),placeholder:"",onChange:ae},{default:l(()=>[(p(!0),h(g,null,w(O.value,r=>(p(),y(x,{key:r.id,label:r.text+" "+r.price+"/"+r.num+"/㎡",value:r.text},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(b,{"model-value":ie.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",required:"",rules:[{validator:ne,trigger:"blur"}]},{default:l(()=>[o(G,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=r=>a.form.length=r),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"长： 例如3"},null,8,["modelValue"])]),_:1})]),_:1}),o(G,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(Z,null,{default:l(()=>[o(be)]),_:1})]),_:1}),o(G,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=r=>a.form.width=r),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"宽： 例如3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:l(()=>[o(b,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),To=Me(no,[["__scopeId","data-v-11458f3d"]]);export{To as default};
