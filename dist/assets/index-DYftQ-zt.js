import{m as me,b as T,_ as pe,w as X,E as A}from"./index-C9cl6geq.js";import{a1 as Y,aP as _e,j as ge,I as H,ah as ce,d as ne,aQ as ve,aR as Ie,aS as ze,a5 as we,u as ye,aT as Ce,l as k,aU as Le,a2 as Se,e as y,v as ue,M as he,y as be,o as b,c as de,S as m,w as L,P as h,n as p,a as e,g as fe,a9 as Ee,W as S,a7 as Ne,f as x,F as ae,am as xe,q as Te,aV as Oe,aW as Re,a0 as $e,aX as Ae,aY as Ye,V as Xe,C as Be,D as Ve,r as te,T as Me,aZ as Pe,a_ as De,h as ke,as as Fe,a$ as He,m as We,ag as je,B as Ke,R as qe}from"./index-C7BJXNGv.js";import{d as Ze}from"./el-tag-CJu4-Dhf.js";import{d as Ue}from"./el-input-BbEJexu3.js";import{g as Ge}from"./scroll-BnDCk2ZS.js";import{r as Qe}from"./request-ihCsYx8e.js";const Je=(n,c)=>{if(!Y||!n||!c)return!1;const s=n.getBoundingClientRect();let v;return c instanceof Element?v=c.getBoundingClientRect():v={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},s.top<v.bottom&&s.bottom>v.top&&s.right>v.left&&s.left<v.right},_t=n=>{let c,s;return n.type==="touchend"?(s=n.changedTouches[0].clientY,c=n.changedTouches[0].clientX):n.type.startsWith("touch")?(s=n.touches[0].clientY,c=n.touches[0].clientX):(s=n.clientY,c=n.clientX),{clientX:c,clientY:s}};var et="Expected a function";function ie(n,c,s){var v=!0,r=!0;if(typeof n!="function")throw new TypeError(et);return _e(s)&&(v="leading"in s?!!s.leading:v,r="trailing"in s?!!s.trailing:r),Ze(n,c,{leading:v,maxWait:c,trailing:r})}const tt=ge({urlList:{type:H(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),at={close:()=>!0,switch:n=>ce(n),rotate:n=>ce(n)},nt=["src","crossorigin"],st=ne({name:"ElImageViewer"}),ot=ne({...st,props:tt,emits:at,setup(n,{expose:c,emit:s}){var v;const r=n,w={CONTAIN:{name:"contain",icon:ve(Ie)},ORIGINAL:{name:"original",icon:ve(ze)}},{t:se}=we(),u=ye("image-viewer"),{nextZIndex:B}=Ce(),E=k(),N=k([]),O=Le(),_=k(!0),d=k(r.initialIndex),R=Se(w.CONTAIN),l=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),V=k((v=r.zIndex)!=null?v:B()),oe=y(()=>{const{urlList:a}=r;return a.length<=1}),W=y(()=>d.value===0),j=y(()=>d.value===r.urlList.length-1),M=y(()=>r.urlList[d.value]),le=y(()=>[u.e("btn"),u.e("prev"),u.is("disabled",!r.infinite&&W.value)]),K=y(()=>[u.e("btn"),u.e("next"),u.is("disabled",!r.infinite&&j.value)]),P=y(()=>{const{scale:a,deg:o,offsetX:i,offsetY:I,enableTransition:C}=l.value;let g=i/a,z=I/a;switch(o%360){case 90:case-270:[g,z]=[z,-g];break;case 180:case-180:[g,z]=[-g,-z];break;case 270:case-90:[g,z]=[-z,g];break}const $={transform:`scale(${a}) rotate(${o}deg) translate(${g}px, ${z}px)`,transition:C?"transform .3s":""};return R.value.name===w.CONTAIN.name&&($.maxWidth=$.maxHeight="100%"),$});function D(){q(),s("close")}function re(){const a=ie(i=>{switch(i.code){case A.esc:r.closeOnPressEscape&&D();break;case A.space:J();break;case A.left:ee();break;case A.up:f("zoomIn");break;case A.right:t();break;case A.down:f("zoomOut");break}}),o=ie(i=>{const I=i.deltaY||i.deltaX;f(I<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});O.run(()=>{X(document,"keydown",a),X(document,"wheel",o)})}function q(){O.stop()}function Z(){_.value=!1}function U(a){_.value=!1,a.target.alt=se("el.image.error")}function G(a){if(_.value||a.button!==0||!E.value)return;l.value.enableTransition=!1;const{offsetX:o,offsetY:i}=l.value,I=a.pageX,C=a.pageY,g=ie($=>{l.value={...l.value,offsetX:o+$.pageX-I,offsetY:i+$.pageY-C}}),z=X(document,"mousemove",g);X(document,"mouseup",()=>{z()}),a.preventDefault()}function Q(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function J(){if(_.value)return;const a=De(w),o=Object.values(w),i=R.value.name,C=(o.findIndex(g=>g.name===i)+1)%a.length;R.value=w[a[C]],Q()}function F(a){const o=r.urlList.length;d.value=(a+o)%o}function ee(){W.value&&!r.infinite||F(d.value-1)}function t(){j.value&&!r.infinite||F(d.value+1)}function f(a,o={}){if(_.value)return;const{minScale:i,maxScale:I}=r,{zoomRate:C,rotateDeg:g,enableTransition:z}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...o};switch(a){case"zoomOut":l.value.scale>i&&(l.value.scale=Number.parseFloat((l.value.scale/C).toFixed(3)));break;case"zoomIn":l.value.scale<I&&(l.value.scale=Number.parseFloat((l.value.scale*C).toFixed(3)));break;case"clockwise":l.value.deg+=g,s("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=g,s("rotate",l.value.deg);break}l.value.enableTransition=z}return ue(M,()=>{he(()=>{const a=N.value[0];a!=null&&a.complete||(_.value=!0)})}),ue(d,a=>{Q(),s("switch",a)}),be(()=>{var a,o;re(),(o=(a=E.value)==null?void 0:a.focus)==null||o.call(a)}),c({setActiveItem:F}),(a,o)=>(b(),de(Pe,{to:"body",disabled:!a.teleported},[m(Me,{name:"viewer-fade",appear:""},{default:L(()=>[h("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:p(e(u).e("wrapper")),style:fe({zIndex:V.value})},[h("div",{class:p(e(u).e("mask")),onClick:o[0]||(o[0]=Ee(i=>a.hideOnClickModal&&D(),["self"]))},null,2),S(" CLOSE "),h("span",{class:p([e(u).e("btn"),e(u).e("close")]),onClick:D},[m(e(T),null,{default:L(()=>[m(e(Ne))]),_:1})],2),S(" ARROW "),e(oe)?S("v-if",!0):(b(),x(ae,{key:0},[h("span",{class:p(e(le)),onClick:ee},[m(e(T),null,{default:L(()=>[m(e(xe))]),_:1})],2),h("span",{class:p(e(K)),onClick:t},[m(e(T),null,{default:L(()=>[m(e(Te))]),_:1})],2)],64)),S(" ACTIONS "),h("div",{class:p([e(u).e("btn"),e(u).e("actions")])},[h("div",{class:p(e(u).e("actions__inner"))},[m(e(T),{onClick:o[1]||(o[1]=i=>f("zoomOut"))},{default:L(()=>[m(e(Oe))]),_:1}),m(e(T),{onClick:o[2]||(o[2]=i=>f("zoomIn"))},{default:L(()=>[m(e(Re))]),_:1}),h("i",{class:p(e(u).e("actions__divider"))},null,2),m(e(T),{onClick:J},{default:L(()=>[(b(),de($e(e(R).icon)))]),_:1}),h("i",{class:p(e(u).e("actions__divider"))},null,2),m(e(T),{onClick:o[3]||(o[3]=i=>f("anticlockwise"))},{default:L(()=>[m(e(Ae))]),_:1}),m(e(T),{onClick:o[4]||(o[4]=i=>f("clockwise"))},{default:L(()=>[m(e(Ye))]),_:1})],2)],2),S(" CANVAS "),h("div",{class:p(e(u).e("canvas"))},[(b(!0),x(ae,null,Xe(a.urlList,(i,I)=>Be((b(),x("img",{ref_for:!0,ref:C=>N.value[I]=C,key:i,src:i,style:fe(e(P)),class:p(e(u).e("img")),crossorigin:a.crossorigin,onLoad:Z,onError:U,onMousedown:G},null,46,nt)),[[Ve,I===d.value]])),128))],2),te(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var lt=pe(ot,[["__file","image-viewer.vue"]]);const rt=ke(lt),it=ge({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:H([String,Object])},previewSrcList:{type:H(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),ct={load:n=>n instanceof Event,error:n=>n instanceof Event,switch:n=>ce(n),close:()=>!0,show:()=>!0},ut=["src","loading","crossorigin"],dt={key:0},ft=ne({name:"ElImage",inheritAttrs:!1}),vt=ne({...ft,props:it,emits:ct,setup(n,{emit:c}){const s=n;let v="";const{t:r}=we(),w=ye("image"),se=Fe(),u=Ue(),B=k(),E=k(!1),N=k(!0),O=k(!1),_=k(),d=k(),R=Y&&"loading"in HTMLImageElement.prototype;let l,V;const oe=y(()=>[w.e("inner"),M.value&&w.e("preview"),N.value&&w.is("loading")]),W=y(()=>se.style),j=y(()=>{const{fit:t}=s;return Y&&t?{objectFit:t}:{}}),M=y(()=>{const{previewSrcList:t}=s;return Array.isArray(t)&&t.length>0}),le=y(()=>{const{previewSrcList:t,initialIndex:f}=s;let a=f;return f>t.length-1&&(a=0),a}),K=y(()=>s.loading==="eager"?!1:!R&&s.loading==="lazy"||s.lazy),P=()=>{Y&&(N.value=!0,E.value=!1,B.value=s.src)};function D(t){N.value=!1,E.value=!1,c("load",t)}function re(t){N.value=!1,E.value=!0,c("error",t)}function q(){Je(_.value,d.value)&&(P(),G())}const Z=He(q,200,!0);async function U(){var t;if(!Y)return;await he();const{scrollContainer:f}=s;je(f)?d.value=f:Ke(f)&&f!==""?d.value=(t=document.querySelector(f))!=null?t:void 0:_.value&&(d.value=Ge(_.value)),d.value&&(l=X(d,"scroll",Z),setTimeout(()=>q(),100))}function G(){!Y||!d.value||!Z||(l==null||l(),d.value=void 0)}function Q(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function J(){M.value&&(V=X("wheel",Q,{passive:!1}),v=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,c("show"))}function F(){V==null||V(),document.body.style.overflow=v,O.value=!1,c("close")}function ee(t){c("switch",t)}return ue(()=>s.src,()=>{K.value?(N.value=!0,E.value=!1,G(),U()):P()}),be(()=>{K.value?U():P()}),(t,f)=>(b(),x("div",{ref_key:"container",ref:_,class:p([e(w).b(),t.$attrs.class]),style:fe(e(W))},[E.value?te(t.$slots,"error",{key:0},()=>[h("div",{class:p(e(w).e("error"))},qe(e(r)("el.image.error")),3)]):(b(),x(ae,{key:1},[B.value!==void 0?(b(),x("img",We({key:0},e(u),{src:B.value,loading:t.loading,style:e(j),class:e(oe),crossorigin:t.crossorigin,onClick:J,onLoad:D,onError:re}),null,16,ut)):S("v-if",!0),N.value?(b(),x("div",{key:1,class:p(e(w).e("wrapper"))},[te(t.$slots,"placeholder",{},()=>[h("div",{class:p(e(w).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),e(M)?(b(),x(ae,{key:2},[O.value?(b(),de(e(rt),{key:0,"z-index":t.zIndex,"initial-index":e(le),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:F,onSwitch:ee},{default:L(()=>[t.$slots.viewer?(b(),x("div",dt,[te(t.$slots,"viewer")])):S("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],6))}});var mt=pe(vt,[["__file","image.vue"]]);const It=ke(mt),pt="/web/v1",zt=n=>Qe({url:pt+"/tencent/cos/upload",method:"post",data:n});export{It as E,_t as g,zt as u};
