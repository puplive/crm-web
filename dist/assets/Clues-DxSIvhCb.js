import{d as ae,y as re,t as n,az as ne,b as f,X as v,$ as a,i as o,J as h,a5 as ie,am as se,a7 as s,o as r,Y as i,a1 as V,Z as U,h as d,ak as p}from"./index-B6iLQo86.js";import{E as ue}from"./dialog-CENdDqnb.js";/* empty css                */import{a as de,E as me}from"./form-item-C2ENUIsg.js";/* empty css              */import"./tag-CrxgzzqE.js";import{E as pe,a as ce}from"./select-CiM7jlhw.js";import"./scrollbar-CxomNflS.js";import"./popper-gYmmCBAL.js";import{E as fe,a as _e,_ as ve}from"./sx-Wg2jNrT3.js";import{E as ge,a as he}from"./table-column-DK07rXsE.js";import{E as be,a as ke}from"./checkbox-Da4NUTzJ.js";/* empty css                */import{E as ye}from"./link-B-3lq3J9.js";/* empty css                       */import{E as we}from"./button-5AEbNLUW.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-B7L_o8rg.js";/* empty css                                              */import{a as _}from"./index-CFiDW3zP.js";import{e as Ee}from"./index-CJHBNJId.js";/* empty css                *//* empty css                    */import{E as Ce}from"./index-CNRzEN9G.js";import"./index-C6HaxJ0m.js";import"./use-form-item-CfnmRR4I.js";import"./scroll-93LZPfoz.js";import"./vnode-CvIq0L5T.js";import"./focus-trap-CbOJCEa5.js";import"./refs-BuFar0Py.js";import"./event-BB_Ol6Sd.js";import"./castArray-Dr2SrWm_.js";import"./_baseClone-BrWLt5Gy.js";import"./_initCloneObject-qAExOYFR.js";import"./isEqual-Hfk1WuHp.js";import"./index-Cl7FP3t8.js";import"./dropdown-DTfYBFWq.js";/* empty css                      */import"./index-mORRlnij.js";import"./aria-KgdLjl5h.js";import"./validator-9QqxxWlE.js";const Ve={class:"s-flex-col",style:{height:"100%"}},Se={class:"s-table-operations"},Fe=v("img",{style:{width:"17px"},src:ve,alt:""},null,-1),Ue={class:"s-flex-auto",style:{"min-height":"0"}},Ie={class:"s-table-pagination"},Re={class:"dialog-footer"},$e={class:"dialog-footer"},wt=ae({__name:"Clues",setup(Be){ie(),se();const b=re({page:1,perPage:20}),I=n(0),R=n({}),$=n([]),k=n(null),B=n([]),z=n([]),G=e=>{R.value=e,b.page=1,g()},g=async()=>{_.getList({status:1,...b,...R.value}).then(e=>{e.code===0&&($.value=e.data.data,I.value=e.data.total)})},y=n({}),w=n(!1),N=n(null),J=e=>{y.value.id=e.id,w.value=!0},O=()=>{N.value.validate(e=>{e&&_.changeIntention(y.value).then(l=>{l.code===0?(s.success("转为意向成功"),g(),w.value=!1):s.error(l.msg)})})},X=()=>{let e=k.value.getSelectionRows().map(l=>l.id);if(e.length===0){s.error("请选择需要删除的线索");return}Ce.confirm("确定删除所选线索？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.del({id:e}).then(l=>{l.code===0?(s.success("删除成功"),g()):s.error(l.msg)})}).catch(()=>{})},x=n({}),E=n(!1),P=n(null),D=n([]),Y=()=>{let e=k.value.getSelectionRows().map(l=>l.id);if(e.length===0){s.error("请选择需要转移的线索");return}x.value.id=e,E.value=!0},Z=()=>{P.value.validate(e=>{e&&_.changeUser(x.value).then(l=>{l.code===0?(s.success("转移成功"),E.value=!1,g()):s.error(l.msg)})})},A=()=>{let e=k.value.getSelectionRows().map(l=>l.id);if(e.length===0){s.error("请选择需要移至公海的线索");return}_.changePublic({id:e}).then(l=>{l.code===0?(s.success("移至公海成功"),g()):s.error(l.msg)})},H=()=>{_.clueExport({status:1}).then(e=>{e.code===0?(s.success("导出成功"),window.open(e.data.url,"_self")):s.error(e.msg)})};_.getSearchField().then(e=>{e.code===0&&(B.value=e.data)}),Ee().then(e=>{e.code===0&&(z.value=e.data)}),ne().then(e=>{e.code===0&&(D.value=e.data)});const T=n([]);(()=>{_.getCustomField().then(e=>{e.code===0&&(T.value=e.data,K())})})(),g();const C=n([]),S=n([]),K=()=>{setTimeout(()=>{let e=[];k.value.columns.forEach(l=>{l.label&&e.push(l.label)}),S.value=e.join(",").split(","),C.value=e.join(",").split(",")},0)},c=e=>C.value.length===0&&S.value.length===0?!0:C.value.includes(e);return(e,l)=>{const u=we,Q=be,W=ke,ee=fe,m=he,te=ye,le=ge,oe=_e,L=pe,M=ce,F=de,q=me,j=ue;return r(),f(h,null,[v("div",Ve,[a(xe,{data:B.value,onSearch:G},null,8,["data"]),v("div",Se,[a(u,{onClick:l[0]||(l[0]=t=>e.$router.push("/market/clues/add"))},{default:o(()=>[i("新建线索")]),_:1}),a(u,{onClick:l[1]||(l[1]=t=>e.$router.push({name:"CluesImport",query:{status:1}}))},{default:o(()=>[i("导入")]),_:1}),a(u,{onClick:H},{default:o(()=>[i("导出")]),_:1}),a(u,{onClick:Y},{default:o(()=>[i("转移给他人")]),_:1}),a(u,{onClick:A},{default:o(()=>[i("移至公海")]),_:1}),a(u,{onClick:X},{default:o(()=>[i("删除")]),_:1}),a(ee,{placement:"bottom-end",trigger:"click"},{reference:o(()=>[a(u,{size:"",link:""},{default:o(()=>[Fe]),_:1})]),default:o(()=>[a(W,{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=t=>C.value=t)},{default:o(()=>[v("ul",null,[(r(!0),f(h,null,V(S.value,t=>(r(),f("li",{class:"s-checkbox_item",key:t},[a(Q,{label:t,value:t},{default:o(()=>[i(U(t),1)]),_:2},1032,["label","value"])]))),128))])]),_:1},8,["modelValue"])]),_:1})]),v("div",Ue,[a(le,{ref_key:"tableRef",ref:k,data:$.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:o(()=>[a(m,{type:"selection",width:"42"}),c("序号")?(r(),d(m,{key:0,type:"index",label:"序号",width:"60"})):p("",!0),c("企业名称")?(r(),d(m,{key:1,prop:"companyName",label:"企业名称",width:"180"},{default:o(t=>[a(te,{href:"/market/clues/info?type=1&id="+t.row.id+"&exhibitionId="+t.row.exhibitionId+"&authUser="+t.row.authUser,type:"primary"},{default:o(()=>[i(U(t.row.companyName),1)]),_:2},1032,["href"])]),_:1})):p("",!0),c("展会联系人")?(r(),d(m,{key:2,prop:"exhibitionContact",label:"展会联系人","min-width":"120"})):p("",!0),c("职位")?(r(),d(m,{key:3,prop:"duties",label:"职位"})):p("",!0),c("手机号")?(r(),d(m,{key:4,prop:"phone",label:"手机号","min-width":"120"})):p("",!0),c("跟进状态")?(r(),d(m,{key:5,prop:"recordStatus",label:"跟进状态","min-width":"120"},{default:o(t=>[i(U({0:"无",1:"电话邀约",2:"客户拜访",3:"初步方案",4:"停滞"}[t.row.recordStatus]),1)]),_:1})):p("",!0),c("持有人")?(r(),d(m,{key:6,prop:"authUser",label:"持有人"})):p("",!0),(r(!0),f(h,null,V(T.value,t=>(r(),f(h,{key:t.key},[c(t.name)?(r(),d(m,{key:0,prop:t.key,label:t.name,"min-width":"120"},null,8,["prop","label"])):p("",!0)],64))),128)),c("操作")?(r(),d(m,{key:7,fixed:"right",label:"操作",width:"120"},{default:o(t=>[a(u,{link:"",type:"primary",onClick:Ne=>J(t.row)},{default:o(()=>[i(" 转为意向客户 ")]),_:2},1032,["onClick"])]),_:1})):p("",!0)]),_:1},8,["data"])]),v("div",Ie,[a(oe,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:I.value,"current-page":b.page,"onUpdate:currentPage":l[3]||(l[3]=t=>b.page=t),"page-size":b.perPage,"onUpdate:pageSize":l[4]||(l[4]=t=>b.perPage=t),onChange:g},null,8,["total","current-page","page-size"])])]),a(j,{modelValue:w.value,"onUpdate:modelValue":l[7]||(l[7]=t=>w.value=t),title:"转为意向客户",width:"500",draggable:""},{footer:o(()=>[v("div",Re,[a(u,{onClick:l[6]||(l[6]=t=>w.value=!1)},{default:o(()=>[i("取消")]),_:1}),a(u,{type:"primary",onClick:O},{default:o(()=>[i("确定")]),_:1})])]),default:o(()=>[a(q,{ref_key:"willFormRef",ref:N,model:y.value,"label-width":"auto","label-position":"left"},{default:o(()=>[a(F,{label:"项目",prop:"exhibitionId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(M,{modelValue:y.value.exhibitionId,"onUpdate:modelValue":l[5]||(l[5]=t=>y.value.exhibitionId=t),placeholder:"",filterable:""},{default:o(()=>[(r(!0),f(h,null,V(z.value,t=>(r(),f(h,{key:t.id},[t.status===1?(r(),d(L,{key:0,label:t.exhibitionName,value:t.id},null,8,["label","value"])):p("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(j,{modelValue:E.value,"onUpdate:modelValue":l[10]||(l[10]=t=>E.value=t),title:"转移销售线索",width:"500",draggable:""},{footer:o(()=>[v("div",$e,[a(u,{onClick:l[9]||(l[9]=t=>E.value=!1)},{default:o(()=>[i("取消")]),_:1}),a(u,{type:"primary",onClick:Z},{default:o(()=>[i("确定")]),_:1})])]),default:o(()=>[a(q,{ref_key:"moveFormRef",ref:P,model:x.value,"label-width":"auto","label-position":"left"},{default:o(()=>[a(F,{label:""},{default:o(()=>[i("是否将选中的销售线索转移？")]),_:1}),a(F,{label:"销售线索所有人",prop:"userId",rules:[{required:!0,message:"请选择销售线索所有人"}]},{default:o(()=>[a(M,{modelValue:x.value.userId,"onUpdate:modelValue":l[8]||(l[8]=t=>x.value.userId=t),placeholder:"",filterable:""},{default:o(()=>[(r(!0),f(h,null,V(D.value,t=>(r(),d(L,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{wt as default};
