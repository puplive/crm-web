import{j as xe,a2 as Se,aa as k,L as J,d as me,a4 as ke,u as Fe,l as y,s as Ie,e as $,ae as se,v as Q,y as Pe,af as ze,o as b,f as N,C as fe,a as s,n as ue,a5 as re,r as _e,X as he,S as r,a8 as pe,B as Ae,w as f,c as T,p as Be,ag as Te,ah as De,ai as Ue,h as $e,O as Le,P as c,F as q,W as K,Q as x,R as U,Z as Me,a7 as Oe,_ as Re,$ as qe}from"./index-DHfRNRLb.js";import"./el-input-BkEPJYjr.js";import{E as Ke,a as je}from"./el-table-column-BZI_VcEA.js";import"./el-checkbox-D5-pooQp.js";import"./el-tooltip-l0sNRNKZ.js";import{a as Ze}from"./el-scrollbar-Dylm0_gC.js";import"./el-tag-BekjV4sH.js";import{u as We,a as Ge,b as He,c as Ye,t as Qe,e as ge}from"./el-button-CKfH1yK4.js";import{E as Xe}from"./el-image-viewer-czXcBgCE.js";/* empty css                     *//* empty css                  */import{E as B}from"./request-iz7p0Cm_.js";import{a as j,c as Je}from"./index-Dx_iS1Cj.js";import{e as el}from"./index-WMlAW2Ic.js";import{e as ll}from"./index-CwACmd5o.js";import{b as tl}from"./index-CawKp6Iw.js";/* empty css                   */import{E as al,a as ol}from"./index-BHnnDTrD.js";import{E as nl,a as sl}from"./index-gTMoCHUt.js";import{E as rl}from"./index-CGC0Fgk5.js";import{E as Ne}from"./index-DRvl5mKD.js";import{u as ul,_ as il,E as ye}from"./index-B7dESW3w.js";import{C as we,I as ie,U as X}from"./event-BB_Ol6Sd.js";import{v as Ve}from"./index-BavSuBRV.js";import{_ as dl}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./isArrayLikeObject-D4i4NGkg.js";import"./typescript-CXVAC2gn.js";import"./isEqual-D-5pMCgb.js";import"./scroll-hmreJbXs.js";import"./castArray-CDtw-Gfc.js";const cl=xe({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:Se,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:u=>u===null||k(u)||["min","max"].includes(u),default:null},name:String,label:String,placeholder:String,precision:{type:Number,validator:u=>u>=0&&u===Number.parseInt(`${u}`,10)},validateEvent:{type:Boolean,default:!0},...We(["ariaLabel"])}),pl={[we]:(u,Z)=>Z!==u,blur:u=>u instanceof FocusEvent,focus:u=>u instanceof FocusEvent,[ie]:u=>k(u)||J(u),[X]:u=>k(u)||J(u)},ml=["aria-label","onKeydown"],vl=["aria-label","onKeydown"],bl=me({name:"ElInputNumber"}),fl=me({...bl,props:cl,emits:pl,setup(u,{expose:Z,emit:_}){const o=u,{t:I}=ke(),m=Fe("input-number"),h=y(),i=Ie({currentValue:o.modelValue,userInput:null}),{formItem:w}=Ge(),F=$(()=>k(o.modelValue)&&o.modelValue<=o.min),P=$(()=>k(o.modelValue)&&o.modelValue>=o.max),z=$(()=>{const e=ee(o.step);return se(o.precision)?Math.max(ee(o.modelValue),e):(e>o.precision,o.precision)}),L=$(()=>o.controls&&o.controlsPosition==="right"),W=He(),A=Ye(),M=$(()=>{if(i.userInput!==null)return i.userInput;let e=i.currentValue;if(J(e))return"";if(k(e)){if(Number.isNaN(e))return"";se(o.precision)||(e=e.toFixed(o.precision))}return e}),G=(e,l)=>{if(se(l)&&(l=z.value),l===0)return Math.round(e);let n=String(e);const v=n.indexOf(".");if(v===-1||!n.replace(".","").split("")[v+l])return e;const R=n.length;return n.charAt(R-1)==="5"&&(n=`${n.slice(0,Math.max(0,R-1))}6`),Number.parseFloat(Number(n).toFixed(l))},ee=e=>{if(J(e))return 0;const l=e.toString(),n=l.indexOf(".");let v=0;return n!==-1&&(v=l.length-n-1),v},le=(e,l=1)=>k(e)?G(e+o.step*l):i.currentValue,H=()=>{if(o.readonly||A.value||P.value)return;const e=Number(M.value)||0,l=le(e);D(l),_(ie,i.currentValue),a()},Y=()=>{if(o.readonly||A.value||F.value)return;const e=Number(M.value)||0,l=le(e,-1);D(l),_(ie,i.currentValue),a()},te=(e,l)=>{const{max:n,min:v,step:p,precision:V,stepStrictly:R,valueOnClear:E}=o;n<v&&Qe("InputNumber","min should not be greater than max.");let g=Number(e);if(J(e)||Number.isNaN(g))return null;if(e===""){if(E===null)return null;g=Ae(E)?{min:v,max:n}[E]:E}return R&&(g=G(Math.round(g/p)*p,V)),se(V)||(g=G(g,V)),(g>n||g<v)&&(g=g>n?n:v,l&&_(X,g)),g},D=(e,l=!0)=>{var n;const v=i.currentValue,p=te(e);if(!l){_(X,p);return}v===p&&e||(i.userInput=null,_(X,p),v!==p&&_(we,p,v),o.validateEvent&&((n=w==null?void 0:w.validate)==null||n.call(w,"change").catch(V=>ge())),i.currentValue=p)},ae=e=>{i.userInput=e;const l=e===""?null:Number(e);_(ie,l),D(l,!1)},oe=e=>{const l=e!==""?Number(e):"";(k(l)&&!Number.isNaN(l)||e==="")&&D(l),a(),i.userInput=null},C=()=>{var e,l;(l=(e=h.value)==null?void 0:e.focus)==null||l.call(e)},O=()=>{var e,l;(l=(e=h.value)==null?void 0:e.blur)==null||l.call(e)},de=e=>{_("focus",e)},ne=e=>{var l;i.userInput=null,_("blur",e),o.validateEvent&&((l=w==null?void 0:w.validate)==null||l.call(w,"blur").catch(n=>ge()))},a=()=>{i.currentValue!==o.modelValue&&(i.currentValue=o.modelValue)},d=e=>{document.activeElement===e.target&&e.preventDefault()};return Q(()=>o.modelValue,(e,l)=>{const n=te(e,!0);i.userInput===null&&n!==l&&(i.currentValue=n)},{immediate:!0}),Pe(()=>{var e;const{min:l,max:n,modelValue:v}=o,p=(e=h.value)==null?void 0:e.input;if(p.setAttribute("role","spinbutton"),Number.isFinite(n)?p.setAttribute("aria-valuemax",String(n)):p.removeAttribute("aria-valuemax"),Number.isFinite(l)?p.setAttribute("aria-valuemin",String(l)):p.removeAttribute("aria-valuemin"),p.setAttribute("aria-valuenow",i.currentValue||i.currentValue===0?String(i.currentValue):""),p.setAttribute("aria-disabled",String(A.value)),!k(v)&&v!=null){let V=Number(v);Number.isNaN(V)&&(V=null),_(X,V)}p.addEventListener("wheel",d,{passive:!1})}),ze(()=>{var e,l;const n=(e=h.value)==null?void 0:e.input;n==null||n.setAttribute("aria-valuenow",`${(l=i.currentValue)!=null?l:""}`)}),ul({from:"label",replacement:"aria-label",version:"2.8.0",scope:"el-input-number",ref:"https://element-plus.org/en-US/component/input-number.html"},$(()=>!!o.label)),Z({focus:C,blur:O}),(e,l)=>(b(),N("div",{class:ue([s(m).b(),s(m).m(s(W)),s(m).is("disabled",s(A)),s(m).is("without-controls",!e.controls),s(m).is("controls-right",s(L))]),onDragstart:l[0]||(l[0]=pe(()=>{},["prevent"]))},[e.controls?fe((b(),N("span",{key:0,role:"button","aria-label":s(I)("el.inputNumber.decrease"),class:ue([s(m).e("decrease"),s(m).is("disabled",s(F))]),onKeydown:re(Y,["enter"])},[_e(e.$slots,"decrease-icon",{},()=>[r(s(ye),null,{default:f(()=>[s(L)?(b(),T(s(Be),{key:0})):(b(),T(s(Te),{key:1}))]),_:1})])],42,ml)),[[s(Ve),Y]]):he("v-if",!0),e.controls?fe((b(),N("span",{key:1,role:"button","aria-label":s(I)("el.inputNumber.increase"),class:ue([s(m).e("increase"),s(m).is("disabled",s(P))]),onKeydown:re(H,["enter"])},[_e(e.$slots,"increase-icon",{},()=>[r(s(ye),null,{default:f(()=>[s(L)?(b(),T(s(De),{key:0})):(b(),T(s(Ue),{key:1}))]),_:1})])],42,vl)),[[s(Ve),H]]):he("v-if",!0),r(s(Ne),{id:e.id,ref_key:"input",ref:h,type:"number",step:e.step,"model-value":s(M),placeholder:e.placeholder,readonly:e.readonly,disabled:s(A),size:s(W),max:e.max,min:e.min,name:e.name,"aria-label":e.label||e.ariaLabel,"validate-event":!1,onKeydown:[re(pe(H,["prevent"]),["up"]),re(pe(Y,["prevent"]),["down"])],onBlur:ne,onFocus:de,onInput:ae,onChange:oe},null,8,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],34))}});var _l=il(fl,[["__file","input-number.vue"]]);const hl=$e(_l),ve=u=>(Re("data-v-5d5e0632"),u=u(),qe(),u),gl={class:"goods-reserve"},yl={class:"s-top_bar"},Vl={class:"row"},Il={class:"col col1"},Nl={class:"goods-type"},wl=["onClick"],Cl={class:"col col2"},El={class:"goods-list"},xl={class:"msg"},Sl=["title"],kl=["title"],Fl=ve(()=>c("label",{for:""},"规格(尺寸)：",-1)),Pl=["title"],zl=ve(()=>c("label",{for:""},"单  价：",-1)),Al={class:"p"},Bl=ve(()=>c("label",{for:""},"库  存：",-1)),Tl={class:"col col3"},Dl={class:"table"},Ul={class:"bottom-bar"},$l={class:"p1"},Ll={class:"p2"},Ml=me({__name:"Reserve",setup(u){const Z=Me(),_=Oe(),o=y(_.query.exhibitionId?Number(_.query.exhibitionId):""),I=y(_.query.exhibitorId?Number(_.query.exhibitorId):""),m=y(_.query.hallCode||""),h=y(_.query.positionCode||""),i=_.query.clueId,w=y(0),F=y([]),P=y({}),z=y([]),L=y([]),W=y([]),A=y([]),M=y([]);Ie({});const G=(a,d=1)=>{j.addCart({exhibitorId:I.value,exhibitionId:o.value,hallCode:m.value,positionCode:h.value,id:a.id,num:d}).then(e=>{e.code===0?(B.success("添加成功"),C()):B.error(e.msg)})},ee=(a,d=1)=>{j.editCart({exhibitorId:I.value,exhibitionId:o.value,hallCode:m.value,positionCode:h.value,id:a.id,num:d}).then(e=>{e.code===0?B.success("成功"):B.error(e.msg),C()})},le=a=>{j.delCart({exhibitorId:I.value,exhibitionId:o.value,hallCode:m.value,positionCode:h.value,id:a.id,num:a.num}).then(d=>{d.code===0?(B.success("删除成功"),C()):B.error(d.msg)})},H=a=>{P.value=F.value[a]},Y=()=>{el().then(a=>{a.code===0&&(L.value=a.data)})},te=()=>{ll().then(a=>{a.code===0&&(W.value=a.data)})},D=()=>{Je({exhibitionId:o.value}).then(a=>{a.code===0&&(A.value=a.data)})},ae=()=>{tl({exhibitionId:o.value}).then(a=>{a.code===0&&(M.value=a.data)})},oe=()=>{j.getMaterial({exhibitionId:o.value}).then(a=>{a.code===0&&(F.value=a.data,F.value.length>0?P.value=F.value[0]:P.value={})})},C=()=>{if(console.log("getCart"),!o.value||!I.value||!m.value||!h.value){z.value=[];return}j.getCart({exhibitorId:I.value,exhibitionId:o.value,hallCode:m.value,positionCode:h.value}).then(a=>{a.code===0&&(z.value=a.data)})},O=y(!1),de=()=>{O.value=!0,j.create({clueId:i,exhibitionId:o.value,exhibitorId:I.value,hallCode:m.value,positionCode:h.value,price:w.value,data:z.value.map(a=>({...a,remark:""}))}).then(a=>{a.code===0?(B.success("提交成功"),Z.go(-1)):B.error(a.msg),O.value=!1}).catch(a=>{O.value=!1})};Q(()=>o.value,a=>{m.value="",h.value="",D(),ae(),oe(),C()}),Q(()=>I.value,a=>{C()}),Q(()=>m.value,a=>{C()}),Q(()=>h.value,a=>{C()});const ne=$(()=>{let a=0;return z.value.forEach(d=>{a+=d.price*d.num}),w.value=a,a});return Y(),te(),D(),ae(),oe(),C(),(a,d)=>{const e=ol,l=al,n=nl,v=sl,p=Xe,V=rl,R=Ze,E=Ke,g=hl,Ce=je,be=Le("font"),Ee=Ne;return b(),N("div",gl,[c("div",yl,[r(v,{inline:!0},{default:f(()=>[r(n,{label:"展会名称",style:{width:"220px"}},{default:f(()=>[r(l,{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=t=>o.value=t),placeholder:"请选择展会名称"},{default:f(()=>[(b(!0),N(q,null,K(L.value,t=>(b(),T(e,{key:t.id,label:t.exhibitionName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"参展企业",style:{width:"220px"}},{default:f(()=>[r(l,{modelValue:I.value,"onUpdate:modelValue":d[1]||(d[1]=t=>I.value=t),placeholder:"请选择参展企业"},{default:f(()=>[(b(!0),N(q,null,K(W.value,t=>(b(),T(e,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"展馆",style:{width:"220px"}},{default:f(()=>[r(l,{modelValue:m.value,"onUpdate:modelValue":d[2]||(d[2]=t=>m.value=t),placeholder:"请选择展馆"},{default:f(()=>[(b(!0),N(q,null,K(A.value,t=>(b(),T(e,{key:t.code,label:t.code,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(n,{label:"展位号",style:{width:"220px"}},{default:f(()=>[r(l,{modelValue:h.value,"onUpdate:modelValue":d[3]||(d[3]=t=>h.value=t),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"添加展位号",style:{width:"240px"}},{default:f(()=>[(b(!0),N(q,null,K(M.value,t=>(b(),T(e,{key:t.positionCode,label:t.positionCode,value:t.positionCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),c("div",Vl,[c("div",Il,[c("ul",Nl,[(b(!0),N(q,null,K(F.value,(t,S)=>(b(),N("li",{key:S,onClick:ce=>H(S),class:ue({active:t.project===P.value.project})},U(t.project),11,wl))),128))])]),c("div",Cl,[r(R,null,{default:f(()=>[c("div",El,[(b(!0),N(q,null,K(P.value.data,(t,S)=>(b(),N("li",{key:S},[r(p,{style:{width:"100%",height:"200px"},src:t.img,"preview-src-list":[t.img],fit:"contain"},null,8,["src","preview-src-list"]),c("div",xl,[c("p",{class:"title",title:t.position},U(t.position),9,Sl),c("p",{class:"p",title:t.size},[Fl,x(U(t.size),1)],8,kl),c("p",{class:"p",title:t.price+"元/"+t.unit},[zl,c("span",null,U(t.price+"元/"+t.unit),1)],8,Pl),c("p",Al,[Bl,x(U(t.num),1)])]),r(V,{type:"primary",onClick:ce=>G(t),disabled:t.num<=0,style:{width:"100%"}},{default:f(()=>[x("加入购物车")]),_:2},1032,["onClick","disabled"])]))),128))])]),_:1})]),c("div",Tl,[c("div",Dl,[r(Ce,{data:z.value,border:""},{default:f(()=>[r(E,{label:"服务项目",prop:"project"}),r(E,{label:"位置/版面",prop:"position"}),r(E,{label:"规格",prop:"size"}),r(E,{label:"单价(RMB)",prop:"price"}),r(E,{label:"数量",width:"200px"},{default:f(t=>[r(g,{modelValue:t.row.num,"onUpdate:modelValue":S=>t.row.num=S,min:1,size:"small",onChange:(S,ce)=>{ee(t.row,S-ce)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),r(V,{type:"danger",link:"",onClick:S=>le(t.row),style:{"margin-left":"10px"},icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),c("div",Ul,[c("div",$l,[c("span",null,[x("已选物料 "),r(be,null,{default:f(()=>[x(U(z.value.length),1)]),_:1}),x(" 项")]),x(),c("span",null,[x("物料金额 "),r(be,null,{default:f(()=>[x("¥"+U(ne.value),1)]),_:1})])]),c("div",Ll,[r(n,{label:"最终金额",style:{width:"100%","margin-bottom":"0"}},{default:f(()=>[r(Ee,{modelValue:w.value,"onUpdate:modelValue":d[4]||(d[4]=t=>w.value=t)},null,8,["modelValue"])]),_:1})]),r(V,{type:"primary",style:{width:"100%"},onClick:de,loading:O.value,disabled:ne.value<=0},{default:f(()=>[x("提交")]),_:1},8,["loading","disabled"])])])])])}}}),_t=dl(Ml,[["__scopeId","data-v-5d5e0632"]]);export{_t as default};
