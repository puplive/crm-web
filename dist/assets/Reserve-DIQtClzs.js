import{d as Ve,t as m,y as ee,c as oe,z as le,b as h,X as c,Z as k,$ as o,i as l,J as g,a5 as we,am as Ce,W as te,o as p,Y as f,a1 as w,h as y,e as I,ak as Ee,G as xe,a2 as Ne,a3 as ke}from"./index-C_05KRGS.js";import{E as Ie}from"./dialog-Dg5SD3wH.js";/* empty css                */import{E as Fe}from"./col-Bruo0X_a.js";import{E as Ue}from"./scrollbar-mNXNuAx8.js";import{a as qe,E as Se}from"./form-item-DB6KKvGp.js";/* empty css              */import{E as Be}from"./input-number-CqXYS01k.js";import{E as Oe}from"./button-Dkfrz2pB.js";/* empty css                      */import"./popper-eK9e0ccA.js";import"./tag-ZlOpYQtd.js";import{E as Re,a as De}from"./select-DFbZre-8.js";/* empty css                    */import{E as $e,a as Je}from"./radio-Dj1E1ybC.js";import{E as Te}from"./image-viewer-BPvrXajP.js";import{a as Ge}from"./index-ROuDHd8-.js";import{h as Le,p as ze}from"./index-DTo5A2VP.js";import{_ as F}from"./rules-F8IXRWD9.js";import{E as Ae}from"./index-D3tfzHDZ.js";import{E as je,a as He,b as Me}from"./index-BQ9mMqfZ.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B-eMvqIM.js";import"./use-form-item-vtZrfGKu.js";import"./scroll-D715KlLh.js";import"./vnode-CiIOrOvn.js";import"./focus-trap-hnU7B-4d.js";import"./refs-DOIK4Yy4.js";import"./event-BB_Ol6Sd.js";import"./castArray--DSxZzZp.js";import"./_baseClone-iBW9snvg.js";import"./_initCloneObject-CDAbW_Mk.js";import"./index-B3ayG4Ym.js";import"./isEqual-BszI5JtU.js";import"./dropdown-BTprauEc.js";const Xe=U=>(Ne("data-v-06dfd628"),U=U(),ke(),U),Ye={class:"booth-reserve"},Ze={class:"l"},Ke={class:"title"},Qe={class:"img-box"},eo={class:"r"},oo={class:"form-box"},lo=Xe(()=>c("div",null,"预定展位",-1)),to={key:1,style:{width:"270px","text-align":"center",padding:"10px"}},ao={style:{"text-align":"center"}},io={style:{padding:"15px"}},ro={class:"dialog-footer"},no=Ve({__name:"Reserve",setup(U){const ae=we(),v=Ce(),L=v.query.clueId,q=v.query.exhibitionId,z=v.query.exhibitorId,P=m(v.query.hallCode),B=m([]),E=m([]),A=m([]),j=m([]),H=m([]),O=m([]),M={1:"%",2:"￥"},t=ee({clueId:L,exhibitionId:q,exhibitorId:z,add:[],discount:[],position:[{hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let d=JSON.parse(v.query.data);t.clueId=d.clueId,t.exhibitionId=d.exhibitionId,t.exhibitorId=d.exhibitorId,t.position=d.position,t.add=d.add,t.discount=d.discount}m({});const R=m(null),a=ee({show:!1,index:0,selected:{},form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ie=d=>{let e=O.value.find(s=>s.text===d);a.form.unitPrice=Number(e.price),a.form.product=e.text,a.form.num=e.num},re=oe(()=>a.form.unitPrice?(Number(a.form.unitPrice)/Number(a.form.num==0?1:a.form.num)).toFixed(2)+"元":""),ne=(d,e,s)=>{e.length===""||a.form.width===""?s(new Error("请填写尺寸")):e.length<=0||a.form.width<=0?s(new Error("尺寸不可为0和负数")):s()},de=()=>{let d=t.position.length;D(P.value,d),t.position.push({hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},D=(d,e)=>{E.value[e]=[],Le({exhibitionId:q,hallCode:d}).then(s=>{E.value[e]=s.data})};D(P.value,0);let $=null;const ue=(d,e,s,i)=>{if(!e)return s(new Error("必填项"));$&&clearTimeout($),$=setTimeout(()=>{ze({exhibitionId:q,exhibitorId:z,hallCode:i,positionCode:e}).then(_=>{_.code===0&&_.data.status?s():s(new Error("该展位已锁定"))})},500)},J=m(null),se=()=>{J.value.validate().then(d=>{d&&ae.push({name:"BoothCreateOrder",query:{...v.query,companyName:S.value,data:JSON.stringify(t)}})}).catch(()=>{})},pe=d=>{a.index=d,a.form.product="",a.form.unitPrice="",a.form.length="",a.form.width="",a.form.num=1,a.show=!0},ce=()=>{R.value.validate().then(d=>{if(!d)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=W(s),_=X(s);t.position[a.index].product=a.form.product,t.position[a.index].unitPrice=(Number(a.form.unitPrice)/Number(a.form.num==0?1:a.form.num)).toFixed(2),t.position[a.index].length=a.form.length,t.position[a.index].width=a.form.width,t.position[a.index].area=e,t.position[a.index].costPrice=Number(s.toFixed(2)),t.position[a.index].addPrice=Number(i.toFixed(2)),t.position[a.index].discountPrice=Number(_.toFixed(2)),t.position[a.index].finalPrice=Number((s+i-_).toFixed(2)),J.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},W=d=>{let e=0;return t.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=d*i.price/100:i.unit===2&&(e+=i.price)}),e},X=d=>{let e=0;return t.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=d*i.price/100:i.unit===2&&(e+=i.price)}),e};le(()=>t.add,d=>{t.position.forEach(e=>{e.addPrice=Number(W(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),le(()=>t.discount,d=>{t.position.forEach(e=>{e.discountPrice=Number(X(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const S=m(""),T=m(!0);Ge({clueId:L,exhibitionId:q}).then(d=>{let e=d.data;A.value=e.attachPrice.add,j.value=e.attachPrice.discount,H.value=e.companyBrand,O.value=e.unitPrice,B.value=e.exhibitionHall,S.value=e.companyName,T.value=e.isNew});const Y=oe(()=>{let d=B.value.find(e=>e.code===P.value);return d?d.img:""});return(d,e)=>{const s=Te,i=qe,_=$e,Z=Je,x=Re,N=De,C=Oe,b=Ae,me=je,fe=He,_e=Me,he=Be,ve=te("DeleteFilled"),K=xe,Q=Se,be=Ue,G=Fe,ge=te("Close"),ye=Ie;return p(),h(g,null,[c("div",Ye,[c("div",Ze,[c("div",Ke,[c("span",null,k(S.value),1),c("span",null,"展馆号："+k(P.value),1)]),c("div",Qe,[o(s,{style:{width:"100%",height:"100%"},src:Y.value,"preview-src-list":[Y.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",eo,[c("div",oo,[o(be,{height:"100%"},{default:l(()=>[o(Q,{ref_key:"formRef",ref:J,model:t,"label-width":"auto",class:"form","label-position":"left"},{default:l(()=>[lo,o(i,{label:"企业名称"},{default:l(()=>[f(k(S.value),1)]),_:1}),o(i,{label:"新展商"},{default:l(()=>[o(Z,{modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=n=>T.value=n),disabled:""},{default:l(()=>[o(_,{value:!0},{default:l(()=>[f("是")]),_:1}),o(_,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:l(()=>[o(N,{modelValue:t.add,"onUpdate:modelValue":e[1]||(e[1]=n=>t.add=n),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(A.value,(n,r)=>(p(),y(x,{key:r,label:n.text+" "+n.price+M[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:l(()=>[o(N,{modelValue:t.discount,"onUpdate:modelValue":e[2]||(e[2]=n=>t.discount=n),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(j.value,(n,r)=>(p(),y(x,{key:r,label:n.text+" "+n.price+M[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:de},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(p(!0),h(g,null,w(t.position,(n,r)=>(p(),h("div",{class:"item",key:r},[o(i,{label:"展馆号",prop:`position[${r}].hallCode`,rules:I(F).required},{default:l(()=>[o(N,{modelValue:t.position[r].hallCode,"onUpdate:modelValue":u=>t.position[r].hallCode=u,placeholder:"请选择",onChange:()=>{D(n.hallCode,r),P.value=n.hallCode}},{default:l(()=>[(p(!0),h(g,null,w(B.value,(u,V)=>(p(),y(x,{key:V,label:u.code,value:u.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${r}].positionCode`,rules:[...I(F).required,{validator:(u,V,Pe)=>ue(u,V,Pe,t.position[r].hallCode),trigger:"change"}]},{default:l(()=>[o(_e,{trigger:"click",style:{width:"100%"},"max-height":"300px",onCommand:u=>{t.position[r].positionCode=u}},{dropdown:l(()=>[E.value[r].length?(p(),y(fe,{key:0},{default:l(()=>[(p(!0),h(g,null,w(E.value[r],(u,V)=>(p(),y(me,{key:V,style:{width:"270px"},command:u},{default:l(()=>[f(k(u),1)]),_:2},1032,["command"]))),128))]),_:2},1024)):(p(),h("div",to,"无数据"))]),default:l(()=>[o(b,{modelValue:t.position[r].positionCode,"onUpdate:modelValue":u=>t.position[r].positionCode=u,autocomplete:"off","suffix-icon":"ArrowDown"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onCommand"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:l(()=>[o(N,{modelValue:t.position[r].companyBrand,"onUpdate:modelValue":u=>t.position[r].companyBrand=u,multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(H.value,(u,V)=>(p(),y(x,{key:V,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:l(()=>[o(Z,{modelValue:t.position[r].type,"onUpdate:modelValue":u=>t.position[r].type=u},{default:l(()=>[o(_,{value:1},{default:l(()=>[f("标准")]),_:1}),o(_,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${r}].product`,rules:I(F).required},{default:l(()=>[o(C,{onClick:u=>pe(r)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),t.position[r].product?(p(),y(i,{key:0,label:" "},{default:l(()=>[c("div",null,k(t.position[r].product+" "+t.position[r].area+"㎡"),1)]),_:2},1024)):Ee("",!0),o(i,{label:"展位原价"},{default:l(()=>[o(b,{modelValue:t.position[r].costPrice,"onUpdate:modelValue":u=>t.position[r].costPrice=u,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:l(()=>[o(b,{"model-value":t.position[r].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:l(()=>[o(b,{"model-value":t.position[r].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${r}].finalPrice`,rules:I(F).required},{default:l(()=>[o(he,{modelValue:t.position[r].finalPrice,"onUpdate:modelValue":u=>t.position[r].finalPrice=u,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",ao,[o(C,{link:"",type:"danger",onClick:u=>{t.position.splice(r,1),E.value.splice(r,1)}},{default:l(()=>[o(K,null,{default:l(()=>[o(ve)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",io,[o(C,{type:"primary",onClick:se,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(ye,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=n=>a.show=n),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{R.value.resetFields()})},{footer:l(()=>[c("div",ro,[o(C,{onClick:e[6]||(e[6]=n=>a.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:ce},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(Q,{ref_key:"ggFormRef",ref:R,model:a.form,"label-width":"auto","label-position":"left"},{default:l(()=>[o(i,{label:"产品名称",prop:"product",rules:I(F).required},{default:l(()=>[o(N,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=n=>a.form.product=n),placeholder:"",onChange:ie},{default:l(()=>[(p(!0),h(g,null,w(O.value,n=>(p(),y(x,{key:n.id,label:n.text+" "+n.price+"/"+n.num+"/㎡",value:n.text},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(b,{"model-value":re.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",required:"",rules:[{validator:ne,trigger:"blur"}]},{default:l(()=>[o(G,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.length=n),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"长： 例如3"},null,8,["modelValue"])]),_:1})]),_:1}),o(G,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(K,null,{default:l(()=>[o(ge)]),_:1})]),_:1}),o(G,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.width=n),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"宽： 例如3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:l(()=>[o(b,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ao=We(no,[["__scopeId","data-v-06dfd628"]]);export{Ao as default};
