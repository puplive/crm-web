import{d as ie,l as n,s as ne,t as N,c as de,b as m,O as o,R as t,i as s,F as C,U as y,P as h,Q as x,W as ue,a5 as re,o as d,h as B,n as ce,X as pe,Y as ve}from"./index-B_yftjoG.js";/* empty css                 */import{E as me,a as _e}from"./el-table-column-HUzfgtN3.js";import"./el-checkbox-2Pfd_jhA.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-DISQ2WcR.js";import{E as he}from"./el-scrollbar-CN1-wDve.js";import{E as be}from"./el-input-number-itutldLO.js";import"./el-tag-vfGsjMGp.js";import{E as fe}from"./el-button-CVpVluks.js";import{E as ge}from"./el-image-viewer-DlFnvKX8.js";import{a as xe,E as Ce}from"./el-form-item-CIvUhgEw.js";import{E as ye,a as Ie}from"./el-select-DFB1JrP4.js";import{c as b}from"./request-BVLlgJWJ.js";import{g as we,c as I}from"./index-BrA2J1bc.js";import{e as Ee}from"./index-DfB9273X.js";import{g as Ve}from"./index-B6rogq9j.js";import{h as ke}from"./index-CLjcLQCy.js";/* empty css                   */import{E as ze}from"./index-Bs4hY4PB.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-form-item-rQ3_Yspv.js";import"./_initCloneObject-BVdjlYpI.js";import"./event-BB_Ol6Sd.js";import"./isEqual-BAypsrYp.js";import"./index-HptOkQUL.js";import"./scroll-BYu0qoGL.js";import"./castArray-BSznfAx4.js";import"./_baseClone-jXAnDigi.js";const L=z=>(pe("data-v-b649b4fc"),z=z(),ve(),z),Ue={class:"goods-reserve"},qe={class:"s-top_bar"},Ne={class:"row"},Be={class:"col col1"},Re={class:"goods-type"},je=["onClick"],Fe={class:"col col2"},Le={class:"goods-list"},Me={class:"msg"},Te=["title"],Ze=["title"],De=L(()=>o("label",{for:""},"规格(尺寸)：",-1)),$e=["title"],Oe=L(()=>o("label",{for:""},"单  价：",-1)),Pe={class:"p"},He=L(()=>o("label",{for:""},"库  存：",-1)),Qe={class:"col col3"},We={class:"table"},Xe={class:"bottom-bar"},Ye={class:"p1"},Ae={class:"p2"},Ge=ie({__name:"Reserve",setup(z){const H=ue(),f=re(),i=n(f.query.exhibitionId?Number(f.query.exhibitionId):""),p=n(f.query.exhibitorId?Number(f.query.exhibitorId):""),u=n(f.query.hallCode||""),r=n(f.query.positionCode||""),Q=f.query.clueId,S=n(0),w=n([]),E=n({}),g=n([]),M=n([]),T=n([]),Z=n([]),R=n([]);ne({});const W=(l,a=1)=>{I.addCart({exhibitorId:p.value,exhibitionId:i.value,hallCode:u.value,positionCode:r.value,id:l.id,num:a}).then(c=>{c.code===0?(b.success("添加成功"),_()):b.error(c.msg)})},X=(l,a=1)=>{I.editCart({exhibitorId:p.value,exhibitionId:i.value,hallCode:u.value,positionCode:r.value,id:l.id,num:a}).then(c=>{c.code===0?b.success("成功"):b.error(c.msg),_()})},Y=l=>{I.delCart({exhibitorId:p.value,exhibitionId:i.value,hallCode:u.value,positionCode:r.value,id:l.id,num:l.num}).then(a=>{a.code===0?(b.success("删除成功"),_()):b.error(a.msg)})},A=l=>{E.value=w.value[l]},G=()=>{Ee().then(l=>{l.code===0&&(M.value=l.data)})},D=()=>{Ve({exhibitionId:i.value}).then(l=>{l.code===0&&(T.value=l.data)})},$=()=>{we({exhibitionId:i.value}).then(l=>{l.code===0&&(Z.value=l.data)})},j=()=>{R.value=[],ke({exhibitionId:i.value,hallCode:u.value}).then(l=>{l.code===0&&(R.value=l.data)})},O=()=>{I.getMaterial({exhibitionId:i.value}).then(l=>{l.code===0&&(w.value=l.data,w.value.length>0?E.value=w.value[0]:E.value={})})},_=()=>{if(!i.value||!u.value||!r.value){g.value=[];return}I.getCart({exhibitorId:p.value,exhibitionId:i.value,hallCode:u.value,positionCode:r.value}).then(l=>{l.code===0&&(g.value=l.data)})},U=n(!1),J=()=>{U.value=!0,I.create({clueId:Q,exhibitionId:i.value,exhibitorId:p.value,hallCode:u.value,positionCode:r.value,price:S.value,data:g.value.map(l=>({...l,remark:""}))}).then(l=>{l.code===0?(b.success("提交成功"),H.go(-1)):b.error(l.msg),U.value=!1}).catch(l=>{U.value=!1})};N(()=>i.value,l=>{u.value="",r.value="",p.value="",D(),$(),j(),O(),_()}),N(()=>p.value,l=>{_()}),N(()=>u.value,l=>{r.value="",j(),_()}),N(()=>r.value,l=>{_()});const K=de(()=>{let l=0;return g.value.forEach(a=>{l+=a.price*a.num}),S.value=l,l});return G(),D(),$(),j(),O(),_(),(l,a)=>{const c=ye,q=Ie,V=xe,ee=Ce,le=ge,F=fe,oe=he,k=_e,te=be,ae=me,se=ze;return d(),m("div",Ue,[o("div",qe,[t(ee,{inline:!0},{default:s(()=>[t(V,{label:"展会名称",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),placeholder:"请选择展会名称",disabled:""},{default:s(()=>[(d(!0),m(C,null,y(M.value,e=>(d(),B(c,{key:e.id,label:e.exhibitionName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"参展企业",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),placeholder:"请选择参展企业",disabled:""},{default:s(()=>[(d(!0),m(C,null,y(T.value,e=>(d(),B(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"展馆",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),placeholder:"请选择展馆"},{default:s(()=>[(d(!0),m(C,null,y(Z.value,e=>(d(),B(c,{key:e.code,label:e.code,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"展位号",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value=e),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"添加展位号",style:{width:"240px"}},{default:s(()=>[(d(!0),m(C,null,y(R.value,e=>(d(),B(c,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),o("div",Ne,[o("div",Be,[o("ul",Re,[(d(!0),m(C,null,y(w.value,(e,v)=>(d(),m("li",{key:v,onClick:P=>A(v),class:ce({active:e.project===E.value.project})},x(e.project),11,je))),128))])]),o("div",Fe,[t(oe,null,{default:s(()=>[o("div",Le,[(d(!0),m(C,null,y(E.value.data,(e,v)=>(d(),m("li",{key:v},[t(le,{style:{width:"100%",height:"200px"},src:e.img,"preview-src-list":[e.img],fit:"contain"},null,8,["src","preview-src-list"]),o("div",Me,[o("p",{class:"title",title:e.position},x(e.position),9,Te),o("p",{class:"p",title:e.size},[De,h(x(e.size),1)],8,Ze),o("p",{class:"p",title:e.price+"元/"+e.unit},[Oe,o("span",null,x(e.price+"元/"+e.unit),1)],8,$e),o("p",Pe,[He,h(x(e.stock),1)])]),t(F,{type:"primary",onClick:P=>W(e),disabled:e.stock<=0,style:{width:"100%"}},{default:s(()=>[h("加入购物车")]),_:2},1032,["onClick","disabled"])]))),128))])]),_:1})]),o("div",Qe,[o("div",We,[t(ae,{data:g.value,border:""},{default:s(()=>[t(k,{label:"服务项目",prop:"project","min-width":"120"}),t(k,{label:"位置/版面",prop:"position","min-width":"120"}),t(k,{label:"规格",prop:"size"}),t(k,{label:"单价(RMB)",prop:"price","min-width":"120"}),t(k,{label:"数量",width:"200px"},{default:s(e=>[t(te,{modelValue:e.row.num,"onUpdate:modelValue":v=>e.row.num=v,min:1,size:"small",onChange:(v,P)=>{X(e.row,v)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),t(F,{type:"danger",link:"",onClick:v=>Y(e.row),style:{"margin-left":"10px"},icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),o("div",Xe,[o("div",Ye,[o("span",null,[h("已选物料 "),o("b",null,x(g.value.length),1),h(" 项")]),h(),o("span",null,[h("物料金额 "),o("b",null,"¥"+x(K.value),1)])]),o("div",Ae,[t(V,{label:"最终金额",style:{width:"100%","margin-bottom":"0"}},{default:s(()=>[t(se,{modelValue:S.value,"onUpdate:modelValue":a[4]||(a[4]=e=>S.value=e)},null,8,["modelValue"])]),_:1})]),t(F,{type:"primary",style:{width:"100%"},onClick:J,loading:U.value,disabled:g.value.length<=0},{default:s(()=>[h("提交")]),_:1},8,["loading","disabled"])])])])])}}}),kl=Se(Ge,[["__scopeId","data-v-b649b4fc"]]);export{kl as default};
