import{d as be,l as m,s as ee,c as oe,t as le,b as h,O as c,Q as F,R as o,i as t,F as b,W as ge,a5 as ye,N as te,o as p,P as _,U as P,h as V,e as S,a3 as Pe,X as Ve,Y as Ce}from"./index-Cvxdud8X.js";import{E as we}from"./el-dialog-CRCAj4Tn.js";/* empty css                   */import{E as Ee}from"./el-col-DCM4cYhg.js";import{E as Ne}from"./el-scrollbar-XryityOC.js";import{a as ke,E as Ie}from"./el-form-item-DwKXY0ad.js";/* empty css                 */import{E as xe}from"./el-input-number-BeoEeDnN.js";import{E as Ue}from"./el-button-BduWogw9.js";import"./el-tag-DHCDDT8A.js";import{E as Fe,a as Se}from"./el-select-DThfN3Ul.js";import"./el-popper-Drp6kb6z.js";/* empty css                       */import{E as qe,a as Be}from"./el-radio-BApBOlyK.js";import{E as Oe}from"./el-image-viewer-CDpcgidc.js";import{a as Re}from"./index-DtGXZbGI.js";import{h as $e,p as Je}from"./index-D4fQLtVN.js";import{_ as q}from"./rules-F8IXRWD9.js";import{E as De}from"./index-BfRblS7Z.js";import{b as Le}from"./request-BPmFHmyv.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-zqDuwZts.js";import"./use-form-item-BTqf1lu5.js";import"./scroll-CFWMFtgW.js";import"./vnode-DZwMTVZ3.js";import"./refs-BGhzDLti.js";import"./event-BB_Ol6Sd.js";import"./castArray-9OQV8TA5.js";import"./_baseClone-CJkpBpD4.js";import"./_initCloneObject-qW5ZcdA1.js";import"./index-DEDqRCPu.js";import"./isEqual-DKzOzQr_.js";const ze=k=>(Ve("data-v-c0b45dba"),k=k(),Ce(),k),Ge={class:"booth-reserve"},Xe={class:"l"},je={class:"title"},Ae={class:"img-box"},He={class:"r"},Qe={class:"form-box"},We=ze(()=>c("div",null,"预定展位",-1)),Ye={style:{"text-align":"center"}},Ke={style:{padding:"15px"}},Me={class:"dialog-footer"},Ze=be({__name:"Reserve",setup(k){const ae=ge(),v=ye(),T=v.query.clueId,I=v.query.exhibitionId,z=v.query.exhibitorId,g=m(v.query.hallCode),B=m([]),x=m([]),G=m([]),X=m([]),j=m([]),A=m([]),H={1:"%",2:"￥"},l=ee({clueId:T,exhibitionId:I,exhibitorId:z,add:[],discount:[],position:[{hallCode:g.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let r=JSON.parse(v.query.data);l.clueId=r.clueId,l.exhibitionId=r.exhibitionId,l.exhibitorId=r.exhibitorId,l.position=r.position,l.add=r.add,l.discount=r.discount}m({});const O=m(null),a=ee({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ie=r=>{a.form.unitPrice=Number(r.price),a.form.product=r.text,a.form.num=r.num},re=oe(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),ne=(r,e,s)=>{e.length<=0||a.form.width<=0?s(new Error("例如 3X3,且尺寸不可为0和负数")):s()},ue=()=>{let r=l.position.length;R(g.value,r),l.position.push({hallCode:g.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},R=(r,e)=>{x.value[e]=[],$e({exhibitionId:I,hallCode:r}).then(s=>{x.value[e]=s.data})};R(g.value,0);const de=(r,e,s,i)=>{if(!e)return s(new Error("必填项"));Je({exhibitionId:I,exhibitorId:z,hallCode:i,positionCode:e}).then(f=>{f.code===0&&f.data.status?s():s(new Error("该展位已锁定"))})},$=m(null),se=()=>{$.value.validate().then(r=>{r&&ae.push({name:"BoothCreateOrder",query:{...v.query,companyName:U.value,data:JSON.stringify(l)}})}).catch(()=>{})},pe=r=>{a.index=r,a.form.product="",a.form.unitPrice="",a.form.length=0,a.form.width=0,a.form.num=1,a.show=!0},ce=()=>{O.value.validate().then(r=>{if(!r)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=Q(s),f=W(s);l.position[a.index].product=a.form.product,l.position[a.index].unitPrice=a.form.unitPrice,l.position[a.index].length=a.form.length,l.position[a.index].width=a.form.width,l.position[a.index].area=e,l.position[a.index].costPrice=Number(s.toFixed(2)),l.position[a.index].addPrice=Number(i.toFixed(2)),l.position[a.index].discountPrice=Number(f.toFixed(2)),l.position[a.index].finalPrice=Number((s+i-f).toFixed(2)),$.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},Q=r=>{let e=0;return l.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e},W=r=>{let e=0;return l.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e};le(()=>l.add,r=>{l.position.forEach(e=>{e.addPrice=Number(Q(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),le(()=>l.discount,r=>{l.position.forEach(e=>{e.discountPrice=Number(W(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const U=m(""),J=m(!0);Re({clueId:T,exhibitionId:I}).then(r=>{let e=r.data;G.value=e.attachPrice.add,X.value=e.attachPrice.discount,j.value=e.companyBrand,A.value=e.unitPrice,B.value=e.exhibitionHall,U.value=e.companyName,J.value=e.isNew});const Y=oe(()=>{let r=B.value.find(e=>e.code===g.value);return r?r.img:""});return(r,e)=>{const s=Oe,i=ke,f=qe,K=Be,C=Fe,w=Se,E=Ue,N=De,D=xe,me=te("DeleteFilled"),M=Le,Z=Ie,fe=Ne,L=Ee,_e=te("Close"),he=we;return p(),h(b,null,[c("div",Ge,[c("div",Xe,[c("div",je,[c("span",null,F(U.value),1),c("span",null,"展馆号："+F(g.value),1)]),c("div",Ae,[o(s,{style:{width:"100%",height:"100%"},src:Y.value,"preview-src-list":[Y.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",He,[c("div",Qe,[o(fe,{height:"100%"},{default:t(()=>[o(Z,{ref_key:"formRef",ref:$,model:l,"label-width":"auto",class:"form","label-position":"left"},{default:t(()=>[We,o(i,{label:"企业名称"},{default:t(()=>[_(F(U.value),1)]),_:1}),o(i,{label:"新展商"},{default:t(()=>[o(K,{modelValue:J.value,"onUpdate:modelValue":e[0]||(e[0]=n=>J.value=n),disabled:""},{default:t(()=>[o(f,{value:!0},{default:t(()=>[_("是")]),_:1}),o(f,{value:!1},{default:t(()=>[_("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:t(()=>[o(w,{modelValue:l.add,"onUpdate:modelValue":e[1]||(e[1]=n=>l.add=n),multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,P(G.value,(n,u)=>(p(),V(C,{key:u,label:n.text+" "+n.price+H[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:t(()=>[o(w,{modelValue:l.discount,"onUpdate:modelValue":e[2]||(e[2]=n=>l.discount=n),multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,P(X.value,(n,u)=>(p(),V(C,{key:u,label:n.text+" "+n.price+H[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:t(()=>[o(E,{icon:"Plus",onClick:ue},{default:t(()=>[_("添加展位")]),_:1})]),_:1}),(p(!0),h(b,null,P(l.position,(n,u)=>(p(),h("div",{class:"item",key:u},[o(i,{label:"展馆号",prop:`position[${u}].hallCode`,rules:S(q).required},{default:t(()=>[o(w,{modelValue:l.position[u].hallCode,"onUpdate:modelValue":d=>l.position[u].hallCode=d,placeholder:"请选择",onChange:()=>{R(n.hallCode,u),g.value=n.hallCode}},{default:t(()=>[(p(!0),h(b,null,P(B.value,(d,y)=>(p(),V(C,{key:y,label:d.code,value:d.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${u}].positionCode`,rules:[{validator:(d,y,ve)=>de(d,y,ve,l.position[u].hallCode),trigger:"change"}]},{default:t(()=>[o(w,{modelValue:l.position[u].positionCode,"onUpdate:modelValue":d=>l.position[u].positionCode=d,filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,P(x.value[u],(d,y)=>(p(),V(C,{key:y,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:t(()=>[o(w,{modelValue:l.position[u].companyBrand,"onUpdate:modelValue":d=>l.position[u].companyBrand=d,multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,P(j.value,(d,y)=>(p(),V(C,{key:y,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:t(()=>[o(K,{modelValue:l.position[u].type,"onUpdate:modelValue":d=>l.position[u].type=d},{default:t(()=>[o(f,{value:1},{default:t(()=>[_("标准")]),_:1}),o(f,{value:2},{default:t(()=>[_("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${u}].product`,rules:S(q).required},{default:t(()=>[o(E,{size:"small",onClick:d=>pe(u)},{default:t(()=>[_("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),l.position[u].product?(p(),V(i,{key:0,label:" "},{default:t(()=>[c("div",null,F(l.position[u].product+" "+l.position[u].area+"㎡"),1)]),_:2},1024)):Pe("",!0),o(i,{label:"展位原价"},{default:t(()=>[o(N,{modelValue:l.position[u].costPrice,"onUpdate:modelValue":d=>l.position[u].costPrice=d,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:t(()=>[o(N,{"model-value":l.position[u].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:t(()=>[o(N,{"model-value":l.position[u].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${u}].finalPrice`,rules:S(q).required},{default:t(()=>[o(D,{modelValue:l.position[u].finalPrice,"onUpdate:modelValue":d=>l.position[u].finalPrice=d,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",Ye,[o(E,{link:"",type:"danger",onClick:d=>{l.position.splice(u,1),x.value.splice(u,1)}},{default:t(()=>[o(M,null,{default:t(()=>[o(me)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",Ke,[o(E,{type:"primary",onClick:se,style:{width:"100%"}},{default:t(()=>[_("确认")]),_:1})])])]),o(he,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=n=>a.show=n),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{O.value.resetFields()})},{footer:t(()=>[c("div",Me,[o(E,{onClick:e[6]||(e[6]=n=>a.show=!1)},{default:t(()=>[_("取消")]),_:1}),o(E,{type:"primary",onClick:ce},{default:t(()=>[_("确定")]),_:1})])]),default:t(()=>[o(Z,{ref_key:"ggFormRef",ref:O,model:a.form,"label-width":"auto","label-position":"left"},{default:t(()=>[o(i,{label:"产品名称",prop:"product",rules:S(q).required},{default:t(()=>[o(w,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=n=>a.form.product=n),placeholder:"",onChange:ie},{default:t(()=>[(p(!0),h(b,null,P(A.value,n=>(p(),V(C,{key:n.id,label:n.text+" "+n.price+"/"+n.num+"/㎡",value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:t(()=>[o(N,{"model-value":re.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",rules:[{validator:ne,trigger:"blur"}]},{default:t(()=>[o(L,{span:11},{default:t(()=>[o(i,{label:""},{default:t(()=>[o(D,{modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.length=n),min:0,controls:!1,style:{flex:"1"}},null,8,["modelValue"])]),_:1})]),_:1}),o(L,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:t(()=>[o(M,null,{default:t(()=>[o(_e)]),_:1})]),_:1}),o(L,{span:11},{default:t(()=>[o(i,{label:""},{default:t(()=>[o(D,{modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.width=n),min:0,controls:!1,style:{flex:"1"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:t(()=>[o(N,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),qo=Te(Ze,[["__scopeId","data-v-c0b45dba"]]);export{qo as default};
