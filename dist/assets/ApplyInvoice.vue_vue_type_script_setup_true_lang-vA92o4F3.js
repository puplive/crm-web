import{d as B,l as _,s as q,o as D,h as N,i as t,O as h,R as l,P as d,e as v}from"./index-BwZP8RHo.js";import{E as w}from"./dialog-XbbRQpkx.js";/* empty css                */import{a as z,E as A}from"./form-item-D8rBQRE1.js";import{E as M}from"./progress-CR1qrQyk.js";import{E as P}from"./button-CwtZiwzE.js";/* empty css                    */import{E as G,a as L}from"./radio-DtmdxbOW.js";/* empty css              */import{i as O}from"./index-DBQlKbv7.js";import{u as S}from"./index-Dk17Bzwd.js";import{_ as g}from"./rules-F8IXRWD9.js";/* empty css                */import{c as i}from"./request-BWwlW5Sy.js";import{E as T}from"./index-DHreb6Dp.js";const $={class:"dialog-footer"},fe=B({__name:"ApplyInvoice",emits:["callback"],setup(H,{expose:b,emit:y}){const n=_(null),f=_(!1),p=_(null),e=q({show:!1,form:{paymentId:"",title:"",socialCode:"",contact:"",phone:"",email:"",type:1,status:1,invoiceCode:"",img:""}}),C=()=>{n.value.validate(r=>{r&&(f.value=!0,O.apply(e.form).then(o=>{f.value=!1,o.code===0?(i.success("申请成功"),e.show=!1,F("callback")):i.error(o.msg)}).catch(o=>{f.value=!1,i.error("申请失败")}))})},E=r=>{e.show=!0,e.form.paymentId=r.id,e.form.title=r.title,e.form.socialCode=r.socialCode,e.form.contact=r.contact,e.form.phone=r.phone,e.form.email=r.email,e.form.type=r.type||1,e.form.status=r.status||1,e.form.invoiceCode=r.invoiceCode,e.form.img=r.img},U=r=>r.size/1024/1024>3?(i.error("文件大小不能超过 3MB!"),!1):!0,k=r=>{f.value=!0;let o=new FormData;return o.append("upload",r.file),new Promise((s,m)=>{S(o).then(u=>{u.code===0?s(u.data):(m(u),i.error("上传失败"),p.value.clearFiles()),f.value=!1}).catch(u=>{m(u),i.error("上传失败"),p.value.clearFiles(),f.value=!1})})},F=y;return b({setApply:E}),(r,o)=>{const s=T,m=z,u=G,V=L,c=P,R=M,I=A,x=w;return D(),N(x,{modelValue:e.show,"onUpdate:modelValue":o[9]||(o[9]=a=>e.show=a),title:"申请发票",width:"500",draggable:"",onClose:o[10]||(o[10]=()=>{n.value.resetFields()})},{footer:t(()=>[h("div",$,[l(c,{onClick:o[8]||(o[8]=a=>e.show=!1)},{default:t(()=>[d("取消")]),_:1}),l(c,{type:"primary",onClick:C,loading:f.value},{default:t(()=>[d("确定")]),_:1},8,["loading"])])]),default:t(()=>[l(I,{ref_key:"formRef",ref:n,model:e.form,"label-width":"auto","label-position":"left"},{default:t(()=>[l(m,{label:"发票抬头",prop:"title",rules:[{required:!0,message:"请填写发票抬头",trigger:"blur"}]},{default:t(()=>[l(s,{modelValue:e.form.title,"onUpdate:modelValue":o[0]||(o[0]=a=>e.form.title=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"社会信用代码",prop:"socialCode",rules:[{required:!0,message:"请填写社会信用代码",trigger:"blur"}]},{default:t(()=>[l(s,{modelValue:e.form.socialCode,"onUpdate:modelValue":o[1]||(o[1]=a=>e.form.socialCode=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"联系人",prop:"contact",rules:[{required:!0,message:"请填写联系人",trigger:"blur"}]},{default:t(()=>[l(s,{modelValue:e.form.contact,"onUpdate:modelValue":o[2]||(o[2]=a=>e.form.contact=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号",prop:"phone",rules:v(g).phone},{default:t(()=>[l(s,{modelValue:e.form.phone,"onUpdate:modelValue":o[3]||(o[3]=a=>e.form.phone=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"]),l(m,{label:"邮箱",prop:"email",rules:v(g).email},{default:t(()=>[l(s,{modelValue:e.form.email,"onUpdate:modelValue":o[4]||(o[4]=a=>e.form.email=a),autocomplete:"off"},null,8,["modelValue"])]),_:1},8,["rules"]),l(m,{label:"发票类型"},{default:t(()=>[l(V,{modelValue:e.form.type,"onUpdate:modelValue":o[5]||(o[5]=a=>e.form.type=a)},{default:t(()=>[l(u,{value:1},{default:t(()=>[d("电子专票")]),_:1}),l(u,{value:2},{default:t(()=>[d("电子普票")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"开票状态"},{default:t(()=>[l(V,{modelValue:e.form.status,"onUpdate:modelValue":o[6]||(o[6]=a=>e.form.status=a)},{default:t(()=>[l(u,{value:1},{default:t(()=>[d("待开票")]),_:1}),l(u,{value:2},{default:t(()=>[d("已开票")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"发票号",prop:"invoiceCode"},{default:t(()=>[l(s,{modelValue:e.form.invoiceCode,"onUpdate:modelValue":o[7]||(o[7]=a=>e.form.invoiceCode=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"发票附件",prop:"img"},{default:t(()=>[l(R,{ref_key:"uploadRef",ref:p,"on-success":(a,J,K)=>{e.form.img=a.url},"before-upload":U,"http-request":k},{default:t(()=>[l(c,{link:"",type:"primary",size:"small"},{default:t(()=>[d("上传附件")]),_:1})]),_:1},8,["on-success"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});export{fe as _};
