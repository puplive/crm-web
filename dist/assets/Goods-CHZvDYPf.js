import{d as K,l as u,s as k,o as b,f as D,P as c,S as e,w as o,Q as i,R as f,c as C,X as E,F as U,a as W,au as Y,Z as ee,a7 as te}from"./index-CqGmAY_u.js";/* empty css                     */import{E as ae}from"./el-dialog-v8QaKeiT.js";/* empty css                   */import{E as oe}from"./el-progress-DhJv_DBp.js";/* empty css                 */import{E as le}from"./el-pagination-C94Vvszp.js";/* empty css                 */import"./el-tag-uPOr0Gox.js";/* empty css                  */import"./el-scrollbar-DStktWal.js";import{E as re,a as ie}from"./el-table-column-BN3t8Niw.js";import"./el-checkbox-BEIE1FTh.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-button-DpzYuNCC.js";import{T as se}from"./index-BGjDof29.js";import{a as w,b as ne}from"./index-DbkQicv_.js";import{u as pe}from"./index-Bewy8imb.js";/* empty css                       *//* empty css                   */import{E as P}from"./index-D5J-_Dfe.js";import{a as p}from"./request-BWe5mLiC.js";import{E as de}from"./index-Bd1qaB5O.js";import{E as me,a as ue}from"./index-CguX-oIt.js";import{E as ce,a as fe}from"./index-M5aUYcP_.js";import"./index-ChNZniro.js";import"./index-BJocUqJs.js";import"./scroll-Covgc6bg.js";import"./vnode-8cI36gNR.js";import"./refs-DIIzzgZO.js";import"./event-BB_Ol6Sd.js";import"./typescript-B9iuFu41.js";import"./cloneDeep-CKE_w5NT.js";import"./_baseClone-CIKtdTEW.js";import"./_initCloneObject-BTvP7gDY.js";import"./isEqual-BCKW0y_w.js";import"./index-CFhDgrYB.js";import"./index-CN0jcStv.js";import"./castArray-Ds8PJccp.js";import"./isArrayLikeObject-bNXIFdAR.js";/* empty css                                                              *//* empty css                       *//* empty css                          */import"./index-BXjaXClQ.js";import"./arrays-6TrVLtTe.js";import"./index-E146iEmP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./aria-KgdLjl5h.js";import"./validator-0OFKhMQ4.js";const _e={class:"s-flex-col",style:{height:"100%"}},ge={class:"s-table-operations"},ye={class:"s-flex-auto",style:{"min-height":"0"}},he={class:"s-table-pagination"},be={class:"s-table-pagination",style:{"justify-content":"space-between"}},we=c("span",null,"订单金额",-1),ve={style:{color:"red"}},ht=K({__name:"Goods",setup(ke){ee();const $=te(),_=u(!1),g=k({page:1,perPage:10}),z=u(0),x=u({});$.query.id;const v=u([]),F=u(null),N=u([]),n=k({show:!1,file:"",type:1,orderId:0}),L=l=>{x.value=l,g.page=1,y()},y=()=>{w.getList({...g,...x.value}).then(l=>{l.code===0?(v.value=l.data.data,z.value=l.data.total):v.value=[{}]})},I=l=>{P.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{w.revoke({id:l}).then(t=>{t.code===0?(p.success("撤销成功"),y()):p.error(t.msg)})}).catch(()=>{})},M=l=>{P.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{w.del({id:l}).then(t=>{t.code===0?(p.success("删除成功"),y()):p.error(t.msg)})}).catch(()=>{})},S=()=>{},j=u(null);let d=u([]);const q=l=>{let t=l[0];d.value=[{name:t.name,size:t.size,uid:t.uid,status:"ready",percentage:0,raw:t}]},G=l=>{const t=l.size/1024/1024<3;return t||p.error("文件大小不能超过 3MB!"),t},O=l=>{n.show=!0,n.type=1,n.orderId=l,n.file="",d.value=[]},Q=()=>{if(d.value.length===0){p.warning("请选择合同文件");return}_.value=!0;let l=new FormData;l.append("upload",d.value[0].raw),pe(l).then(t=>{t.code===0?ne.receipt({orderId:n.orderId,type:n.type,url:t.data.url}).then(s=>{s.code===0?(p.success("上传成功"),n.show=!1,y()):p.error(s.msg),_.value=!1}).catch(()=>{_.value=!1}):(p.error(t.msg),_.value=!1)}).catch(()=>{_.value=!1})},m=k({show:!1,data:{materialData:[]}}),X=l=>{w.getDetail({id:l}).then(t=>{t.code===0&&(m.data=t.data,m.show=!0)})};return y(),(l,t)=>{const s=de,r=re,T=ie,Z=le,V=me,A=ue,H=oe,B=ae,R=ce,J=fe;return b(),D(U,null,[c("div",_e,[e(se,{data:N.value,onSearch:L},null,8,["data"]),c("div",ge,[e(s,{size:"small",onClick:S},{default:o(()=>[i("批量下载合同")]),_:1}),e(s,{size:"small",onClick:S},{default:o(()=>[i("导出")]),_:1})]),c("div",ye,[e(T,{ref_key:"tableRef",ref:F,data:v.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:o(()=>[e(r,{type:"selection",width:"42"}),e(r,{prop:"orderCode",label:"订单编号"}),e(r,{prop:"companyName",label:"企业名称"}),e(r,{prop:"hallCode",label:"展馆号"}),e(r,{prop:"positionCode",label:"展位号"}),e(r,{prop:"orderPrice",label:"订单金额"}),e(r,{prop:"orderType",label:"下单方式"},{default:o(a=>[i(f({1:"代下单",2:"展商下单"}[a.row.orderType]),1)]),_:1}),e(r,{prop:"payStatus",label:"付款状态"},{default:o(a=>[i(f({0:"未付款",1:"部分付款",2:"已付款"}[a.row.payStatus]),1)]),_:1}),e(r,{prop:"receivedPrice",label:"到款金额"}),e(r,{prop:"contractStatus",label:"合同状态"},{default:o(a=>[i(f({0:"未签订",1:"已签订",2:"已回执"}[a.row.contractStatus]),1)]),_:1}),e(r,{prop:"invoiceStatus",label:"发票状态"},{default:o(a=>[i(f({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[a.row.invoiceStatus]),1)]),_:1}),e(r,{prop:"clueUser",label:"所属人"}),e(r,{prop:"authUser",label:"下单人"}),e(r,{fixed:"right",label:"操作",width:"250"},{default:o(a=>[e(s,{link:"",type:"primary",size:"small",onClick:h=>X(a.row.id)},{default:o(()=>[i("详情")]),_:2},1032,["onClick"]),a.row.contractStatus===0?(b(),C(s,{key:0,link:"",type:"primary",size:"small",onClick:h=>l.$router.push({name:"ContractTemplates",query:{id:a.row.id}})},{default:o(()=>[i("签订合同")]),_:2},1032,["onClick"])):E("",!0),a.row.contractStatus===1?(b(),C(s,{key:1,link:"",type:"primary",size:"small",onClick:h=>l.$router.push({name:"ContractTemplates",query:{id:a.row.id}})},{default:o(()=>[i("更新合同")]),_:2},1032,["onClick"])):E("",!0),e(s,{link:"",type:"primary",size:"small",onClick:h=>O(a.row.id)},{default:o(()=>[i("上传合同")]),_:2},1032,["onClick"]),a.row.orderStatus===1?(b(),C(s,{key:2,link:"",type:"primary",size:"small",onClick:h=>I(a.row.id)},{default:o(()=>[i("撤销")]),_:2},1032,["onClick"])):a.row.orderStatus===0?(b(),D(U,{key:3},[e(s,{link:"",type:"",size:"small",disabled:""},{default:o(()=>[i("已撤销")]),_:1}),e(s,{link:"",type:"primary",size:"small",onClick:h=>M(a.row.id)},{default:o(()=>[i("删除")]),_:2},1032,["onClick"])],64)):E("",!0)]),_:1})]),_:1},8,["data"])]),c("div",he,[e(Z,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:z.value,"current-page":g.page,"onUpdate:currentPage":t[0]||(t[0]=a=>g.page=a),"page-size":g.perPage,"onUpdate:pageSize":t[1]||(t[1]=a=>g.perPage=a),onChange:y},null,8,["total","current-page","page-size"])])]),e(B,{modelValue:n.show,"onUpdate:modelValue":t[5]||(t[5]=a=>n.show=a),title:"上传合同",width:"400"},{footer:o(()=>[e(s,{type:"primary",onClick:Q,loading:_.value},{default:o(()=>[i("确定")]),_:1},8,["loading"]),e(s,{onClick:t[4]||(t[4]=a=>n.show=!1)},{default:o(()=>[i("取消")]),_:1})]),default:o(()=>[e(A,{modelValue:n.type,"onUpdate:modelValue":t[2]||(t[2]=a=>n.type=a)},{default:o(()=>[e(V,{value:1},{default:o(()=>[i("电子合同")]),_:1}),e(V,{value:2},{default:o(()=>[i("纸质合同")]),_:1})]),_:1},8,["modelValue"]),e(H,{ref_key:"uploadRef",ref:j,"auto-upload":!1,limit:1,"before-upload":G,"on-exceed":q,"file-list":W(d),"onUpdate:fileList":t[3]||(t[3]=a=>Y(d)?d.value=a:d=a),style:{"margin-top":"10px"}},{default:o(()=>[e(s,{size:"small",type:"primary"},{default:o(()=>[i("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"]),e(B,{title:"订单详情",modelValue:m.show,"onUpdate:modelValue":t[6]||(t[6]=a=>m.show=a),width:"700"},{default:o(()=>[c("div",null,[e(J,null,{default:o(()=>[e(R,{label:"展会名称",style:{"margin-bottom":"0"}},{default:o(()=>[i(f(m.data.exhibitionName),1)]),_:1}),e(R,{label:"企业名称"},{default:o(()=>[i(f(m.data.exhibitorName),1)]),_:1})]),_:1}),e(T,{data:m.data.materialData,border:"","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:o(()=>[e(r,{prop:"project",label:"服务项目"}),e(r,{prop:"position",label:"位置/版面"}),e(r,{prop:"size",label:"尺寸规格"}),e(r,{prop:"num",label:"数量"}),e(r,{prop:"price",label:"单价(RMB)"}),e(r,{prop:"remark",label:"备注"})]),_:1},8,["data"]),c("div",be,[we,c("span",ve,f(m.data.price),1)])])]),_:1},8,["modelValue"])],64)}}});export{ht as default};
