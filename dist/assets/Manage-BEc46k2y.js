import{d as ee,l as p,s as T,b as k,O as v,R as l,i as a,F as U,W as le,a5 as oe,L as B,o as x,P as s,U as D,h as z,e as te}from"./index-Dz1Y8LWb.js";import{g as ae,E as ie}from"./el-progress-CorVyrL8.js";import{E as re}from"./el-dialog-Blg6ezlA.js";/* empty css                   */import{a as de,E as se}from"./el-form-item-ba9kzpCm.js";import{E as ne}from"./el-row-DP9NE92J.js";import{E as ue}from"./el-col-C-5Tntsb.js";/* empty css                 */import"./el-tag-CTgZ5iEN.js";import{E as pe,a as me}from"./el-select-DNk8878i.js";import"./el-scrollbar-DfbbODeW.js";import"./el-popper-C9-796k1.js";import{E as fe}from"./el-pagination-iwKI8VB7.js";import{E as ce,a as be}from"./el-table-column-g1ii7CMN.js";import"./el-checkbox-BDy7Qsnj.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{T as he}from"./index-BTKyx4YN.js";import{b as ge,a as _e,c as ve,d as xe,e as we,f as Ee}from"./index-uujTdBBJ.js";import{g as Ce}from"./index-BMExw_PR.js";import{g as Ve}from"./index-cTzV2IkG.js";/* empty css                   *//* empty css                       */import{c as u}from"./request-D7y66Ed_.js";import{E as ye}from"./index-CNguBD4w.js";import{E as ke}from"./index-DV7yTXEw.js";import{E as Ue}from"./index-HaHskoCV.js";import"./use-form-item-DptQ09ON.js";import"./cloneDeep-ArAth11S.js";import"./_baseClone-CsMyym3Q.js";import"./_initCloneObject-CCoVJgua.js";import"./isEqual-bSM8JOEW.js";import"./index-DNVrDi-y.js";import"./scroll-B9QXGJQj.js";import"./vnode-C-GuxPjy.js";import"./refs-DqzTb2-3.js";import"./event-BB_Ol6Sd.js";import"./castArray-CNAh-MPJ.js";import"./tool-BQQRKqby.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./aria-KgdLjl5h.js";import"./validator-Dzofbpp1.js";const Ie={class:"s-flex-col",style:{height:"100%"}},Pe={class:"s-table-operations"},Fe={class:"s-flex-auto",style:{"min-height":"0"}},Re={class:"s-table-pagination"},qe={class:"dialog-footer"},Cl=ee({__name:"Manage",setup(Te){le();const b=oe().query.id,V=p([]),I=p(null),w=p(null),f=p(!1),E=p(!1),r=T({id:"",exhibitionId:b,hallCode:"",positionCode:"",standardPrice:0,specialPrice:0,specialUnit:1,length:0,width:0,remark:"",exhibitor:"",exhibitorId:""}),S={hallCode:[{required:!0,message:"请输入大厅号",trigger:"blur"}],positionCode:[{required:!0,message:"请输入位置号",trigger:"blur"}],standardPrice:[{required:!0,message:"请输入标准展位单价",trigger:"blur"},{validator:(o,e,t)=>{e<=0?t(new Error("不能小于0")):t()}}],specialPrice:[{required:!0,message:"请输入特装展位单价",trigger:"blur"},{validator:(o,e,t)=>{e<=0?t(new Error("不能小于0")):t()}}],specialUnit:[{required:!0,message:"请选择单位",trigger:"blur"}],length:[{required:!0,message:"请输入长度",trigger:"blur"},{validator:(o,e,t)=>{e<=0?t(new Error("必须大于0")):t()}}],width:[{required:!0,message:"请输入宽度",trigger:"blur"},{validator:(o,e,t)=>{e<=0?t(new Error("必须大于0")):t()}}]};let C=p([]);Ce().then(o=>{o.code===0&&(C.value=o.data)});const M=p([]),g=()=>{ge({exhibitionId:b}).then(o=>{o.code===0?V.value=o.data:V.value=[]})},$=async o=>{E.value=!0,f.value=!0,await B(),w.value.resetFields(),r.hallCode=o.hallCode,r.positionCode=o.positionCode,r.standardPrice=o.standardPrice,r.specialPrice=o.specialPrice,r.specialUnit=o.specialUnit.indexOf("个")>-1?2:1,r.length=o.length,r.width=o.width,r.remark=o.remark,r.exhibitor=o.exhibitor,r.id=o.id},L=()=>{let o=I.value.getSelectionRows().map(e=>e.id);if(o.length===0){u.warning("请选择需要删除的数据");return}P(o)},P=o=>{ye.confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_e({id:o}).then(e=>{e.code===0?(u.success("删除成功"),g()):u.error(e.msg)})}).catch(()=>{})},O=async()=>{E.value=!1,f.value=!0,r.remark="",await B(),w.value.resetFields()},N=()=>{w.value.validate(o=>{if(o)if(E.value){let e=r;e.exhibitor=e.exhibitorId?C.value.find(t=>t.id===r.exhibitorId).name:"",xe(e).then(t=>{t.code===0?(u.success("编辑成功"),f.value=!1,g()):u.error(t.msg)})}else{let{id:e,...t}=r;t.exhibitor=t.exhibitorId?C.value.find(d=>d.id===r.exhibitorId).name:"",we(t).then(d=>{d.code===0?(u.success("新增成功"),f.value=!1,g()):u.error(d.msg)})}else return!1})},F=p([]);Ve({exhibitionId:b}).then(o=>{o.code===0&&(F.value=o.data)});const c=p(),n=T({show:!1,loading:!1,set:()=>{n.show=!0,console.log(c.value)},sub:()=>{n.loading=!0,c.value.submit()},dowModel:()=>{window.open("https://crm-test-1256699835.cos.ap-shanghai.myqcloud.com/importTemplate/position.xlsx","_self")}}),A=o=>{c.value.clearFiles();const e=o[0];e.uid=ae(),c.value.handleStart(e)},H=()=>{ve({exhibitionId:b}).then(o=>{o.code===0?(window.open(o.data.url,"_self"),u.success("导出成功")):u.error(o.msg)})},W=o=>{const e=o.size/1024/1024<20;return e||u.error("文件大小不能超过 20MB!"),e},j=o=>{const e=new FormData;e.append("file",o.file),e.append("exhibitionId",b),Ee(e).then(t=>{t.code===0?(u.success("导入成功"),n.show=!1,c.value.clearFiles(),g()):u.error(t.msg),n.loading=!1}).catch(t=>{n.loading=!1})},G=o=>{console.log(o)};return b&&g(),(o,e)=>{const t=ke,d=be,J=ce,K=fe,_=pe,y=me,m=de,h=Ue,R=ue,Q=ne,X=se,q=re,Y=ie;return x(),k(U,null,[v("div",Ie,[l(he,{data:M.value,onSearch:G},null,8,["data"]),v("div",Pe,[l(t,{size:"small",onClick:O},{default:a(()=>[s("新增")]),_:1}),l(t,{size:"small",onClick:e[0]||(e[0]=i=>n.set())},{default:a(()=>[s("导入")]),_:1}),l(t,{size:"small",onClick:H},{default:a(()=>[s("导出")]),_:1}),l(t,{size:"small",onClick:L},{default:a(()=>[s("删除")]),_:1})]),v("div",Fe,[l(J,{ref_key:"tableRef",ref:I,data:V.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:a(()=>[l(d,{type:"selection",width:"42"}),l(d,{prop:"id",label:"ID",width:"50"}),l(d,{prop:"hallCode",label:"展馆号"}),l(d,{prop:"positionCode",label:"展位号"}),l(d,{prop:"standardPrice",label:"标摊/元","min-width":"120"}),l(d,{prop:"specialPrice",label:"特装/元","min-width":"120"}),l(d,{prop:"specialUnit",label:"特装/㎡/个","min-width":"120"}),l(d,{prop:"length",label:"长"}),l(d,{prop:"width",label:"宽"}),l(d,{prop:"remark",label:"备注"}),l(d,{prop:"exhibitor",label:"参展商"}),l(d,{prop:"createTime",label:"创建时间","min-width":"120"}),l(d,{fixed:"right",label:"操作",width:"150"},{default:a(i=>[l(t,{link:"",type:"primary",onClick:Z=>$(i.row)},{default:a(()=>[s("编辑")]),_:2},1032,["onClick"]),l(t,{link:"",type:"danger",onClick:Z=>P([i.row.id])},{default:a(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),v("div",Re,[l(K,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:1e3})])]),l(q,{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=i=>f.value=i),title:E.value?"编辑":"新增展位信息",width:"500",draggable:""},{footer:a(()=>[v("div",qe,[l(t,{onClick:e[10]||(e[10]=i=>f.value=!1)},{default:a(()=>[s("取消")]),_:1}),l(t,{type:"primary",onClick:N},{default:a(()=>[s("确定")]),_:1})])]),default:a(()=>[l(X,{ref_key:"formRef",ref:w,model:r,rules:S,"label-width":"auto","label-position":"left"},{default:a(()=>[l(m,{label:"展馆号",prop:"hallCode"},{default:a(()=>[l(y,{modelValue:r.hallCode,"onUpdate:modelValue":e[1]||(e[1]=i=>r.hallCode=i),placeholder:"请选择"},{default:a(()=>[(x(!0),k(U,null,D(F.value,i=>(x(),z(_,{key:i.code,label:i.code,value:i.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"展位号",prop:"positionCode"},{default:a(()=>[l(h,{modelValue:r.positionCode,"onUpdate:modelValue":e[2]||(e[2]=i=>r.positionCode=i),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"标准展位",prop:"standardPrice"},{default:a(()=>[l(h,{modelValue:r.standardPrice,"onUpdate:modelValue":e[3]||(e[3]=i=>r.standardPrice=i),autocomplete:"off",type:"number"},{append:a(()=>[s("元/个")]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"特装展位",prop:"specialPrice"},{default:a(()=>[l(h,{modelValue:r.specialPrice,"onUpdate:modelValue":e[5]||(e[5]=i=>r.specialPrice=i),autocomplete:"off",type:"number"},{append:a(()=>[l(y,{modelValue:r.specialUnit,"onUpdate:modelValue":e[4]||(e[4]=i=>r.specialUnit=i),placeholder:"请选择",style:{width:"120px"}},{default:a(()=>[l(_,{label:"元/㎡",value:1}),l(_,{label:"元/个",value:2})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(Q,null,{default:a(()=>[l(R,{span:12},{default:a(()=>[l(m,{label:"长",prop:"length"},{default:a(()=>[l(h,{modelValue:r.length,"onUpdate:modelValue":e[6]||(e[6]=i=>r.length=i),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),l(R,{span:12},{default:a(()=>[l(m,{label:"宽",prop:"width"},{default:a(()=>[l(h,{modelValue:r.width,"onUpdate:modelValue":e[7]||(e[7]=i=>r.width=i),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{label:"备注"},{default:a(()=>[l(h,{modelValue:r.remark,"onUpdate:modelValue":e[8]||(e[8]=i=>r.remark=i),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),l(m,{label:"参展商",prop:"exhibitorId"},{default:a(()=>[l(y,{modelValue:r.exhibitorId,"onUpdate:modelValue":e[9]||(e[9]=i=>r.exhibitorId=i),placeholder:"请选择"},{default:a(()=>[l(_,{label:"无",value:""}),(x(!0),k(U,null,D(te(C),i=>(x(),z(_,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(q,{modelValue:n.show,"onUpdate:modelValue":e[13]||(e[13]=i=>n.show=i),title:"导入展位信息",width:"500",draggable:"",onClose:e[14]||(e[14]=()=>{c.value.clearFiles()})},{footer:a(()=>[l(t,{onClick:e[12]||(e[12]=i=>n.show=!1)},{default:a(()=>[s("取消")]),_:1}),l(t,{type:"primary",onClick:n.sub,loading:n.loading},{default:a(()=>[s("确定")]),_:1},8,["onClick","loading"])]),default:a(()=>[l(t,{type:"",onClick:n.dowModel,style:{"margin-bottom":"20px"}},{default:a(()=>[s("下载导入模板")]),_:1},8,["onClick"]),l(Y,{ref_key:"uploadRef",ref:c,"before-upload":W,"http-request":j,accept:".xls,.xlsx","on-exceed":A,limit:"1",multiple:!1,"auto-upload":!1},{default:a(()=>[l(t,{type:"primary"},{default:a(()=>[s("选择文件")]),_:1})]),_:1},512)]),_:1},8,["modelValue"])],64)}}});export{Cl as default};
