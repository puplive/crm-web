import{d as Pe,l as m,s as Z,c as ee,t as oe,b as h,O as c,Q as k,R as o,i as l,F as g,W as Ve,a5 as we,N as le,o as p,P as f,U as w,h as y,e as I,a3 as Ce,X as Ee,Y as xe}from"./index-B_yftjoG.js";import{E as Ne}from"./el-dialog-BJAbQ0Qa.js";/* empty css                   */import{E as ke}from"./el-col-6jm_uSGe.js";import{E as Ie}from"./el-scrollbar-CN1-wDve.js";import{a as Ue,E as Fe}from"./el-form-item-CIvUhgEw.js";/* empty css                 */import{E as qe}from"./el-input-number-itutldLO.js";import{E as Se}from"./el-button-CVpVluks.js";/* empty css                         */import"./el-popper-DISQ2WcR.js";import"./el-tag-vfGsjMGp.js";import{E as Be,a as Oe}from"./el-select-DFB1JrP4.js";/* empty css                       */import{E as Re,a as De}from"./el-radio-Cic3Sc8h.js";import{E as $e}from"./el-image-viewer-DlFnvKX8.js";import{a as Je}from"./index-BrA2J1bc.js";import{h as Le,p as Te}from"./index-CLjcLQCy.js";import{_ as U}from"./rules-F8IXRWD9.js";import{E as ze}from"./index-Bs4hY4PB.js";import{E as Ae,a as Ge,b as je}from"./index-BBtUwMWl.js";import{b as He}from"./request-BVLlgJWJ.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-B5kCaSuj.js";import"./use-form-item-rQ3_Yspv.js";import"./scroll-BYu0qoGL.js";import"./vnode-CfwxIUwW.js";import"./refs-3104v0s-.js";import"./event-BB_Ol6Sd.js";import"./castArray-BSznfAx4.js";import"./_baseClone-jXAnDigi.js";import"./_initCloneObject-BVdjlYpI.js";import"./index-HptOkQUL.js";import"./isEqual-BAypsrYp.js";const Qe=F=>(Ee("data-v-72244177"),F=F(),xe(),F),We={class:"booth-reserve"},Xe={class:"l"},Ye={class:"title"},Ke={class:"img-box"},Ze={class:"r"},eo={class:"form-box"},oo=Qe(()=>c("div",null,"预定展位",-1)),lo={key:1,style:{width:"270px","text-align":"center",padding:"10px"}},to={style:{"text-align":"center"}},ao={style:{padding:"15px"}},io={class:"dialog-footer"},no=Pe({__name:"Reserve",setup(F){const te=Ve(),v=we(),L=v.query.clueId,q=v.query.exhibitionId,T=v.query.exhibitorId,P=m(v.query.hallCode),B=m([]),E=m([]),z=m([]),A=m([]),G=m([]),j=m([]),H={1:"%",2:"￥"},t=Z({clueId:L,exhibitionId:q,exhibitorId:T,add:[],discount:[],position:[{hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let n=JSON.parse(v.query.data);t.clueId=n.clueId,t.exhibitionId=n.exhibitionId,t.exhibitorId=n.exhibitorId,t.position=n.position,t.add=n.add,t.discount=n.discount}m({});const O=m(null),a=Z({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ae=n=>{a.form.unitPrice=Number(n.price),a.form.product=n.text,a.form.num=n.num},ie=ee(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),ne=(n,e,s)=>{e.length===""||a.form.width===""?s(new Error("请填写尺寸")):e.length<=0||a.form.width<=0?s(new Error("尺寸不可为0和负数")):s()},re=()=>{let n=t.position.length;R(P.value,n),t.position.push({hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},R=(n,e)=>{E.value[e]=[],Le({exhibitionId:q,hallCode:n}).then(s=>{E.value[e]=s.data})};R(P.value,0);const de=(n,e,s,i)=>{if(!e)return s(new Error("必填项"));Te({exhibitionId:q,exhibitorId:T,hallCode:i,positionCode:e}).then(_=>{_.code===0&&_.data.status?s():s(new Error("该展位已锁定"))})},D=m(null),ue=()=>{D.value.validate().then(n=>{n&&te.push({name:"BoothCreateOrder",query:{...v.query,companyName:S.value,data:JSON.stringify(t)}})}).catch(()=>{})},se=n=>{a.index=n,a.form.product="",a.form.unitPrice="",a.form.length="",a.form.width="",a.form.num=1,a.show=!0},pe=()=>{O.value.validate().then(n=>{if(!n)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=M(s),_=Q(s);t.position[a.index].product=a.form.product,t.position[a.index].unitPrice=a.form.unitPrice,t.position[a.index].length=a.form.length,t.position[a.index].width=a.form.width,t.position[a.index].area=e,t.position[a.index].costPrice=Number(s.toFixed(2)),t.position[a.index].addPrice=Number(i.toFixed(2)),t.position[a.index].discountPrice=Number(_.toFixed(2)),t.position[a.index].finalPrice=Number((s+i-_).toFixed(2)),D.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},M=n=>{let e=0;return t.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=n*i.price/100:i.unit===2&&(e+=i.price)}),e},Q=n=>{let e=0;return t.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=n*i.price/100:i.unit===2&&(e+=i.price)}),e};oe(()=>t.add,n=>{t.position.forEach(e=>{e.addPrice=Number(M(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),oe(()=>t.discount,n=>{t.position.forEach(e=>{e.discountPrice=Number(Q(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const S=m(""),$=m(!0);Je({clueId:L,exhibitionId:q}).then(n=>{let e=n.data;z.value=e.attachPrice.add,A.value=e.attachPrice.discount,G.value=e.companyBrand,j.value=e.unitPrice,B.value=e.exhibitionHall,S.value=e.companyName,$.value=e.isNew});const W=ee(()=>{let n=B.value.find(e=>e.code===P.value);return n?n.img:""});return(n,e)=>{const s=$e,i=Ue,_=Re,X=De,x=Be,N=Oe,C=Se,b=ze,ce=Ae,me=Ge,fe=je,_e=qe,he=le("DeleteFilled"),Y=He,K=Fe,ve=Ie,J=ke,be=le("Close"),ge=Ne;return p(),h(g,null,[c("div",We,[c("div",Xe,[c("div",Ye,[c("span",null,k(S.value),1),c("span",null,"展馆号："+k(P.value),1)]),c("div",Ke,[o(s,{style:{width:"100%",height:"100%"},src:W.value,"preview-src-list":[W.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",Ze,[c("div",eo,[o(ve,{height:"100%"},{default:l(()=>[o(K,{ref_key:"formRef",ref:D,model:t,"label-width":"auto",class:"form","label-position":"left"},{default:l(()=>[oo,o(i,{label:"企业名称"},{default:l(()=>[f(k(S.value),1)]),_:1}),o(i,{label:"新展商"},{default:l(()=>[o(X,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=d=>$.value=d),disabled:""},{default:l(()=>[o(_,{value:!0},{default:l(()=>[f("是")]),_:1}),o(_,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:l(()=>[o(N,{modelValue:t.add,"onUpdate:modelValue":e[1]||(e[1]=d=>t.add=d),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(z.value,(d,r)=>(p(),y(x,{key:r,label:d.text+" "+d.price+H[d.unit],value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:l(()=>[o(N,{modelValue:t.discount,"onUpdate:modelValue":e[2]||(e[2]=d=>t.discount=d),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(A.value,(d,r)=>(p(),y(x,{key:r,label:d.text+" "+d.price+H[d.unit],value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:re},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(p(!0),h(g,null,w(t.position,(d,r)=>(p(),h("div",{class:"item",key:r},[o(i,{label:"展馆号",prop:`position[${r}].hallCode`,rules:I(U).required},{default:l(()=>[o(N,{modelValue:t.position[r].hallCode,"onUpdate:modelValue":u=>t.position[r].hallCode=u,placeholder:"请选择",onChange:()=>{R(d.hallCode,r),P.value=d.hallCode}},{default:l(()=>[(p(!0),h(g,null,w(B.value,(u,V)=>(p(),y(x,{key:V,label:u.code,value:u.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${r}].positionCode`,rules:[...I(U).required,{validator:(u,V,ye)=>de(u,V,ye,t.position[r].hallCode),trigger:"change"}]},{default:l(()=>[o(fe,{trigger:"click",style:{width:"100%"},"max-height":"300px",onCommand:u=>{t.position[r].positionCode=u}},{dropdown:l(()=>[E.value[r].length?(p(),y(me,{key:0},{default:l(()=>[(p(!0),h(g,null,w(E.value[r],(u,V)=>(p(),y(ce,{key:V,style:{width:"270px"},command:u},{default:l(()=>[f(k(u),1)]),_:2},1032,["command"]))),128))]),_:2},1024)):(p(),h("div",lo,"无数据"))]),default:l(()=>[o(b,{modelValue:t.position[r].positionCode,"onUpdate:modelValue":u=>t.position[r].positionCode=u,autocomplete:"off","suffix-icon":"ArrowDown"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onCommand"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:l(()=>[o(N,{modelValue:t.position[r].companyBrand,"onUpdate:modelValue":u=>t.position[r].companyBrand=u,multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(G.value,(u,V)=>(p(),y(x,{key:V,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:l(()=>[o(X,{modelValue:t.position[r].type,"onUpdate:modelValue":u=>t.position[r].type=u},{default:l(()=>[o(_,{value:1},{default:l(()=>[f("标准")]),_:1}),o(_,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${r}].product`,rules:I(U).required},{default:l(()=>[o(C,{size:"small",onClick:u=>se(r)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),t.position[r].product?(p(),y(i,{key:0,label:" "},{default:l(()=>[c("div",null,k(t.position[r].product+" "+t.position[r].area+"㎡"),1)]),_:2},1024)):Ce("",!0),o(i,{label:"展位原价"},{default:l(()=>[o(b,{modelValue:t.position[r].costPrice,"onUpdate:modelValue":u=>t.position[r].costPrice=u,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:l(()=>[o(b,{"model-value":t.position[r].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:l(()=>[o(b,{"model-value":t.position[r].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${r}].finalPrice`,rules:I(U).required},{default:l(()=>[o(_e,{modelValue:t.position[r].finalPrice,"onUpdate:modelValue":u=>t.position[r].finalPrice=u,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",to,[o(C,{link:"",type:"danger",onClick:u=>{t.position.splice(r,1),E.value.splice(r,1)}},{default:l(()=>[o(Y,null,{default:l(()=>[o(he)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",ao,[o(C,{type:"primary",onClick:ue,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(ge,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=d=>a.show=d),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{O.value.resetFields()})},{footer:l(()=>[c("div",io,[o(C,{onClick:e[6]||(e[6]=d=>a.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:pe},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(K,{ref_key:"ggFormRef",ref:O,model:a.form,"label-width":"auto","label-position":"left"},{default:l(()=>[o(i,{label:"产品名称",prop:"product",rules:I(U).required},{default:l(()=>[o(N,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=d=>a.form.product=d),placeholder:"",onChange:ae},{default:l(()=>[(p(!0),h(g,null,w(j.value,d=>(p(),y(x,{key:d.id,label:d.text+" "+d.price+"/"+d.num+"/㎡",value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(b,{"model-value":ie.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",required:"",rules:[{validator:ne,trigger:"blur"}]},{default:l(()=>[o(J,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=d=>a.form.length=d),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"长： 例如3"},null,8,["modelValue"])]),_:1})]),_:1}),o(J,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(Y,null,{default:l(()=>[o(be)]),_:1})]),_:1}),o(J,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=d=>a.form.width=d),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"宽： 例如3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:l(()=>[o(b,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),zo=Me(no,[["__scopeId","data-v-72244177"]]);export{zo as default};
