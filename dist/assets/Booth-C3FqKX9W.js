import{d as Z,a0 as A,t as u,z as K,y as z,b as w,X as _,$ as o,i as l,J as v,a5 as Q,am as W,a7 as s,o as y,Y as r,Z as b,h as ee,e as te,aC as oe}from"./index-BTNsYn4l.js";import{E as ae}from"./dialog-F37JrqNM.js";/* empty css                */import{E as le}from"./progress-DTATYaj1.js";/* empty css                    */import{E as re,a as ie}from"./radio-DAnjCrsR.js";import{E as ne}from"./pagination-ClJW5ciJ.js";/* empty css              */import"./tag-DPecZZqr.js";import"./select-CsqleHfU.js";import"./scrollbar-PxlWiNP8.js";import"./popper-ptH1XnbJ.js";import{E as se,a as de}from"./table-column-BoQo_Rab.js";import"./checkbox-Bbx8Cljj.js";/* empty css                */import{E as pe}from"./button-KHNYWbLN.js";import{T as ue}from"./index-CLd-TvGw.js";import{b as f}from"./index-C55KBJnj.js";import{u as me}from"./index-ugpRnFTt.js";import{d as ce}from"./index-ByKicV_X.js";import{z as fe}from"./fileZip-m51xjPNj.js";import{E as he}from"./ExhibitionChange-DYBG4soz.js";/* empty css                    *//* empty css                */import{E as R}from"./index--gt1KchQ.js";import"./index-yN5RMkFD.js";import"./use-form-item-CSqrUCeY.js";import"./scroll-CKsZOe_y.js";import"./vnode-CKQdohRT.js";import"./focus-trap-COpNCGHc.js";import"./refs-NIay4mOm.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-K0PEGfzf.js";import"./_baseClone-1jps6ISo.js";import"./_initCloneObject-BSYqRyeY.js";import"./isEqual-uxPp0GA0.js";import"./index-CF8YyeiQ.js";import"./castArray-C5algPU_.js";import"./form-item-BhuxCIjp.js";/* empty css                      */import"./index-CWekFvw-.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-Bb7DIZbJ.js";import"./aria-KgdLjl5h.js";import"./validator-BPCBpZzM.js";const ge={class:"s-flex-col",style:{height:"100%"}},_e={class:"",style:{"margin-bottom":"10px"}},ye={class:"s-table-operations"},we={class:"s-flex-auto",style:{"min-height":"0"}},ve={class:"s-table-pagination"},ht=Z({__name:"Booth",setup(be){const C=A(),E=u(C.EXHIBITION_INFO);K(()=>C.EXHIBITION_INFO,(t,e)=>{t.id!==e.id&&(E.value=t,c())},{deep:!0}),Q();const U=W(),m=u(!1),h=z({page:1,perPage:10}),x=u(0),I=u({}),$=U.query.id,k=u([]),B=u(null),S=u([]),n=z({show:!1,file:"",type:1,orderId:""}),N=t=>{I.value=t,h.page=1,c()},c=()=>{f.getList({exhibitionId:E.value.id,...h,...I.value}).then(t=>{t.code===0?(k.value=t.data.data,x.value=t.data.total):k.value=[{}]})},V=t=>{R.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f.revoke({id:t}).then(e=>{e.code===0?(s.success("撤销成功"),c()):s.error(e.msg)})}).catch(()=>{})},D=t=>{R.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f.del({id:t}).then(e=>{e.code===0?(s.success("删除成功"),c()):s.error(e.msg)})}).catch(()=>{})},F=()=>{let t=B.value.getSelectionRows().map(e=>e.id);if(t.length===0){s.warning("请选择需要下载的数据");return}ce({orderId:t}).then(e=>{if(e.code===0){if(e.data.length===0){s.warning("无数据");return}fe(e.data)}else s.error(e.msg)})},P=()=>{f.export({exhibitionId:$}).then(t=>{t.code===0?(window.open(t.data.url,"_self"),s.success("导出成功")):s.error(t.msg)})},L=u(null);let p=u([]);const O=t=>{let e=t[0];p.value=[{name:e.name,size:e.size,uid:e.uid,status:"ready",percentage:0,raw:e}]},q=t=>{const e=t.size/1024/1024<3;return e||s.error("文件大小不能超过 3MB!"),e},M=t=>{n.show=!0,n.type=1,n.orderId=t,n.file="",p.value=[]},X=()=>{if(n.type===1&&p.value.length===0){s.warning("请选择合同文件");return}if(m.value=!0,p.value.length===0)f.receipt({orderId:n.orderId,type:n.type}).then(t=>{t.code===0?(s.success("上传成功"),n.show=!1,c()):s.error(t.msg),m.value=!1}).catch(()=>{m.value=!1});else{let t=new FormData;t.append("upload",p.value[0].raw),me(t).then(e=>{e.code===0?f.receipt({orderId:n.orderId,type:n.type,url:e.data.url}).then(d=>{d.code===0?(s.success("上传成功"),n.show=!1,c()):s.error(d.msg),m.value=!1}).catch(()=>{m.value=!1}):(s.error(e.msg),m.value=!1)}).catch(()=>{m.value=!1})}};return f.getSearchField().then(t=>{t.code===0&&(S.value=t.data)}),c(),(t,e)=>{const d=pe,i=de,H=se,j=ne,T=re,G=ie,J=le,Y=ae;return y(),w(v,null,[_("div",ge,[_("div",_e,[o(he)]),o(ue,{data:S.value,onSearch:N},null,8,["data"]),_("div",ye,[o(d,{size:"small",onClick:F},{default:l(()=>[r("批量下载合同")]),_:1}),o(d,{size:"small",onClick:P},{default:l(()=>[r("导出")]),_:1})]),_("div",we,[o(H,{ref_key:"tableRef",ref:B,data:k.value,border:"",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[o(i,{type:"selection",width:"40",fixed:"left"}),o(i,{prop:"orderCode",label:"订单编号",width:"280"}),o(i,{prop:"companyName",label:"企业名称","min-width":"120"}),o(i,{prop:"exhibitionName",label:"展会名称","min-width":"120"}),o(i,{prop:"hallCode",label:"展馆号"}),o(i,{prop:"positionCode",label:"展位号"}),o(i,{prop:"area",label:"面积"}),o(i,{prop:"num",label:"展位数量","min-width":"120"}),o(i,{prop:"orderPrice",label:"订单金额","min-width":"120"}),o(i,{prop:"orderType",label:"下单方式","min-width":"120"},{default:l(a=>[r(b(a.row.orderType===1?"代下单":"展商下单"),1)]),_:1}),o(i,{prop:"payStatus",label:"付款状态","min-width":"120"},{default:l(a=>[r(b({0:"未付款",1:"部分付款",2:"已付款"}[a.row.payStatus]),1)]),_:1}),o(i,{prop:"receivedPrice",label:"到款金额","min-width":"120"}),o(i,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:l(a=>[r(b({0:"未签订",1:"已签订",2:"已回执(电子)",3:"已回执(纸质)"}[a.row.contractStatus]),1)]),_:1}),o(i,{prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:l(a=>[r(b({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[a.row.invoiceStatus]),1)]),_:1}),o(i,{prop:"clueUser",label:"所属人"}),o(i,{prop:"authUser",label:"下单人"}),o(i,{fixed:"right",label:"操作",width:"250"},{default:l(a=>[o(d,{link:"",type:"primary",onClick:g=>t.$router.push({name:"OrderBoothDetail",query:{id:a.row.id}})},{default:l(()=>[r("详情")]),_:2},1032,["onClick"]),a.row.orderStatus!==0?(y(),w(v,{key:0},[a.row.contractStatus===0?(y(),ee(d,{key:0,link:"",type:"primary",onClick:g=>t.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:1}})},{default:l(()=>[r("签订合同")]),_:2},1032,["onClick"])):(y(),w(v,{key:1},[o(d,{link:"",type:"primary",onClick:g=>t.$router.push({name:"ContractConclude",query:{id:a.row.contractTemplateId,orderId:a.row.id,isUpdate:1}})},{default:l(()=>[r("更新合同")]),_:2},1032,["onClick"]),o(d,{link:"",type:"primary",onClick:g=>M(a.row.id)},{default:l(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)),o(d,{link:"",type:"primary",onClick:g=>V(a.row.id)},{default:l(()=>[r("撤销")]),_:2},1032,["onClick"])],64)):(y(),w(v,{key:1},[o(d,{link:"",type:"",disabled:""},{default:l(()=>[r("已撤销")]),_:1}),o(d,{link:"",type:"danger",onClick:g=>D(a.row.id)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),_("div",ve,[o(j,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:x.value,"current-page":h.page,"onUpdate:currentPage":e[0]||(e[0]=a=>h.page=a),"page-size":h.perPage,"onUpdate:pageSize":e[1]||(e[1]=a=>h.perPage=a),onChange:c},null,8,["total","current-page","page-size"])])]),o(Y,{modelValue:n.show,"onUpdate:modelValue":e[5]||(e[5]=a=>n.show=a),title:"上传合同",width:"400",draggable:""},{footer:l(()=>[o(d,{type:"primary",onClick:X,loading:m.value},{default:l(()=>[r("确定")]),_:1},8,["loading"]),o(d,{onClick:e[4]||(e[4]=a=>n.show=!1)},{default:l(()=>[r("取消")]),_:1})]),default:l(()=>[o(G,{modelValue:n.type,"onUpdate:modelValue":e[2]||(e[2]=a=>n.type=a)},{default:l(()=>[o(T,{value:1},{default:l(()=>[r("电子合同")]),_:1}),o(T,{value:2},{default:l(()=>[r("纸质合同")]),_:1})]),_:1},8,["modelValue"]),o(J,{ref_key:"uploadRef",ref:L,"auto-upload":!1,limit:1,"before-upload":q,"on-exceed":O,"file-list":te(p),"onUpdate:fileList":e[3]||(e[3]=a=>oe(p)?p.value=a:p=a),style:{"margin-top":"10px"}},{default:l(()=>[o(d,{size:"small",type:"primary"},{default:l(()=>[r("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])],64)}}});export{ht as default};
