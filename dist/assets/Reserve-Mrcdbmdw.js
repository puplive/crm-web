import{d as be,l as m,s as Z,c as ee,t as oe,b as h,O as c,Q as S,R as o,i as t,F as b,W as ge,a5 as ye,N as le,o as p,P as _,U as V,h as C,e as x,a3 as Pe,X as Ve,Y as Ce}from"./index-DPKLMifh.js";import{E as we}from"./el-dialog-BdrwungY.js";/* empty css                   */import{E as Ee}from"./el-col-DNadxCQf.js";import{E as Ne}from"./el-scrollbar-B5_UZG70.js";import{a as xe,E as Ie}from"./el-form-item-B8ZqV2ed.js";/* empty css                 */import{E as ke}from"./el-input-number-Bb7NC3du.js";import{E as Ue}from"./el-button-BZhht6Aa.js";import"./el-tag-BdxPq-2S.js";import{E as Fe,a as qe}from"./el-select-CbQr279W.js";import"./el-popper-B0uVMgLQ.js";/* empty css                       */import{E as Se,a as Be}from"./el-radio-7iNb1Ha6.js";import{E as Oe}from"./el-image-viewer-DDcmylpV.js";import{a as Re}from"./index-Bxq8H8Gd.js";import{h as $e,p as Je}from"./index-EWs3qPje.js";import{_ as I}from"./rules-F8IXRWD9.js";import{E as De}from"./index-AHeDHGjU.js";import{b as Le}from"./request-Dzwz_hd7.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D7ffnZpo.js";import"./use-form-item-ClMMhgsP.js";import"./scroll-DfTGMDIo.js";import"./vnode-Bzb78u4g.js";import"./refs-D-DmGJOu.js";import"./event-BB_Ol6Sd.js";import"./castArray-DBP2zYOv.js";import"./_baseClone-DuTQet55.js";import"./_initCloneObject-C-QBKHxn.js";import"./index-QqvOJzYt.js";import"./isEqual-B7Uxhf4z.js";const ze=k=>(Ve("data-v-0e83da15"),k=k(),Ce(),k),Ge={class:"booth-reserve"},je={class:"l"},Ae={class:"title"},He={class:"img-box"},Qe={class:"r"},We={class:"form-box"},Xe=ze(()=>c("div",null,"预定展位",-1)),Ye={style:{"text-align":"center"}},Ke={style:{padding:"15px"}},Me={class:"dialog-footer"},Ze=be({__name:"Reserve",setup(k){const te=ge(),v=ye(),L=v.query.clueId,U=v.query.exhibitionId,T=v.query.exhibitorId,g=m(v.query.hallCode),B=m([]),F=m([]),z=m([]),G=m([]),j=m([]),A=m([]),H={1:"%",2:"￥"},l=Z({clueId:L,exhibitionId:U,exhibitorId:T,add:[],discount:[],position:[{hallCode:g.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let r=JSON.parse(v.query.data);l.clueId=r.clueId,l.exhibitionId=r.exhibitionId,l.exhibitorId=r.exhibitorId,l.position=r.position,l.add=r.add,l.discount=r.discount}m({});const O=m(null),a=Z({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ae=r=>{a.form.unitPrice=Number(r.price),a.form.product=r.text,a.form.num=r.num},ie=ee(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),re=(r,e,s)=>{e.length===""||a.form.width===""?s(new Error("请填写尺寸")):e.length<=0||a.form.width<=0?s(new Error("尺寸不可为0和负数")):s()},ne=()=>{let r=l.position.length;R(g.value,r),l.position.push({hallCode:g.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},R=(r,e)=>{F.value[e]=[],$e({exhibitionId:U,hallCode:r}).then(s=>{F.value[e]=s.data})};R(g.value,0);const ue=(r,e,s,i)=>{if(!e)return s(new Error("必填项"));Je({exhibitionId:U,exhibitorId:T,hallCode:i,positionCode:e}).then(f=>{f.code===0&&f.data.status?s():s(new Error("该展位已锁定"))})},$=m(null),de=()=>{$.value.validate().then(r=>{r&&te.push({name:"BoothCreateOrder",query:{...v.query,companyName:q.value,data:JSON.stringify(l)}})}).catch(()=>{})},se=r=>{a.index=r,a.form.product="",a.form.unitPrice="",a.form.length="",a.form.width="",a.form.num=1,a.show=!0},pe=()=>{O.value.validate().then(r=>{if(!r)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=Q(s),f=W(s);l.position[a.index].product=a.form.product,l.position[a.index].unitPrice=a.form.unitPrice,l.position[a.index].length=a.form.length,l.position[a.index].width=a.form.width,l.position[a.index].area=e,l.position[a.index].costPrice=Number(s.toFixed(2)),l.position[a.index].addPrice=Number(i.toFixed(2)),l.position[a.index].discountPrice=Number(f.toFixed(2)),l.position[a.index].finalPrice=Number((s+i-f).toFixed(2)),$.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},Q=r=>{let e=0;return l.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e},W=r=>{let e=0;return l.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e};oe(()=>l.add,r=>{l.position.forEach(e=>{e.addPrice=Number(Q(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),oe(()=>l.discount,r=>{l.position.forEach(e=>{e.discountPrice=Number(W(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const q=m(""),J=m(!0);Re({clueId:L,exhibitionId:U}).then(r=>{let e=r.data;z.value=e.attachPrice.add,G.value=e.attachPrice.discount,j.value=e.companyBrand,A.value=e.unitPrice,B.value=e.exhibitionHall,q.value=e.companyName,J.value=e.isNew});const X=ee(()=>{let r=B.value.find(e=>e.code===g.value);return r?r.img:""});return(r,e)=>{const s=Oe,i=xe,f=Se,Y=Be,w=Fe,E=qe,N=Ue,y=De,ce=ke,me=le("DeleteFilled"),K=Le,M=Ie,fe=Ne,D=Ee,_e=le("Close"),he=we;return p(),h(b,null,[c("div",Ge,[c("div",je,[c("div",Ae,[c("span",null,S(q.value),1),c("span",null,"展馆号："+S(g.value),1)]),c("div",He,[o(s,{style:{width:"100%",height:"100%"},src:X.value,"preview-src-list":[X.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",Qe,[c("div",We,[o(fe,{height:"100%"},{default:t(()=>[o(M,{ref_key:"formRef",ref:$,model:l,"label-width":"auto",class:"form","label-position":"left"},{default:t(()=>[Xe,o(i,{label:"企业名称"},{default:t(()=>[_(S(q.value),1)]),_:1}),o(i,{label:"新展商"},{default:t(()=>[o(Y,{modelValue:J.value,"onUpdate:modelValue":e[0]||(e[0]=n=>J.value=n),disabled:""},{default:t(()=>[o(f,{value:!0},{default:t(()=>[_("是")]),_:1}),o(f,{value:!1},{default:t(()=>[_("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:t(()=>[o(E,{modelValue:l.add,"onUpdate:modelValue":e[1]||(e[1]=n=>l.add=n),multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,V(z.value,(n,u)=>(p(),C(w,{key:u,label:n.text+" "+n.price+H[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:t(()=>[o(E,{modelValue:l.discount,"onUpdate:modelValue":e[2]||(e[2]=n=>l.discount=n),multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,V(G.value,(n,u)=>(p(),C(w,{key:u,label:n.text+" "+n.price+H[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:t(()=>[o(N,{icon:"Plus",onClick:ne},{default:t(()=>[_("添加展位")]),_:1})]),_:1}),(p(!0),h(b,null,V(l.position,(n,u)=>(p(),h("div",{class:"item",key:u},[o(i,{label:"展馆号",prop:`position[${u}].hallCode`,rules:x(I).required},{default:t(()=>[o(E,{modelValue:l.position[u].hallCode,"onUpdate:modelValue":d=>l.position[u].hallCode=d,placeholder:"请选择",onChange:()=>{R(n.hallCode,u),g.value=n.hallCode}},{default:t(()=>[(p(!0),h(b,null,V(B.value,(d,P)=>(p(),C(w,{key:P,label:d.code,value:d.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${u}].positionCode`,rules:[...x(I).required,{validator:(d,P,ve)=>ue(d,P,ve,l.position[u].hallCode),trigger:"change"}]},{default:t(()=>[o(E,{modelValue:l.position[u].positionCode,"onUpdate:modelValue":d=>l.position[u].positionCode=d,filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,V(F.value[u],(d,P)=>(p(),C(w,{key:P,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:t(()=>[o(E,{modelValue:l.position[u].companyBrand,"onUpdate:modelValue":d=>l.position[u].companyBrand=d,multiple:"",placeholder:"请选择"},{default:t(()=>[(p(!0),h(b,null,V(j.value,(d,P)=>(p(),C(w,{key:P,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:t(()=>[o(Y,{modelValue:l.position[u].type,"onUpdate:modelValue":d=>l.position[u].type=d},{default:t(()=>[o(f,{value:1},{default:t(()=>[_("标准")]),_:1}),o(f,{value:2},{default:t(()=>[_("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${u}].product`,rules:x(I).required},{default:t(()=>[o(N,{size:"small",onClick:d=>se(u)},{default:t(()=>[_("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),l.position[u].product?(p(),C(i,{key:0,label:" "},{default:t(()=>[c("div",null,S(l.position[u].product+" "+l.position[u].area+"㎡"),1)]),_:2},1024)):Pe("",!0),o(i,{label:"展位原价"},{default:t(()=>[o(y,{modelValue:l.position[u].costPrice,"onUpdate:modelValue":d=>l.position[u].costPrice=d,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:t(()=>[o(y,{"model-value":l.position[u].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:t(()=>[o(y,{"model-value":l.position[u].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${u}].finalPrice`,rules:x(I).required},{default:t(()=>[o(ce,{modelValue:l.position[u].finalPrice,"onUpdate:modelValue":d=>l.position[u].finalPrice=d,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",Ye,[o(N,{link:"",type:"danger",onClick:d=>{l.position.splice(u,1),F.value.splice(u,1)}},{default:t(()=>[o(K,null,{default:t(()=>[o(me)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",Ke,[o(N,{type:"primary",onClick:de,style:{width:"100%"}},{default:t(()=>[_("确认")]),_:1})])])]),o(he,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=n=>a.show=n),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{O.value.resetFields()})},{footer:t(()=>[c("div",Me,[o(N,{onClick:e[6]||(e[6]=n=>a.show=!1)},{default:t(()=>[_("取消")]),_:1}),o(N,{type:"primary",onClick:pe},{default:t(()=>[_("确定")]),_:1})])]),default:t(()=>[o(M,{ref_key:"ggFormRef",ref:O,model:a.form,"label-width":"auto","label-position":"left"},{default:t(()=>[o(i,{label:"产品名称",prop:"product",rules:x(I).required},{default:t(()=>[o(E,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=n=>a.form.product=n),placeholder:"",onChange:ae},{default:t(()=>[(p(!0),h(b,null,V(A.value,n=>(p(),C(w,{key:n.id,label:n.text+" "+n.price+"/"+n.num+"/㎡",value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:t(()=>[o(y,{"model-value":ie.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",required:"",rules:[{validator:re,trigger:"blur"}]},{default:t(()=>[o(D,{span:11},{default:t(()=>[o(i,{label:""},{default:t(()=>[o(y,{type:"number",modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.length=n),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"长： 例如3"},null,8,["modelValue"])]),_:1})]),_:1}),o(D,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:t(()=>[o(K,null,{default:t(()=>[o(_e)]),_:1})]),_:1}),o(D,{span:11},{default:t(()=>[o(i,{label:""},{default:t(()=>[o(y,{type:"number",modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.width=n),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"宽： 例如3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:t(()=>[o(y,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),So=Te(Ze,[["__scopeId","data-v-0e83da15"]]);export{So as default};
