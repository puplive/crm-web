import{d as K,l as p,s as B,b as _,O as w,R as t,i as l,F as h,W as X,a5 as Y,o as y,P as r,Q as v,e as Z,am as ee}from"./index-CQqxCSWS.js";import{E as te}from"./el-dialog-DwPQePIn.js";/* empty css                   */import{E as oe}from"./el-progress--ZWqISSk.js";/* empty css                       */import{E as ae,a as le}from"./el-radio-W782hIDn.js";import{E as re}from"./el-pagination-t8iNeqEA.js";/* empty css                 */import"./el-tag-h9n5MFmZ.js";import"./el-select-DYl3-VHn.js";import"./el-scrollbar-C3j4fdfy.js";import"./el-popper-C3dBlxja.js";import{E as ie,a as ne}from"./el-table-column-zhHNQexn.js";import"./el-checkbox-fwfbzH_H.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{T as se}from"./index-BwIcbCew.js";import{_ as de}from"./GoodsOrderDetail.vue_vue_type_script_setup_true_lang-CV8tEQka.js";import{c as b,b as $}from"./index-hcD7-Xlu.js";import{u as pe}from"./index-DowdLp9T.js";import{d as ue}from"./index-OrMP2ra0.js";import{z as me}from"./fileZip-gbWoZE_B.js";/* empty css                       *//* empty css                   */import{c as s}from"./request-BBg0J_NF.js";import{E as ce}from"./index-CiRGXMeH.js";import{E as D}from"./index-B6JkS4i7.js";import"./index-DpEbI1pT.js";import"./use-form-item-D28MIX8K.js";import"./scroll-C2jA8NYV.js";import"./vnode-CErutkXz.js";import"./refs-CLB5B3if.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-COBPfzDT.js";import"./_baseClone-B7R5NDWW.js";import"./_initCloneObject-D_j4xO6N.js";import"./isEqual-nyLZQ5zf.js";import"./index-DTlHvMSL.js";import"./castArray-CxkzhYk5.js";import"./el-form-item-qPktekbR.js";import"./tool-D2Dmz4qx.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./aria-KgdLjl5h.js";import"./validator-Ay-ot4NQ.js";const fe={class:"s-flex-col",style:{height:"100%"}},ge={class:"s-table-operations"},_e={class:"s-flex-auto",style:{"min-height":"0"}},he={class:"s-table-pagination"},ut=K({__name:"Goods",setup(ye){X();const U=Y(),m=p(!1),c=B({page:1,perPage:10}),C=p(0),E=p({}),V=U.query.id,k=p([]),x=p(null),S=p([]),d=B({show:!1,file:"",type:1,orderId:0}),P=o=>{E.value=o,c.page=1,f()},f=()=>{b.getList({...c,...E.value}).then(o=>{o.code===0?(k.value=o.data.data,C.value=o.data.total):k.value=[{}]})},F=o=>{D.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.revoke({id:o}).then(e=>{e.code===0?(s.success("撤销成功"),f()):s.error(e.msg)})}).catch(()=>{})},I=o=>{D.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.del({id:o}).then(e=>{e.code===0?(s.success("删除成功"),f()):s.error(e.msg)})}).catch(()=>{})},L=()=>{let o=x.value.getSelectionRows().map(e=>e.id);if(o.length===0){s.warning("请选择需要下载的数据");return}ue({orderId:o}).then(e=>{if(e.code===0){if(e.data.length===0){s.warning("无数据");return}me(e.data)}else s.error(e.msg)})},M=()=>{$.export({exhibitionId:V}).then(o=>{o.code===0?(window.open(o.data.url,"_self"),s.success("导出成功")):s.error(o.msg)})},N=p(null);let u=p([]);const q=o=>{let e=o[0];u.value=[{name:e.name,size:e.size,uid:e.uid,status:"ready",percentage:0,raw:e}]},G=o=>{const e=o.size/1024/1024<3;return e||s.error("文件大小不能超过 3MB!"),e},z=o=>{d.show=!0,d.type=1,d.orderId=o,d.file="",u.value=[]},O=()=>{if(u.value.length===0){s.warning("请选择合同文件");return}m.value=!0;let o=new FormData;o.append("upload",u.value[0].raw),pe(o).then(e=>{e.code===0?$.receipt({orderId:d.orderId,type:d.type,url:e.data.url}).then(i=>{i.code===0?(s.success("上传成功"),d.show=!1,f()):s.error(i.msg),m.value=!1}).catch(()=>{m.value=!1}):(s.error(e.msg),m.value=!1)}).catch(()=>{m.value=!1})},R=p(null),j=o=>{R.value.getDetail(o)};return b.getSearchField().then(o=>{o.code===0&&(S.value=o.data)}),f(),(o,e)=>{const i=ce,n=ne,Q=ie,W=re,T=ae,A=le,H=oe,J=te;return y(),_(h,null,[w("div",fe,[t(se,{data:S.value,onSearch:P},null,8,["data"]),w("div",ge,[t(i,{size:"small",onClick:L},{default:l(()=>[r("批量下载合同")]),_:1}),t(i,{size:"small",onClick:M},{default:l(()=>[r("导出")]),_:1})]),w("div",_e,[t(Q,{ref_key:"tableRef",ref:x,data:k.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[t(n,{type:"selection",width:"42",fixed:"left"}),t(n,{prop:"orderCode",label:"订单编号","min-width":"120"}),t(n,{prop:"companyName",label:"企业名称","min-width":"120"}),t(n,{prop:"hallCode",label:"展馆号"}),t(n,{prop:"positionCode",label:"展位号"}),t(n,{prop:"orderPrice",label:"订单金额","min-width":"120"}),t(n,{prop:"orderType",label:"下单方式","min-width":"120"},{default:l(a=>[r(v({1:"代下单",2:"展商下单"}[a.row.orderType]),1)]),_:1}),t(n,{prop:"payStatus",label:"付款状态","min-width":"120"},{default:l(a=>[r(v({0:"未付款",1:"部分付款",2:"已付款"}[a.row.payStatus]),1)]),_:1}),t(n,{prop:"receivedPrice",label:"到款金额","min-width":"120"}),t(n,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:l(a=>[r(v({0:"未签订",1:"已签订",2:"已回执(电子)",3:"已回执(纸质)"}[a.row.contractStatus]),1)]),_:1}),t(n,{prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:l(a=>[r(v({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[a.row.invoiceStatus]),1)]),_:1}),t(n,{prop:"clueUser",label:"所属人"}),t(n,{prop:"authUser",label:"下单人"}),t(n,{fixed:"right",label:"操作",width:"250"},{default:l(a=>[t(i,{link:"",type:"primary",onClick:g=>j(a.row.id)},{default:l(()=>[r("详情")]),_:2},1032,["onClick"]),a.row.orderStatus!==0?(y(),_(h,{key:0},[a.row.contractStatus===0?(y(),_(h,{key:0},[t(i,{link:"",type:"primary",onClick:g=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:2}})},{default:l(()=>[r("签订合同")]),_:2},1032,["onClick"]),t(i,{link:"",type:"primary",onClick:g=>z(a.row.id)},{default:l(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)):(y(),_(h,{key:1},[t(i,{link:"",type:"primary",onClick:g=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:2}})},{default:l(()=>[r("更新合同")]),_:2},1032,["onClick"]),t(i,{link:"",type:"primary",onClick:g=>z(a.row.id)},{default:l(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)),t(i,{link:"",type:"primary",onClick:g=>F(a.row.id)},{default:l(()=>[r("撤销")]),_:2},1032,["onClick"])],64)):(y(),_(h,{key:1},[t(i,{link:"",type:"",disabled:""},{default:l(()=>[r("已撤销")]),_:1}),t(i,{link:"",type:"danger",onClick:g=>I(a.row.id)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),w("div",he,[t(W,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:C.value,"current-page":c.page,"onUpdate:currentPage":e[0]||(e[0]=a=>c.page=a),"page-size":c.perPage,"onUpdate:pageSize":e[1]||(e[1]=a=>c.perPage=a),onChange:f},null,8,["total","current-page","page-size"])])]),t(J,{modelValue:d.show,"onUpdate:modelValue":e[5]||(e[5]=a=>d.show=a),title:"上传合同",width:"400",draggable:""},{footer:l(()=>[t(i,{type:"primary",onClick:O,loading:m.value},{default:l(()=>[r("确定")]),_:1},8,["loading"]),t(i,{onClick:e[4]||(e[4]=a=>d.show=!1)},{default:l(()=>[r("取消")]),_:1})]),default:l(()=>[t(A,{modelValue:d.type,"onUpdate:modelValue":e[2]||(e[2]=a=>d.type=a)},{default:l(()=>[t(T,{value:1},{default:l(()=>[r("电子合同")]),_:1}),t(T,{value:2},{default:l(()=>[r("纸质合同")]),_:1})]),_:1},8,["modelValue"]),t(H,{ref_key:"uploadRef",ref:N,"auto-upload":!1,limit:1,"before-upload":G,"on-exceed":q,"file-list":Z(u),"onUpdate:fileList":e[3]||(e[3]=a=>ee(u)?u.value=a:u=a),style:{"margin-top":"10px"}},{default:l(()=>[t(i,{size:"small",type:"primary"},{default:l(()=>[r("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"]),t(de,{ref_key:"detailRef",ref:R},null,512)],64)}}});export{ut as default};
