import{d as ce,l as m,s as W,e as X,v as Z,O as K,o as s,f as _,P as c,R as F,S as o,w as l,Q as f,F as v,W as P,Z as pe,a7 as me,c as g,X as fe,_ as _e,$ as ve}from"./index-DwAgI1Tl.js";import{E as he}from"./el-dialog-DMsbJQVF.js";/* empty css                   */import{E as be}from"./el-col-DKrTHvI9.js";import{a as Pe}from"./el-scrollbar-DTrg2_7X.js";/* empty css                     *//* empty css                 */import"./el-button-GUz3KSyk.js";import"./el-tag-D6VPebGv.js";/* empty css                  *//* empty css                 */import{E as ge}from"./el-image-viewer-7ksRUYgn.js";import{a as Ve}from"./index-BpqxcFce.js";import{g as ye}from"./index-BXeDRLRn.js";import{E as Ce,a as we}from"./index-nY2QOu6q.js";import{E as Ee,a as Ne}from"./index-C9PHBgDn.js";import{E as ke,a as xe}from"./index-C036lfxA.js";import{E as Ue}from"./index-lrMaDoJ7.js";import{E as Fe}from"./index-GYZblRXP.js";import{E as Ie}from"./index-D16Dp-E5.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BbG6rCDq.js";import"./scroll-JpeTjL8h.js";import"./vnode-D3ksiN5I.js";import"./refs-Dc-3pehd.js";import"./event-BB_Ol6Sd.js";import"./typescript-CxgQ9MvV.js";import"./request-BwuiVass.js";import"./_initCloneObject-l7c9p7aB.js";import"./isEqual-zCtjQBmP.js";import"./castArray-BpHTYSK8.js";import"./_baseClone-sCyLxnY1.js";const Be=N=>(_e("data-v-4de7c4b3"),N=N(),ve(),N),Oe={class:"booth-reserve"},Re={class:"l"},qe={class:"title"},Je={class:"img-box"},$e={class:"r"},De={class:"form-box"},Te=Be(()=>c("div",null,"预定展位",-1)),ze={style:{"text-align":"center"}},Ge={style:{padding:"15px"}},je={class:"dialog-footer"},Ae=ce({__name:"Reserve",setup(N){const M=pe(),w=me(),q=w.query.clueId,I=w.query.exhibitionId,Y=w.query.exhibitorId,h=m(w.query.hallCode),S=m([]),k=m([]),J=m([]),$=m([]),D=m([]),T=m([]),z={1:"%",2:"￥"},a=W({clueId:q,exhibitionId:I,exhibitorId:Y,add:[],discount:[],position:[{hallCode:h.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});m({});const t=W({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ee=r=>{t.form.unitPrice=Number(r.price),t.form.product=r.text,t.form.num=r.num},oe=X(()=>t.form.unitPrice?t.form.unitPrice+"元/"+(t.form.num===1?"":t.form.num)+"㎡":""),le=()=>{let r=a.position.length;B(h.value,r),a.position.push({hallCode:h.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},B=(r,e)=>{k.value[e]=[],ye({exhibitionId:I,hallCode:r}).then(p=>{k.value[e]=p.data})};B(h.value,0);const te=()=>{M.push({name:"BoothCreateOrder",query:{...w.query,companyName:x.value,data:JSON.stringify(a)}})},ae=r=>{t.show=!0,t.index=r,t.form.product="",t.form.unitPrice="",t.form.length="",t.form.width="",t.form.num=1},ie=()=>{t.show=!1;let r=t.form.length*t.form.width,e=r*t.form.unitPrice/t.form.num,p=G(e),i=j(e);a.position[t.index].product=t.form.product,a.position[t.index].unitPrice=t.form.unitPrice,a.position[t.index].length=t.form.length,a.position[t.index].width=t.form.width,a.position[t.index].area=r,a.position[t.index].costPrice=Number(e.toFixed(2)),a.position[t.index].addPrice=Number(p.toFixed(2)),a.position[t.index].discountPrice=Number(i.toFixed(2)),a.position[t.index].finalPrice=Number((e+p-i).toFixed(2))},G=r=>{let e=0;return a.add.forEach(p=>{let i=JSON.parse(p);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e},j=r=>{let e=0;return a.discount.forEach(p=>{let i=JSON.parse(p);i.unit===1?e+=r*i.price/100:i.unit===2&&(e+=i.price)}),e};Z(()=>a.add,r=>{a.position.forEach(e=>{e.addPrice=Number(G(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),Z(()=>a.discount,r=>{a.position.forEach(e=>{e.discountPrice=Number(j(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const ne=r=>{let e=a.position[r].costPrice,p=a.position[r].addPrice,i=a.position[r].discountPrice;return Number((e+p-i).toFixed(2))},x=m(""),O=m(!0);Ve({clueId:q,exhibitionId:I}).then(r=>{let e=r.data;J.value=e.attachPrice.add,$.value=e.attachPrice.discount,D.value=e.companyBrand,T.value=e.unitPrice,S.value=e.exhibitionHall,x.value=e.companyName,O.value=e.isNew});const A=X(()=>{let r=S.value.find(e=>e.code===h.value);return r?r.img:""});return(r,e)=>{const p=ge,i=Ce,U=Ee,H=Ne,V=xe,y=ke,C=Ue,b=Fe,re=K("DeleteFilled"),L=Ie,Q=we,de=Pe,R=be,ue=K("Close"),se=he;return s(),_(v,null,[c("div",Oe,[c("div",Re,[c("div",qe,[c("span",null,F(x.value),1),c("span",null,"展馆号："+F(h.value),1)]),c("div",Je,[o(p,{style:{width:"100%",height:"100%"},src:A.value,"preview-src-list":[A.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",$e,[c("div",De,[o(de,{height:"100%"},{default:l(()=>[o(Q,{model:a,"label-width":"auto",class:"form"},{default:l(()=>[Te,o(i,{label:"企业名称"},{default:l(()=>[f(F(x.value),1)]),_:1}),o(i,{label:"新展商"},{default:l(()=>[o(H,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=n=>O.value=n),disabled:""},{default:l(()=>[o(U,{value:!0},{default:l(()=>[f("是")]),_:1}),o(U,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:l(()=>[o(y,{modelValue:a.add,"onUpdate:modelValue":e[1]||(e[1]=n=>a.add=n),multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(v,null,P(J.value,(n,d)=>(s(),g(V,{key:d,label:n.text+" "+n.price+z[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:l(()=>[o(y,{modelValue:a.discount,"onUpdate:modelValue":e[2]||(e[2]=n=>a.discount=n),multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(v,null,P($.value,(n,d)=>(s(),g(V,{key:d,label:n.text+" "+n.price+z[n.unit],value:JSON.stringify(n)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:le},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(s(!0),_(v,null,P(a.position,(n,d)=>(s(),_("div",{class:"item",key:d},[o(i,{label:"展馆号"},{default:l(()=>[o(y,{modelValue:a.position[d].hallCode,"onUpdate:modelValue":u=>a.position[d].hallCode=u,placeholder:"请选择",onChange:u=>{B(n.hallCode,d),h.value=n.hallCode}},{default:l(()=>[(s(!0),_(v,null,P(S.value,(u,E)=>(s(),g(V,{key:E,label:u.code,value:u.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),o(i,{label:"展位号"},{default:l(()=>[o(y,{modelValue:a.position[d].positionCode,"onUpdate:modelValue":u=>a.position[d].positionCode=u,filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择"},{default:l(()=>[(s(!0),_(v,null,P(k.value[d],(u,E)=>(s(),g(V,{key:E,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"品牌"},{default:l(()=>[o(y,{modelValue:a.position[d].companyBrand,"onUpdate:modelValue":u=>a.position[d].companyBrand=u,multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(v,null,P(D.value,(u,E)=>(s(),g(V,{key:E,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:l(()=>[o(H,{modelValue:a.position[d].type,"onUpdate:modelValue":u=>a.position[d].type=u},{default:l(()=>[o(U,{value:1},{default:l(()=>[f("标准")]),_:1}),o(U,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格"},{default:l(()=>[o(C,{size:"small",onClick:u=>ae(d)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1024),a.position[d].product?(s(),g(i,{key:0,label:" "},{default:l(()=>[c("div",null,F(a.position[d].product+" "+a.position[d].area+"㎡"),1)]),_:2},1024)):fe("",!0),o(i,{label:"展位原价"},{default:l(()=>[o(b,{modelValue:a.position[d].costPrice,"onUpdate:modelValue":u=>a.position[d].costPrice=u,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"折后金额"},{default:l(()=>[o(b,{"model-value":ne(d),disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额"},{default:l(()=>[o(b,{modelValue:a.position[d].finalPrice,"onUpdate:modelValue":u=>a.position[d].finalPrice=u},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),c("div",ze,[o(C,{link:"",type:"danger",onClick:u=>{a.position.splice(d,1),k.value.splice(d,1)}},{default:l(()=>[o(L,null,{default:l(()=>[o(re)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",Ge,[o(C,{type:"primary",onClick:te,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(se,{modelValue:t.show,"onUpdate:modelValue":e[7]||(e[7]=n=>t.show=n),title:"添加规格",width:"500",draggable:""},{footer:l(()=>[c("div",je,[o(C,{onClick:e[6]||(e[6]=n=>t.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:ie},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(Q,{ref:"ggFormRef",model:t.form,"label-width":"auto"},{default:l(()=>[o(i,{label:"产品名称",prop:"product"},{default:l(()=>[o(y,{modelValue:t.form.product,"onUpdate:modelValue":e[3]||(e[3]=n=>t.form.product=n),placeholder:"",onChange:ee},{default:l(()=>[(s(!0),_(v,null,P(T.value,n=>(s(),g(V,{key:n.id,label:n.text+" "+n.price+"/"+n.num+"/㎡",value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(b,{"model-value":oe.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸"},{default:l(()=>[o(R,{span:11},{default:l(()=>[o(b,{modelValue:t.form.length,"onUpdate:modelValue":e[4]||(e[4]=n=>t.form.length=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(R,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(L,null,{default:l(()=>[o(ue)]),_:1})]),_:1}),o(R,{span:11},{default:l(()=>[o(b,{modelValue:t.form.width,"onUpdate:modelValue":e[5]||(e[5]=n=>t.form.width=n),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{label:"面积"},{default:l(()=>[o(b,{"model-value":Number((t.form.length*t.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),wo=Se(Ae,[["__scopeId","data-v-4de7c4b3"]]);export{wo as default};
