import{d as X,l as p,s as B,b as k,O as v,R as l,i,F as I,W as Y,a5 as Z,o as x,P as s,U as z,h as D,e as ee}from"./index-CGT8Uv0o.js";import{g as le,E as te}from"./el-progress-C2Jtg_GP.js";import{E as oe}from"./el-dialog-CyT1AxkB.js";/* empty css                   */import{a as ae,E as ie}from"./el-form-item-CEqzFdHL.js";import{E as re}from"./el-row-CYDvA4SM.js";import{E as de}from"./el-col-D-Rw5HIL.js";/* empty css                 */import"./el-tag-BOIloKEG.js";import{E as ne,a as se}from"./el-select-m9mYdgRk.js";import"./el-scrollbar-C4Tx_TQA.js";import"./el-popper-Dql64ebi.js";import{E as ue}from"./el-pagination-qyI530BM.js";import{E as pe,a as me}from"./el-table-column-DrOKPhRo.js";import"./el-checkbox-CnOvg8xx.js";import"./el-tooltip-l0sNRNKZ.js";import{E as fe}from"./el-button-BgGwkZyP.js";/* empty css                         *//* empty css                                                              */import{b as ce,a as be,g as he,c as ge,d as _e,e as ve,f as xe}from"./index-p1mX6fBK.js";import{g as Ee}from"./index-Hid4D_yk.js";import{g as we}from"./index-D6Z3bfo3.js";import{d as Ce}from"./fileZip-DEijO81g.js";/* empty css                   *//* empty css                       */import{c as u}from"./request-Os9MzwW2.js";import{E as Ve}from"./index-0C-u6kQ2.js";import{E as ye}from"./index-Dg-Q8mTy.js";import"./use-form-item-BMa83KhL.js";import"./cloneDeep-DCfOAfT8.js";import"./_baseClone-oIRhDwlR.js";import"./_initCloneObject-EwxdXaOm.js";import"./isEqual-Ch_dq8HX.js";import"./index-DH6RSjWW.js";import"./scroll-BVmrW_hk.js";import"./vnode-Dxlnj8qQ.js";import"./refs-BiWBxwYk.js";import"./event-BB_Ol6Sd.js";import"./castArray-D1RWdvCq.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./aria-KgdLjl5h.js";import"./validator-Dn0v9-9d.js";const ke={class:"s-flex-col",style:{height:"100%"}},Ie={class:"s-table-operations"},Ue={class:"s-flex-auto",style:{"min-height":"0"}},Pe={class:"s-table-pagination"},Fe={class:"dialog-footer"},El=X({__name:"Manage",setup(Re){Y();const m=Z().query.id,C=p([]),U=p(null),V=p(null),c=p(!1),E=p(!1),r=B({id:"",exhibitionId:m,hallCode:"",positionCode:"",standardPrice:0,specialPrice:0,specialUnit:1,length:0,width:0,remark:"",exhibitor:"",exhibitorId:""}),M={hallCode:[{required:!0,message:"请输入大厅号",trigger:"blur"}],positionCode:[{required:!0,message:"请输入位置号",trigger:"blur"}],standardPrice:[{required:!0,message:"请输入标准展位单价",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("不能小于0")):o()}}],specialPrice:[{required:!0,message:"请输入特装展位单价",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("不能小于0")):o()}}],specialUnit:[{required:!0,message:"请选择单位",trigger:"blur"}],length:[{required:!0,message:"请输入长度",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("必须大于0")):o()}}],width:[{required:!0,message:"请输入宽度",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("必须大于0")):o()}}]};let w=p([]);Ee({exhibitionId:m}).then(t=>{t.code===0&&(w.value=t.data)}),p([]);const g=()=>{ce({exhibitionId:m}).then(t=>{t.code===0?C.value=t.data:C.value=[]})},S=async t=>{E.value=!0,c.value=!0,r.hallCode=t.hallCode,r.positionCode=t.positionCode,r.standardPrice=t.standardPrice,r.specialPrice=t.specialPrice,r.specialUnit=t.specialUnit.indexOf("个")>-1?2:1,r.length=t.length,r.width=t.width,r.remark=t.remark,r.exhibitor=t.exhibitor,r.exhibitorId=t.exhibitorId,r.id=t.id},T=()=>{let t=U.value.getSelectionRows().map(e=>e.id);if(t.length===0){u.warning("请选择需要删除的数据");return}P(t)},P=t=>{Ve.confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{be({id:t}).then(e=>{e.code===0?(u.success("删除成功"),g()):u.error(e.msg)})}).catch(()=>{})},$=async()=>{E.value=!1,c.value=!0,r.remark=""},L=()=>{V.value.validate(t=>{if(t)if(E.value){let e=r;e.exhibitor=e.exhibitorId?w.value.find(o=>o.id===r.exhibitorId).name:"",_e(e).then(o=>{o.code===0?(u.success("编辑成功"),c.value=!1,g()):u.error(o.msg)})}else{let{id:e,...o}=r;o.exhibitor=o.exhibitorId?w.value.find(d=>d.id===r.exhibitorId).name:"",ve(o).then(d=>{d.code===0?(u.success("新增成功"),c.value=!1,g()):u.error(d.msg)})}else return!1})},F=p([]);we({exhibitionId:m}).then(t=>{t.code===0&&(F.value=t.data)});const b=p(),n=B({show:!1,loading:!1,list:[],set:()=>{n.show=!0},sub:()=>{if(n.list.length===0){u.error("请选择文件");return}b.value.submit()},dowModel:()=>{he({exhibitionId:m}).then(t=>{t.code===0&&Ce(t.data.url,t.data.name)})}}),O=t=>{b.value.clearFiles();const e=t[0];e.uid=le(),b.value.handleStart(e)},N=()=>{ge({exhibitionId:m}).then(t=>{t.code===0?(window.open(t.data.url,"_self"),u.success("导出成功")):u.error(t.msg)})},A=t=>{const e=t.size/1024/1024<20;return e||u.error("文件大小不能超过 20MB!"),e},H=t=>{n.loading=!0;const e=new FormData;e.append("file",t.file),e.append("exhibitionId",m),xe(e).then(o=>{o.code===0?(u.success("导入成功"),n.show=!1,b.value.clearFiles(),g()):u.error(o.msg),n.loading=!1}).catch(o=>{n.loading=!1})};return m&&g(),(t,e)=>{const o=fe,d=me,W=pe,j=ue,_=ne,y=se,f=ae,h=ye,R=de,G=re,J=ie,q=oe,K=te;return x(),k(I,null,[v("div",ke,[v("div",Ie,[l(o,{size:"small",onClick:$},{default:i(()=>[s("新增")]),_:1}),l(o,{size:"small",onClick:e[0]||(e[0]=a=>n.set())},{default:i(()=>[s("导入")]),_:1}),l(o,{size:"small",onClick:N},{default:i(()=>[s("导出")]),_:1}),l(o,{size:"small",onClick:T},{default:i(()=>[s("删除")]),_:1})]),v("div",Ue,[l(W,{ref_key:"tableRef",ref:U,data:C.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:i(()=>[l(d,{type:"selection",width:"42"}),l(d,{prop:"id",label:"ID",width:"50"}),l(d,{prop:"hallCode",label:"展馆号"}),l(d,{prop:"positionCode",label:"展位号"}),l(d,{prop:"standardPrice",label:"标摊/元","min-width":"120"}),l(d,{prop:"specialPrice",label:"特装/元","min-width":"120"}),l(d,{prop:"specialUnit",label:"特装/㎡/个","min-width":"120"}),l(d,{prop:"length",label:"长"}),l(d,{prop:"width",label:"宽"}),l(d,{prop:"remark",label:"备注"}),l(d,{prop:"exhibitor",label:"参展商"}),l(d,{prop:"time",label:"创建时间","min-width":"120"}),l(d,{fixed:"right",label:"操作",width:"150"},{default:i(a=>[l(o,{link:"",type:"primary",onClick:Q=>S(a.row)},{default:i(()=>[s("编辑")]),_:2},1032,["onClick"]),l(o,{link:"",type:"danger",onClick:Q=>P([a.row.id])},{default:i(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),v("div",Pe,[l(j,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:1e3})])]),l(q,{modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=a=>c.value=a),title:E.value?"编辑":"新增展位信息",width:"500",draggable:"",onClose:e[12]||(e[12]=()=>V.value.resetFields())},{footer:i(()=>[v("div",Fe,[l(o,{onClick:e[10]||(e[10]=a=>c.value=!1)},{default:i(()=>[s("取消")]),_:1}),l(o,{type:"primary",onClick:L},{default:i(()=>[s("确定")]),_:1})])]),default:i(()=>[l(J,{ref_key:"formRef",ref:V,model:r,rules:M,"label-width":"auto","label-position":"left"},{default:i(()=>[l(f,{label:"展馆号",prop:"hallCode"},{default:i(()=>[l(y,{modelValue:r.hallCode,"onUpdate:modelValue":e[1]||(e[1]=a=>r.hallCode=a),placeholder:"请选择"},{default:i(()=>[(x(!0),k(I,null,z(F.value,a=>(x(),D(_,{key:a.code,label:a.code,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"展位号",prop:"positionCode"},{default:i(()=>[l(h,{modelValue:r.positionCode,"onUpdate:modelValue":e[2]||(e[2]=a=>r.positionCode=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(f,{label:"标准展位",prop:"standardPrice"},{default:i(()=>[l(h,{modelValue:r.standardPrice,"onUpdate:modelValue":e[3]||(e[3]=a=>r.standardPrice=a),autocomplete:"off",type:"number"},{append:i(()=>[s("元/个")]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"特装展位",prop:"specialPrice"},{default:i(()=>[l(h,{modelValue:r.specialPrice,"onUpdate:modelValue":e[5]||(e[5]=a=>r.specialPrice=a),autocomplete:"off",type:"number"},{append:i(()=>[l(y,{modelValue:r.specialUnit,"onUpdate:modelValue":e[4]||(e[4]=a=>r.specialUnit=a),placeholder:"请选择",style:{width:"120px"}},{default:i(()=>[l(_,{label:"元/㎡",value:1}),l(_,{label:"元/个",value:2})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(G,null,{default:i(()=>[l(R,{span:12},{default:i(()=>[l(f,{label:"长",prop:"length"},{default:i(()=>[l(h,{modelValue:r.length,"onUpdate:modelValue":e[6]||(e[6]=a=>r.length=a),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),l(R,{span:12},{default:i(()=>[l(f,{label:"宽",prop:"width"},{default:i(()=>[l(h,{modelValue:r.width,"onUpdate:modelValue":e[7]||(e[7]=a=>r.width=a),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(f,{label:"备注"},{default:i(()=>[l(h,{modelValue:r.remark,"onUpdate:modelValue":e[8]||(e[8]=a=>r.remark=a),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),l(f,{label:"参展商",prop:"exhibitorId"},{default:i(()=>[l(y,{modelValue:r.exhibitorId,"onUpdate:modelValue":e[9]||(e[9]=a=>r.exhibitorId=a),placeholder:"请选择"},{default:i(()=>[l(_,{label:"无",value:""}),(x(!0),k(I,null,z(ee(w),a=>(x(),D(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(q,{modelValue:n.show,"onUpdate:modelValue":e[15]||(e[15]=a=>n.show=a),title:"导入展位信息",width:"500",draggable:"",onClose:e[16]||(e[16]=()=>{n.loading=!1,b.value.clearFiles()})},{footer:i(()=>[l(o,{onClick:e[14]||(e[14]=a=>n.show=!1)},{default:i(()=>[s("取消")]),_:1}),l(o,{type:"primary",onClick:n.sub,loading:n.loading},{default:i(()=>[s("确定")]),_:1},8,["onClick","loading"])]),default:i(()=>[l(o,{type:"",onClick:n.dowModel,style:{"margin-bottom":"20px"}},{default:i(()=>[s("下载导入模板")]),_:1},8,["onClick"]),l(K,{ref_key:"uploadRef",ref:b,"file-list":n.list,"onUpdate:fileList":e[13]||(e[13]=a=>n.list=a),"before-upload":A,"http-request":H,accept:".xls,.xlsx","on-exceed":O,limit:1,multiple:!1,"auto-upload":!1},{default:i(()=>[l(o,{type:"primary"},{default:i(()=>[s("选择文件")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])],64)}}});export{El as default};
