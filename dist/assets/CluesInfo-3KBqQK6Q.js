import{d as ae,t as x,b as y,X as r,$ as e,i as t,a7 as f,o as u,J as R,a1 as H,h as C,Y as s,Z as c,a2 as ne,a3 as se,c as be,y as ee,e as T,ak as A,a5 as ye,am as he}from"./index-930c3Ux3.js";import{E as ke}from"./dialog-DRTwrfwP.js";/* empty css                *//* empty css              */import"./tag-Bx63MG5m.js";import{a as ie,E as re}from"./select-Ch0pCwuz.js";import{E as we}from"./scrollbar-BkaUBJQv.js";import"./popper-BOCcsbAp.js";import{E as ge,a as Ce}from"./tab-pane-tWOjCDal.js";import{a as xe,E as Ve}from"./form-item-QauYmOwe.js";import{a as Ee,E as Ie}from"./table-column-eRQ7ijcq.js";import"./checkbox-DsPJ2eDo.js";/* empty css                */import{E as de}from"./button-BawgqlTS.js";/* empty css                    */import{a as $e,E as Te}from"./radio-dmMdrzLv.js";import{b as te,d as M,e as Be,f as Ue,h as Ne,i as Re,j as Se}from"./index-m2HHByeG.js";/* empty css                */import{E as ue}from"./index-1qs0NNd4.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Fe}from"./Move.vue_vue_type_script_setup_true_lang-Bs9yixRu.js";import{_ as Le}from"./GoodsOrderDetail.vue_vue_type_script_setup_true_lang-DII3osf3.js";import{b as le,c as oe}from"./index-nLu8W7Vg.js";import{a as Pe}from"./index-CE2BtME9.js";import{_ as qe}from"./rules-F8IXRWD9.js";/* empty css                    */import{E as P}from"./index-DSmL-SNM.js";import"./index-DdveNe0I.js";import"./use-form-item-C32uxISk.js";import"./scroll-D6org_fS.js";import"./vnode-Bg2_asHo.js";import"./focus-trap-4Z6V9Sgw.js";import"./refs-jEmo7zrC.js";import"./event-BB_Ol6Sd.js";import"./_initCloneObject-B6fmpl8-.js";import"./isEqual-CrWmRS1i.js";import"./castArray-BGl2SdHc.js";import"./index-DNIYZShL.js";import"./_baseClone-CBffdWIR.js";import"./aria-KgdLjl5h.js";import"./validator-DXMZb6OT.js";const ce=V=>(ne("data-v-d448d0ad"),V=V(),se(),V),De={class:"follow-up"},Ae=ce(()=>r("div",{class:"title"},"跟进记录",-1)),Me={class:"form"},je={class:"item"},Oe=ce(()=>r("label",null,"跟进状态",-1)),Ge={class:"record"},Je={class:"list"},Xe={class:"p1"},Ye={class:"p2"},Ze=ae({__name:"FollowUp",props:["clueId"],setup(V,{expose:j}){const U=V,I=x(""),b=x(0),d=x(0),S=x(""),O=()=>{te.add({clueId:U.clueId,text:I.value,status:b.value,contactId:d.value,contactName:S.value}).then(v=>{v.code===0?(f.success("跟进记录添加成功"),$()):f.error(v.msg)})},G=x([]),$=()=>{te.getList({clueId:U.clueId}).then(v=>{v.code===0&&(G.value=v.data)})};$();const q=x([]),J=()=>{M.getList({clueId:U.clueId}).then(v=>{v.code===0&&(q.value=v.data)})};return J(),j({getContactList:J}),(v,k)=>{const a=ue,w=re,D=ie,Z=de,F=we;return u(),y("div",De,[Ae,r("div",Me,[e(a,{type:"textarea",placeholder:"请输入跟进内容",modelValue:I.value,"onUpdate:modelValue":k[0]||(k[0]=m=>I.value=m)},null,8,["modelValue"]),r("div",je,[Oe,e(D,{modelValue:b.value,"onUpdate:modelValue":k[1]||(k[1]=m=>b.value=m),placeholder:"跟进状态"},{default:t(()=>[e(w,{label:"未跟进",value:0}),e(w,{label:"电话邀约",value:1}),e(w,{label:"客户拜访",value:2}),e(w,{label:"初步方案",value:3}),e(w,{label:"停滞",value:4})]),_:1},8,["modelValue"]),e(D,{modelValue:d.value,"onUpdate:modelValue":k[2]||(k[2]=m=>d.value=m),placeholder:"联系人",onChange:k[3]||(k[3]=m=>{if(m===0)S.value="";else{let N=q.value.find(X=>X.id===m);S.value=N?N.name:""}})},{default:t(()=>[e(w,{label:"联系人",value:0}),(u(!0),y(R,null,H(q.value,m=>(u(),C(w,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Z,{type:"primary",onClick:O},{default:t(()=>[s("提交")]),_:1})])]),r("div",Ge,[e(F,null,{default:t(()=>[r("ul",Je,[(u(!0),y(R,null,H(G.value,(m,N)=>(u(),y("li",{key:N,class:"item"},[r("div",Xe,[s(c(m.time)+" ",1),r("span",null,c(m.authUser),1),s(),r("span",null,c({0:"无",1:"电话邀约",2:"客户拜访",3:"初步方案",4:"停滞"}[m.status]),1)]),r("div",Ye,"（联系人："+c(m.contact)+"）"+c(m.text),1)]))),128))])]),_:1})])])}}}),ze=pe(Ze,[["__scopeId","data-v-d448d0ad"]]),K=V=>(ne("data-v-1d523d8a"),V=V(),se(),V),He={class:"clues-info"},Ke={class:"clues-info-header"},Qe={class:"clues-info-header-left"},We={class:"p1"},et={class:"p2"},tt={key:0},lt={key:1},ot={class:"clues-info-header-right"},at={class:"clues-info-content"},nt={class:"clues-info-left"},st={style:{}},it={class:"title-bar"},rt=K(()=>r("label",{for:""},"公司信息",-1)),dt={key:0},ut={key:1},pt={key:2},ct=K(()=>r("p",{style:{padding:"10px 0"}},"展位订单",-1)),mt=K(()=>r("p",{style:{padding:"10px 0","margin-top":"10px"}},"物料订单",-1)),ft={class:"clues-info-right"},_t=ae({__name:"CluesInfo",setup(V){const j=ye(),U=he(),I=U.query.type,b=U.query.id;U.query.exhibitionId;const d=x({customField:[],orderPosition:[],orderMaterial:[],contract:[]}),S=x([]),O=()=>{Be().then(n=>{n.code===0&&(S.value=n.data)})},G=be(()=>{let n=[];for(let o in d.value.customFieldTrans){let g=d.value.customFieldTrans[o],h=S.value.find(p=>p.key===o);n.push({key:o,value:g,type:h?h.type:1,name:h?h.name:""})}return n}),$=()=>{Ue({id:b}).then(n=>{n.code===0&&(d.value=n.data)})},q=()=>{P.confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Se({id:[b]}).then(n=>{n.code===0?(f.success("删除成功"),setTimeout(()=>{j.go(-1)},1e3)):f.error(n.msg)})}).catch(()=>{console.log("cancel")})},J=()=>{console.log(d.value.isNew),Ne({id:b,status:d.value.isNew}).then(n=>{n.code===0?f.success("修改成功"):f.error(n.msg)})},v=()=>{M.getList({clueId:b}).then(n=>{n.code===0&&(a.list=n.data)})},k=x(null),a=ee({show:!1,isEdit:!1,list:[],form:{clueId:b,name:"",duties:"",type:0,mobile:"",tel:"",email:"",wechat:"",status:1,isExhibitionContact:1},setAdd:()=>{a.show=!0,a.isEdit=!1,a.form={clueId:b,name:"",duties:"",type:0,mobile:"",tel:"",email:"",wechat:"",status:1,isExhibitionContact:1}},setEdit:n=>{a.show=!0,a.isEdit=!0,a.form=n,a.form.clueId=b},add:()=>{k.value.validate().then(n=>{if(!n)return!1;M.add(a.form).then(o=>{o.code===0?(f.success("添加成功"),a.show=!1,v(),w.value.getContactList()):f.error(o.msg)})}).catch(()=>{})},edit:()=>{k.value.validate().then(n=>{if(!n)return!1;M.edit(a.form).then(o=>{o.code===0?(f.success("修改成功"),a.show=!1,v(),w.value.getContactList()):(f.error(o.msg),v())})}).catch(()=>{})},del:n=>{P.confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{M.del({id:n}).then(o=>{o.code===0?(f.success("删除成功"),v(),w.value.getContactList()):f.error(o.msg)})})}}),w=x(null),D=x(null),Z=()=>{P.confirm("确定退展？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Re({id:b}).then(n=>{n.code===0?(f.success("退展成功"),setTimeout(()=>{j.go(-1)},1e3)):f.error(n.msg)})})},F=ee({activeName:1,change:n=>{F.activeName=n,n===1&&(O(),v()),$()}}),m=(n,o)=>{P.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let g=le.revoke;o===2&&(g=oe.revoke),g({id:n}).then(h=>{h.code===0?(f.success("撤销成功"),$()):f.error(h.msg)})}).catch(()=>{})},N=(n,o)=>{P.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let g=le.del;o===2&&(g=oe.del),g({id:n}).then(h=>{h.code===0?(f.success("删除成功"),$()):f.error(h.msg)})}).catch(()=>{})},X=x(null),me=n=>{X.value.getDetail(n)},fe=n=>{P.confirm("是否确认要撤销合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Pe.revoke({orderId:n}).then(o=>{o.code===0?(f.success("撤销成功"),$()):f.error(o.msg)})}).catch(()=>{})};return $(),O(),v(),(n,o)=>{const g=Te,h=$e,p=de,_=xe,i=Ee,Y=Ie,Q=Ve,z=Ce,_e=ge,L=ue,B=re,W=ie,ve=ke;return u(),y(R,null,[r("div",He,[r("div",Ke,[r("div",Qe,[r("div",We,c(d.value.companyName),1),r("div",et,[T(I)==="2"?(u(),y("span",tt,"所属展商："+c(d.value.companyName),1)):A("",!0),T(I)==="2"?(u(),y("span",lt,[s("新展商： "),e(h,{"model-value":d.value.isNew,"onUpdate:modelValue":o[0]||(o[0]=l=>d.value.isNew=l),onChange:J},{default:t(()=>[e(g,{value:!0,style:{"margin-right":"10px"}},{default:t(()=>[s("是")]),_:1}),e(g,{value:!1},{default:t(()=>[s("否")]),_:1})]),_:1},8,["model-value"])])):A("",!0),r("span",null,"客户经理："+c(d.value.authUser),1)])]),r("div",ot,[T(I)==="2"?(u(),y(R,{key:0},[d.value.isExit?(u(),C(p,{key:0,type:"info",plain:"",disabled:""},{default:t(()=>[s("已退展")]),_:1})):(u(),C(p,{key:1,type:"primary",onClick:Z},{default:t(()=>[s("退展")]),_:1}))],64)):A("",!0),e(p,{type:"primary",onClick:o[1]||(o[1]=()=>{D.value.setMove([T(b)])})},{default:t(()=>[s("转他人")]),_:1})])]),r("div",at,[r("div",nt,[e(_e,{modelValue:F.activeName,"onUpdate:modelValue":o[3]||(o[3]=l=>F.activeName=l),onTabChange:F.change,type:"border-card",class:"demo-tabs",style:{height:"100%"}},{default:t(()=>[e(z,{label:"资料",name:1},{default:t(()=>[r("div",st,[e(Q,{ref_key:"form",ref:d,"label-width":"auto","label-position":"left"},{default:t(()=>[r("div",it,[rt,e(p,{type:"default",onClick:o[2]||(o[2]=l=>n.$router.push({name:"CluesEdit",query:{id:T(b)}}))},{default:t(()=>[s("编辑")]),_:1}),e(p,{type:"default",onClick:q},{default:t(()=>[s("删除")]),_:1})]),e(_,{label:"企业名称"},{default:t(()=>[r("span",null,c(d.value.companyName),1)]),_:1}),e(_,{label:"联系人"},{default:t(()=>[r("span",null,c(d.value.contactName),1)]),_:1}),e(_,{label:"国家"},{default:t(()=>[r("span",null,c(d.value.country),1)]),_:1}),e(_,{label:"省份"},{default:t(()=>[r("span",null,c(d.value.province),1)]),_:1}),e(_,{label:"城市"},{default:t(()=>[r("span",null,c(d.value.city),1)]),_:1}),e(_,{label:"详细地址",prop:"address"},{default:t(()=>[r("span",null,c(d.value.address),1)]),_:1}),e(_,{label:"企业品牌",prop:""},{default:t(()=>[r("span",null,c(d.value.companyBrand&&d.value.companyBrand.length>0?d.value.companyBrand.join(","):""),1)]),_:1}),(u(!0),y(R,null,H(G.value,(l,E)=>(u(),C(_,{key:l.key,label:l.name},{default:t(()=>[l.type===5?(u(),y("span",dt,c(l.value instanceof Array?l.value.join("，"):l.value),1)):l.type===7?(u(),y("span",ut,c(l.value instanceof Array?l.value.join("，"):l.value),1)):(u(),y("span",pt,c(l.value),1))]),_:2},1032,["label"]))),128)),e(_,{label:"参展联系人",prop:"",style:{"margin-bottom":"10px"}},{default:t(()=>[e(p,{onClick:a.setAdd},{default:t(()=>[s("添加")]),_:1},8,["onClick"])]),_:1}),e(Y,{border:"",data:a.list,"show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:t(()=>[e(i,{prop:"name",label:"姓名"}),e(i,{prop:"duties",label:"职务"}),e(i,{prop:"type",label:"类别"},{default:t(l=>[s(c(["无","展位","财务","市场","现场"][l.row.type]),1)]),_:1}),e(i,{prop:"mobile",label:"手机号"}),e(i,{prop:"tel",label:"电话"}),e(i,{prop:"email",label:"邮箱"}),e(i,{prop:"wechat",label:"微信"}),e(i,{prop:"status",label:"在职状态","min-width":"120"},{default:t(l=>[s(c(["","在职","离职","调岗"][l.row.status]),1)]),_:1}),e(i,{prop:"isExhibitionContact",label:"展会联系人"},{default:t(l=>[s(c(l.row.isExhibitionContact===1?"是":"否"),1)]),_:1}),e(i,{label:"操作",fixed:"right",width:"150"},{default:t(l=>[e(p,{link:"",type:"primary",onClick:E=>a.setEdit(l.row)},{default:t(()=>[s("编辑")]),_:2},1032,["onClick"]),e(p,{link:"",type:"danger",onClick:E=>a.del(l.row.id)},{default:t(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},512)])]),_:1}),T(I)==="2"?(u(),C(z,{key:0,label:"订单",name:2},{default:t(()=>[ct,e(Y,{data:d.value.orderPosition,border:"","show-overflow-tooltip":""},{default:t(()=>[e(i,{prop:"orderCode",label:"订单编号","min-width":"120"}),e(i,{prop:"brand",label:"品牌"}),e(i,{prop:"positionCode",label:"展位号"}),e(i,{prop:"price",label:"订单金额","min-width":"120"}),e(i,{label:"操作",width:"150",fixed:"right"},{default:t(l=>[e(p,{link:"",type:"primary",onClick:E=>n.$router.push({name:"OrderBoothDetail",query:{id:l.row.id}})},{default:t(()=>[s("详情")]),_:2},1032,["onClick"]),l.row.orderStatus===1?(u(),C(p,{key:0,link:"",type:"primary",onClick:E=>m(l.row.id,1)},{default:t(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),y(R,{key:1},[e(p,{link:"",type:"info",disabled:""},{default:t(()=>[s("已撤销")]),_:1}),e(p,{link:"",type:"danger",onClick:E=>N(l.row.id,1)},{default:t(()=>[s("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"]),mt,e(Y,{data:d.value.orderMaterial,border:"","show-overflow-tooltip":""},{default:t(()=>[e(i,{prop:"orderCode",label:"订单编号","min-width":"120"}),e(i,{prop:"positionCode",label:"展位号"}),e(i,{prop:"price",label:"订单金额","min-width":"120"}),e(i,{label:"操作",width:"150",fixed:"right"},{default:t(l=>[e(p,{link:"",type:"primary",onClick:E=>me(l.row.id)},{default:t(()=>[s("详情")]),_:2},1032,["onClick"]),l.row.orderStatus===1?(u(),C(p,{key:0,link:"",type:"primary",onClick:E=>m(l.row.id,2)},{default:t(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),y(R,{key:1},[e(p,{link:"",type:"info",disabled:""},{default:t(()=>[s("已撤销")]),_:1}),e(p,{link:"",type:"danger",onClick:E=>N(l.row.id,2)},{default:t(()=>[s("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),_:1})):A("",!0),T(I)==="2"?(u(),C(z,{key:1,label:"合同",name:3},{default:t(()=>[e(Y,{data:d.value.contract,border:"","show-overflow-tooltip":""},{default:t(()=>[e(i,{prop:"contractCode",label:"合同编号","min-width":"120"}),e(i,{prop:"contractType",label:"合同类型","min-width":"120"},{default:t(l=>[s(c({1:"展位合同",2:"物料合同",3:"展位+物料"}[l.row.contractType]),1)]),_:1}),e(i,{prop:"contractAmount",label:"合同金额","min-width":"120"}),e(i,{prop:"deposit",label:"预定金"}),e(i,{prop:"",label:"抵扣"}),e(i,{prop:"firstPayPrice",label:"一期款"}),e(i,{prop:"firstPayTime",label:"期限"}),e(i,{prop:"finalPayPrice",label:"尾款"}),e(i,{prop:"finalPayTime",label:"期限"}),e(i,{prop:"receivedPrice",label:"已收款"}),e(i,{prop:"unknownPrice",label:"未收款"}),e(i,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:t(l=>[s(c({0:"撤销",1:"已完成"}[l.row.contractStatus]),1)]),_:1}),e(i,{label:"操作",width:"200",fixed:"right"},{default:t(l=>[e(p,{link:"",type:"primary",onClick:E=>n.$router.push({name:"ContractDetail",query:{orderId:l.row.orderId}})},{default:t(()=>[s("详情")]),_:2},1032,["onClick"]),l.row.contractStatus===1?(u(),C(p,{key:0,link:"",type:"primary",onClick:E=>fe(l.row.orderId)},{default:t(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),C(p,{key:1,link:"",type:"info",disabled:""},{default:t(()=>[s("已撤销")]),_:1}))]),_:1})]),_:1},8,["data"])]),_:1})):A("",!0)]),_:1},8,["modelValue","onTabChange"])]),r("div",ft,[e(ze,{ref_key:"followUp",ref:w,clueId:T(b)},null,8,["clueId"])])])]),e(ve,{title:a.isEdit?"编辑":"添加联系人",modelValue:a.show,"onUpdate:modelValue":o[16]||(o[16]=l=>a.show=l),width:"500px",draggable:""},{footer:t(()=>[e(p,{type:"default",onClick:o[13]||(o[13]=l=>a.show=!1)},{default:t(()=>[s("取消")]),_:1}),a.isEdit?(u(),C(p,{key:0,type:"primary",onClick:o[14]||(o[14]=()=>a.edit())},{default:t(()=>[s("修改")]),_:1})):(u(),C(p,{key:1,type:"primary",onClick:o[15]||(o[15]=()=>a.add())},{default:t(()=>[s("添加")]),_:1}))]),default:t(()=>[e(Q,{ref_key:"lxrRef",ref:k,model:a.form,"label-width":"auto","label-position":"left"},{default:t(()=>[e(_,{label:"姓名",prop:"name",rules:[{required:!0,message:"请输入姓名"}]},{default:t(()=>[e(L,{modelValue:a.form.name,"onUpdate:modelValue":o[4]||(o[4]=l=>a.form.name=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"职务",prop:"duties",rules:[{required:!0,message:"请输入职务"}]},{default:t(()=>[e(L,{modelValue:a.form.duties,"onUpdate:modelValue":o[5]||(o[5]=l=>a.form.duties=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"类别"},{default:t(()=>[e(W,{modelValue:a.form.type,"onUpdate:modelValue":o[6]||(o[6]=l=>a.form.type=l)},{default:t(()=>[e(B,{label:"无",value:0}),e(B,{label:"展位",value:1}),e(B,{label:"财务",value:2}),e(B,{label:"市场",value:3}),e(B,{label:"现场",value:4})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"手机号",prop:"mobile",rules:T(qe).phone},{default:t(()=>[e(L,{modelValue:a.form.mobile,"onUpdate:modelValue":o[7]||(o[7]=l=>a.form.mobile=l)},null,8,["modelValue"])]),_:1},8,["rules"]),e(_,{label:"电话"},{default:t(()=>[e(L,{modelValue:a.form.tel,"onUpdate:modelValue":o[8]||(o[8]=l=>a.form.tel=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"邮箱"},{default:t(()=>[e(L,{modelValue:a.form.email,"onUpdate:modelValue":o[9]||(o[9]=l=>a.form.email=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"微信"},{default:t(()=>[e(L,{modelValue:a.form.wechat,"onUpdate:modelValue":o[10]||(o[10]=l=>a.form.wechat=l)},null,8,["modelValue"])]),_:1}),e(_,{label:"在职状态",prop:"status",rules:[{required:!0,message:"请选择在职状态"}]},{default:t(()=>[e(W,{modelValue:a.form.status,"onUpdate:modelValue":o[11]||(o[11]=l=>a.form.status=l)},{default:t(()=>[e(B,{label:"在职",value:1}),e(B,{label:"离职",value:2}),e(B,{label:"调岗",value:3})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"展会联系人",prop:"isExhibitionContact",rules:[{required:!0,message:"请选择展会联系人"}]},{default:t(()=>[e(h,{modelValue:a.form.isExhibitionContact,"onUpdate:modelValue":o[12]||(o[12]=l=>a.form.isExhibitionContact=l),class:"ml-4"},{default:t(()=>[e(g,{value:1},{default:t(()=>[s("是")]),_:1}),e(g,{value:0},{default:t(()=>[s("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(Fe,{ref_key:"moveRef",ref:D,onCallback:$},null,512),e(Le,{ref_key:"detailRef",ref:X},null,512)],64)}}}),ol=pe(_t,[["__scopeId","data-v-1d523d8a"]]);export{ol as default};
