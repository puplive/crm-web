import{d as le,a0 as re,t as f,z as ie,y as R,b,X as k,$ as l,i as a,J as E,a5 as ne,am as se,a7 as c,o as r,Y as i,a1 as de,Z as x,h as s,ak as m,e as pe,aB as ue}from"./index-B6iLQo86.js";import{E as ce}from"./dialog-CENdDqnb.js";/* empty css                */import{E as me}from"./progress-D3O32-FO.js";/* empty css                    */import{E as fe,a as _e}from"./radio-D8XVkGfS.js";import{E as he,a as ye,_ as ge}from"./sx-Wg2jNrT3.js";/* empty css              */import"./tag-CrxgzzqE.js";import"./select-CiM7jlhw.js";import"./scrollbar-CxomNflS.js";import"./popper-gYmmCBAL.js";import{E as ke,a as ve}from"./table-column-DK07rXsE.js";import{E as be,a as we}from"./checkbox-Da4NUTzJ.js";/* empty css                *//* empty css                       */import{E as Ce}from"./button-5AEbNLUW.js";import{_ as Ee}from"./index.vue_vue_type_script_setup_true_lang-B7L_o8rg.js";/* empty css                                              */import{b as g}from"./index-f794kgfk.js";import{u as xe}from"./index-Co9xmp72.js";import{d as Ie}from"./index-6LQ5lbPy.js";import{z as Be}from"./fileZip-BxkCn0zM.js";import{E as Se}from"./ExhibitionChange-BwZHKvWt.js";/* empty css                    *//* empty css                */import{E as D}from"./index-CNRzEN9G.js";import"./index-C6HaxJ0m.js";import"./use-form-item-CfnmRR4I.js";import"./scroll-93LZPfoz.js";import"./vnode-CvIq0L5T.js";import"./focus-trap-CbOJCEa5.js";import"./refs-BuFar0Py.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-L0YKcdce.js";import"./_baseClone-BrWLt5Gy.js";import"./_initCloneObject-qAExOYFR.js";import"./isEqual-Hfk1WuHp.js";import"./index-Cl7FP3t8.js";import"./dropdown-DTfYBFWq.js";import"./castArray-Dr2SrWm_.js";import"./form-item-C2ENUIsg.js";/* empty css                      */import"./index-mORRlnij.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-CJHBNJId.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./aria-KgdLjl5h.js";import"./validator-9QqxxWlE.js";const Te={class:"s-flex-col",style:{height:"100%"}},Ve={class:"",style:{"margin-bottom":"10px"}},ze={class:"s-table-operations"},Ue=k("img",{style:{width:"17px"},src:ge,alt:""},null,-1),$e={class:"s-flex-auto",style:{"min-height":"0"}},Ne={class:"s-table-pagination"},zt=le({__name:"Booth",setup(Re){const T=re(),V=f(T.EXHIBITION_INFO);ie(()=>T.EXHIBITION_INFO,(e,t)=>{e.id!==t.id&&(V.value=e,y())},{deep:!0}),ne();const F=se(),h=f(!1),v=R({page:1,perPage:20}),z=f(0),U=f({}),P=F.query.id,I=f([]),B=f(null),$=f([]),d=R({show:!1,file:"",type:1,orderId:""}),L=e=>{U.value=e,v.page=1,y()},y=()=>{g.getList({exhibitionId:V.value.id,...v,...U.value}).then(e=>{e.code===0?(I.value=e.data.data,z.value=e.data.total):I.value=[{}]})},O=e=>{D.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.revoke({id:e}).then(t=>{t.code===0?(c.success("撤销成功"),y()):c.error(t.msg)})}).catch(()=>{})},q=e=>{D.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.del({id:e}).then(t=>{t.code===0?(c.success("删除成功"),y()):c.error(t.msg)})}).catch(()=>{})},M=()=>{let e=B.value.getSelectionRows().map(t=>t.id);if(e.length===0){c.error("请选择需要下载的数据");return}Ie({orderId:e}).then(t=>{if(t.code===0){if(t.data.length===0){c.error("无数据");return}Be(t.data)}else c.error(t.msg)})},j=()=>{g.export({exhibitionId:P}).then(e=>{e.code===0?(window.open(e.data.url,"_self"),c.success("导出成功")):c.error(e.msg)})},X=f(null);let _=f([]);const G=e=>{let t=e[0];_.value=[{name:t.name,size:t.size,uid:t.uid,status:"ready",percentage:0,raw:t}]},H=e=>{const t=e.size/1024/1024<3;return t||c.error("文件大小不能超过 3MB!"),t},J=e=>{d.show=!0,d.type=1,d.orderId=e,d.file="",_.value=[]},Y=()=>{if(d.type===1&&_.value.length===0){c.error("请选择合同文件");return}if(h.value=!0,_.value.length===0)g.receipt({orderId:d.orderId,type:d.type}).then(e=>{e.code===0?(c.success("上传成功"),d.show=!1,y()):c.error(e.msg),h.value=!1}).catch(()=>{h.value=!1});else{let e=new FormData;e.append("upload",_.value[0].raw),xe(e).then(t=>{t.code===0?g.receipt({orderId:d.orderId,type:d.type,url:t.data.url}).then(u=>{u.code===0?(c.success("上传成功"),d.show=!1,y()):c.error(u.msg),h.value=!1}).catch(()=>{h.value=!1}):(c.error(t.msg),h.value=!1)}).catch(()=>{h.value=!1})}};g.getSearchField().then(e=>{e.code===0&&($.value=e.data)}),y();const w=f([]),S=f([]),Z=()=>{setTimeout(()=>{let e=[];B.value.columns.forEach(t=>{t.label&&e.push(t.label)}),S.value=e.join(",").split(","),w.value=e.join(",").split(",")},0)},p=e=>w.value.length===0&&S.value.length===0?!0:w.value.includes(e);return Z(),(e,t)=>{const u=Ce,A=be,K=we,Q=he,n=ve,W=ke,ee=ye,N=fe,te=_e,oe=me,ae=ce;return r(),b(E,null,[k("div",Te,[k("div",Ve,[l(Se)]),l(Ee,{data:$.value,onSearch:L},null,8,["data"]),k("div",ze,[l(u,{onClick:M},{default:a(()=>[i("批量下载合同")]),_:1}),l(u,{onClick:j},{default:a(()=>[i("导出")]),_:1}),l(Q,{placement:"bottom-end",trigger:"click"},{reference:a(()=>[l(u,{size:"",link:""},{default:a(()=>[Ue]),_:1})]),default:a(()=>[l(K,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=o=>w.value=o)},{default:a(()=>[k("ul",null,[(r(!0),b(E,null,de(S.value,o=>(r(),b("li",{class:"s-checkbox_item",key:o},[l(A,{label:o,value:o},{default:a(()=>[i(x(o),1)]),_:2},1032,["label","value"])]))),128))])]),_:1},8,["modelValue"])]),_:1})]),k("div",$e,[l(W,{ref_key:"tableRef",ref:B,data:I.value,border:"",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:a(()=>[l(n,{type:"selection",width:"40",fixed:"left"}),p("订单编号")?(r(),s(n,{key:0,prop:"orderCode",label:"订单编号",width:"280"})):m("",!0),p("企业名称")?(r(),s(n,{key:1,prop:"companyName",label:"企业名称","min-width":"120"})):m("",!0),p("展会名称")?(r(),s(n,{key:2,prop:"exhibitionName",label:"展会名称","min-width":"120"})):m("",!0),p("展馆号")?(r(),s(n,{key:3,prop:"hallCode",label:"展馆号"})):m("",!0),p("展位号")?(r(),s(n,{key:4,prop:"positionCode",label:"展位号"})):m("",!0),p("面积")?(r(),s(n,{key:5,prop:"area",label:"面积"})):m("",!0),p("展位数量")?(r(),s(n,{key:6,prop:"num",label:"展位数量","min-width":"120"})):m("",!0),p("订单金额")?(r(),s(n,{key:7,prop:"orderPrice",label:"订单金额","min-width":"120"})):m("",!0),p("下单方式")?(r(),s(n,{key:8,prop:"orderType",label:"下单方式","min-width":"120"},{default:a(o=>[i(x(o.row.orderType===1?"代下单":"展商下单"),1)]),_:1})):m("",!0),p("付款状态")?(r(),s(n,{key:9,prop:"payStatus",label:"付款状态","min-width":"120"},{default:a(o=>[i(x({0:"未付款",1:"部分付款",2:"已付款"}[o.row.payStatus]),1)]),_:1})):m("",!0),p("到款金额")?(r(),s(n,{key:10,prop:"receivedPrice",label:"到款金额","min-width":"120"})):m("",!0),p("合同状态")?(r(),s(n,{key:11,prop:"contractStatus",label:"合同状态","min-width":"120"},{default:a(o=>[i(x({0:"未签订",1:"已签订",2:"已回执(电子)",3:"已回执(纸质)"}[o.row.contractStatus]),1)]),_:1})):m("",!0),p("发票状态")?(r(),s(n,{key:12,prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:a(o=>[i(x({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[o.row.invoiceStatus]),1)]),_:1})):m("",!0),p("持有人")?(r(),s(n,{key:13,prop:"clueUser",label:"持有人"})):m("",!0),p("下单人")?(r(),s(n,{key:14,prop:"authUser",label:"下单人"})):m("",!0),p("操作")?(r(),s(n,{key:15,fixed:"right",label:"操作",width:"250"},{default:a(o=>[l(u,{link:"",type:"primary",onClick:C=>e.$router.push({name:"OrderBoothDetail",query:{id:o.row.id}})},{default:a(()=>[i("详情")]),_:2},1032,["onClick"]),o.row.orderStatus!==0?(r(),b(E,{key:0},[o.row.contractStatus===0?(r(),s(u,{key:0,link:"",type:"primary",onClick:C=>e.$router.push({name:"ContractTemplates",query:{id:o.row.id,type:1}})},{default:a(()=>[i("签订合同")]),_:2},1032,["onClick"])):(r(),b(E,{key:1},[l(u,{link:"",type:"primary",onClick:C=>e.$router.push({name:"ContractConclude",query:{id:o.row.contractTemplateId,orderId:o.row.id,isUpdate:1}})},{default:a(()=>[i("更新合同")]),_:2},1032,["onClick"]),l(u,{link:"",type:"primary",onClick:C=>J(o.row.id)},{default:a(()=>[i("上传合同")]),_:2},1032,["onClick"])],64)),l(u,{link:"",type:"primary",onClick:C=>O(o.row.id)},{default:a(()=>[i("撤销")]),_:2},1032,["onClick"])],64)):(r(),b(E,{key:1},[l(u,{link:"",type:"",disabled:""},{default:a(()=>[i("已撤销")]),_:1}),l(u,{link:"",type:"danger",onClick:C=>q(o.row.id)},{default:a(()=>[i("删除")]),_:2},1032,["onClick"])],64))]),_:1})):m("",!0)]),_:1},8,["data"])]),k("div",Ne,[l(ee,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50,100],total:z.value,"current-page":v.page,"onUpdate:currentPage":t[1]||(t[1]=o=>v.page=o),"page-size":v.perPage,"onUpdate:pageSize":t[2]||(t[2]=o=>v.perPage=o),onChange:y},null,8,["total","current-page","page-size"])])]),l(ae,{modelValue:d.show,"onUpdate:modelValue":t[6]||(t[6]=o=>d.show=o),title:"上传合同",width:"400",draggable:""},{footer:a(()=>[l(u,{type:"primary",onClick:Y,loading:h.value},{default:a(()=>[i("确定")]),_:1},8,["loading"]),l(u,{onClick:t[5]||(t[5]=o=>d.show=!1)},{default:a(()=>[i("取消")]),_:1})]),default:a(()=>[l(te,{modelValue:d.type,"onUpdate:modelValue":t[3]||(t[3]=o=>d.type=o)},{default:a(()=>[l(N,{value:1},{default:a(()=>[i("电子合同")]),_:1}),l(N,{value:2},{default:a(()=>[i("纸质合同")]),_:1})]),_:1},8,["modelValue"]),l(oe,{ref_key:"uploadRef",ref:X,"auto-upload":!1,limit:1,"before-upload":H,"on-exceed":G,"file-list":pe(_),"onUpdate:fileList":t[4]||(t[4]=o=>ue(_)?_.value=o:_=o),style:{"margin-top":"10px"}},{default:a(()=>[l(u,{type:"primary"},{default:a(()=>[i("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])],64)}}});export{zt as default};
