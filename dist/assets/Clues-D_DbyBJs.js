import{d as K,s as W,l as r,o as b,f as k,P as h,S as t,w as o,Q as n,F as C,V as P,c as D}from"./index-DVHkByco.js";import{E as X}from"./el-dialog-bp7p8zQB.js";import"./el-overlay-C63ZvL_K.js";import{a as Y,b as Z}from"./el-input-Dfe8Uzhl.js";import"./el-tag-BHjyucA7.js";import{E as ee,a as le}from"./el-select-DgBIHiZD.js";import"./el-scrollbar-CG_JaPfx.js";import{E as te}from"./el-pagination-Y47XXVE0.js";import{E as oe,a as ae}from"./el-table-89c60yQ4.js";import"./el-checkbox-Cqc95xet.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                        */import{E as ie}from"./el-button-9__Ng1jP.js";import{T as re}from"./index-CfuTKQ2m.js";import{a as m}from"./index-D6JUichE.js";import{e as ne}from"./index-nGf7mDmu.js";import{g as se}from"./index-C62duh_X.js";/* empty css                   */import{E as ue}from"./el-message-box-BcM5ZuTJ.js";import{E as i}from"./request-kZhpW0Wr.js";import"./index-C-4RkVC5.js";import"./scroll-KUqymI_7.js";import"./vnode-tcDvg3gh.js";import"./typescript-_aKlIHPK.js";import"./_initCloneObject-CSxpNamp.js";import"./isEqual-QQ34r9eu.js";import"./isArrayLikeObject-C7wPhYU0.js";import"./el-date-picker-fOPNftKE.js";import"./arrays-6TrVLtTe.js";import"./el-radio-BWxioSU6.js";/* empty css                          */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./aria-KgdLjl5h.js";import"./validator-BJiU7xXV.js";const de={class:"s-table-operations"},me={class:"s-table-pagination"},pe={class:"dialog-footer"},ce={class:"dialog-footer"},We=K({__name:"Clues",setup(fe){const p=W({page:1,perPage:10}),x=r(0),E=r({}),S=r([]),c=r(null),y=r([]),V=r([]),M=l=>{E.value=l,p.page=1,d()},d=async()=>{m.getList({status:1,...p,...E.value}).then(l=>{l.code!==200&&(S.value=l.data.data,x.value=l.data.total)})},f=r({}),g=r(!1),z=r(null),N=l=>{f.value.id=l.id,g.value=!0},$=()=>{z.value.validate(l=>{l&&m.changeIntention(f.value).then(e=>{e.code===0?(i.success("转为意向成功"),d(),g.value=!1):i.error(e.msg)})})},L=()=>{let l=c.value.getSelectionRows().map(e=>e.id);if(l.length===0){i.warning("请选择需要领取的线索");return}m.getClues({id:l}).then(e=>{e.code===0?(i.success("领取成功"),d()):i.error(e.msg)})},q=()=>{let l=c.value.getSelectionRows().map(e=>e.id);if(l.length===0){i.warning("请选择需要删除的线索");return}ue.confirm("确定删除所选线索？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.del({id:l}).then(e=>{e.code===0?(i.success("删除成功"),d()):i.error(e.msg)})}).catch(()=>{})},v=r({}),_=r(!1),F=r(null),R=r([]),G=()=>{let l=c.value.getSelectionRows().map(e=>e.id);if(l.length===0){i.warning("请选择需要转移的线索");return}v.value.id=l,_.value=!0},O=()=>{F.value.validate(l=>{l&&m.changeUser(v.value).then(e=>{e.code===0?(i.success("转移成功"),_.value=!1,d()):i.error(e.msg)})})},Q=()=>{let l=c.value.getSelectionRows().map(e=>e.id);if(l.length===0){i.warning("请选择需要移至公海的线索");return}m.changePublic({id:l}).then(e=>{e.code===0?(i.success("移至公海成功"),d()):i.error(e.msg)})},j=()=>{console.log("import")},A=()=>{console.log("export")};return m.getSearchField().then(l=>{l.code===0&&(y.value=l.data)}),ne().then(l=>{l.code===0&&(V.value=l.data)}),se().then(l=>{l.code===0&&(R.value=l.data)}),d(),(l,e)=>{const s=ie,u=oe,H=ae,J=te,U=le,I=ee,w=Y,T=Z,B=X;return b(),k(C,null,[h("div",null,[t(re,{data:y.value,onSearch:M},null,8,["data"]),h("div",de,[t(s,{size:"small",onClick:e[0]||(e[0]=a=>l.$router.push("/market/clues/add"))},{default:o(()=>[n("新增")]),_:1}),t(s,{size:"small",onClick:j},{default:o(()=>[n("导入")]),_:1}),t(s,{size:"small",onClick:A},{default:o(()=>[n("导出")]),_:1}),t(s,{size:"small",onClick:G},{default:o(()=>[n("转移给他人")]),_:1}),t(s,{size:"small",onClick:L},{default:o(()=>[n("领取")]),_:1}),t(s,{size:"small",onClick:Q},{default:o(()=>[n("移至公海")]),_:1}),t(s,{size:"small",onClick:q},{default:o(()=>[n("删除")]),_:1})]),t(H,{ref_key:"tableRef",ref:c,data:S.value,border:"","table-layout":"fixed","max-height":"300","header-row-class-name":"s-table-header"},{default:o(()=>[t(u,{type:"selection",width:"50"}),t(u,{prop:"companyName",label:"公司名称",width:"180"}),t(u,{prop:"exhibitionContact",label:"联系方式",width:"180"}),t(u,{prop:"duties",label:"职务"}),t(u,{prop:"phone",label:"电话"}),t(u,{prop:"recordTime",label:"记录时间",width:"180"}),t(u,{prop:"recordText",label:"记录内容"}),t(u,{prop:"authUser",label:"授权人"}),t(u,{fixed:"right",label:"操作",width:"120"},{default:o(a=>[t(s,{link:"",type:"primary",size:"small",onClick:ge=>N(a.row)},{default:o(()=>[n(" 转为意向客户 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),h("div",me,[t(J,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:x.value,"current-page":p.page,"onUpdate:currentPage":e[1]||(e[1]=a=>p.page=a),"page-size":p.perPage,"onUpdate:pageSize":e[2]||(e[2]=a=>p.perPage=a),onChange:d},null,8,["total","current-page","page-size"])])]),t(B,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),title:"转为意向客户",width:"500",draggable:""},{footer:o(()=>[h("div",pe,[t(s,{onClick:e[4]||(e[4]=a=>g.value=!1)},{default:o(()=>[n("取消")]),_:1}),t(s,{type:"primary",onClick:$},{default:o(()=>[n("确定")]),_:1})])]),default:o(()=>[t(T,{ref_key:"willFormRef",ref:z,model:f.value,"label-width":"auto"},{default:o(()=>[t(w,{label:"项目",prop:"exhibitionId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[t(I,{modelValue:f.value.exhibitionId,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value.exhibitionId=a),placeholder:""},{default:o(()=>[(b(!0),k(C,null,P(V.value,a=>(b(),D(U,{key:a.id,label:a.exhibitionName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(B,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=a=>_.value=a),title:"转移销售线索",width:"500",draggable:""},{footer:o(()=>[h("div",ce,[t(s,{onClick:e[7]||(e[7]=a=>_.value=!1)},{default:o(()=>[n("取消")]),_:1}),t(s,{type:"primary",onClick:O},{default:o(()=>[n("确定")]),_:1})])]),default:o(()=>[t(T,{ref_key:"moveFormRef",ref:F,model:v.value,"label-width":"auto"},{default:o(()=>[t(w,{label:""},{default:o(()=>[n("是否将选中的销售线索转移？")]),_:1}),t(w,{label:"销售线索所有人",prop:"userId",rules:[{required:!0,message:"请选择销售线索所有人"}]},{default:o(()=>[t(I,{modelValue:v.value.userId,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.userId=a),placeholder:""},{default:o(()=>[(b(!0),k(C,null,P(R.value,a=>(b(),D(U,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{We as default};
