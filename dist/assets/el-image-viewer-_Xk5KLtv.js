import{m as ve,b as Y}from"./typescript-CTRgrCvb.js";import{a0 as X,aI as Ie,j as pe,I as H,aa as ce,d as ne,aJ as me,aK as _e,aL as Le,a4 as ge,u as ye,aM as ze,l as k,aN as Ce,a1 as Se,e as w,v as ue,M as we,y as he,o as b,c as de,S as v,w as C,P as h,n as p,a as e,g as fe,a8 as Ee,X as S,a6 as Ne,f as T,F as te,aD as Te,q as xe,aO as Oe,aP as Re,ab as $e,aQ as Ae,aR as Xe,W as Ye,C as Be,D as Me,r as ae,T as Ve,aS as De,aT as Pe,h as be,aq as Fe,aU as He,m as We,aV as je,B as Ke,R as qe}from"./index-CeUaYvVA.js";import{E as x,_ as ke}from"./index-iYWA_S4l.js";import{E as A}from"./aria-BUADUvnR.js";import{d as Ue}from"./el-tag-Bffi55J-.js";import{a as Ze}from"./index-nNlqqqFz.js";import{g as Ge}from"./scroll-DsbyhrQW.js";const Je=(s,c)=>{if(!X||!s||!c)return!1;const n=s.getBoundingClientRect();let m;return c instanceof Element?m=c.getBoundingClientRect():m={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<m.bottom&&n.bottom>m.top&&n.right>m.left&&n.left<m.right},ka=s=>{let c,n;return s.type==="touchend"?(n=s.changedTouches[0].clientY,c=s.changedTouches[0].clientX):s.type.startsWith("touch")?(n=s.touches[0].clientY,c=s.touches[0].clientX):(n=s.clientY,c=s.clientX),{clientX:c,clientY:n}};var Qe="Expected a function";function ie(s,c,n){var m=!0,r=!0;if(typeof s!="function")throw new TypeError(Qe);return Ie(n)&&(m="leading"in n?!!n.leading:m,r="trailing"in n?!!n.trailing:r),Ue(s,c,{leading:m,maxWait:c,trailing:r})}const ea=pe({urlList:{type:H(Array),default:()=>ve([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),aa={close:()=>!0,switch:s=>ce(s),rotate:s=>ce(s)},ta=["src","crossorigin"],na=ne({name:"ElImageViewer"}),sa=ne({...na,props:ea,emits:aa,setup(s,{expose:c,emit:n}){var m;const r=s,y={CONTAIN:{name:"contain",icon:me(_e)},ORIGINAL:{name:"original",icon:me(Le)}},{t:se}=ge(),u=ye("image-viewer"),{nextZIndex:B}=ze(),E=k(),N=k([]),O=Ce(),I=k(!0),d=k(r.initialIndex),R=Se(y.CONTAIN),o=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),M=k((m=r.zIndex)!=null?m:B()),le=w(()=>{const{urlList:t}=r;return t.length<=1}),W=w(()=>d.value===0),j=w(()=>d.value===r.urlList.length-1),V=w(()=>r.urlList[d.value]),oe=w(()=>[u.e("btn"),u.e("prev"),u.is("disabled",!r.infinite&&W.value)]),K=w(()=>[u.e("btn"),u.e("next"),u.is("disabled",!r.infinite&&j.value)]),D=w(()=>{const{scale:t,deg:l,offsetX:i,offsetY:_,enableTransition:z}=o.value;let g=i/t,L=_/t;switch(l%360){case 90:case-270:[g,L]=[L,-g];break;case 180:case-180:[g,L]=[-g,-L];break;case 270:case-90:[g,L]=[-L,g];break}const $={transform:`scale(${t}) rotate(${l}deg) translate(${g}px, ${L}px)`,transition:z?"transform .3s":""};return R.value.name===y.CONTAIN.name&&($.maxWidth=$.maxHeight="100%"),$});function P(){q(),n("close")}function re(){const t=ie(i=>{switch(i.code){case A.esc:r.closeOnPressEscape&&P();break;case A.space:Q();break;case A.left:ee();break;case A.up:f("zoomIn");break;case A.right:a();break;case A.down:f("zoomOut");break}}),l=ie(i=>{const _=i.deltaY||i.deltaX;f(_<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});O.run(()=>{Y(document,"keydown",t),Y(document,"wheel",l)})}function q(){O.stop()}function U(){I.value=!1}function Z(t){I.value=!1,t.target.alt=se("el.image.error")}function G(t){if(I.value||t.button!==0||!E.value)return;o.value.enableTransition=!1;const{offsetX:l,offsetY:i}=o.value,_=t.pageX,z=t.pageY,g=ie($=>{o.value={...o.value,offsetX:l+$.pageX-_,offsetY:i+$.pageY-z}}),L=Y(document,"mousemove",g);Y(document,"mouseup",()=>{L()}),t.preventDefault()}function J(){o.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Q(){if(I.value)return;const t=Pe(y),l=Object.values(y),i=R.value.name,z=(l.findIndex(g=>g.name===i)+1)%t.length;R.value=y[t[z]],J()}function F(t){const l=r.urlList.length;d.value=(t+l)%l}function ee(){W.value&&!r.infinite||F(d.value-1)}function a(){j.value&&!r.infinite||F(d.value+1)}function f(t,l={}){if(I.value)return;const{minScale:i,maxScale:_}=r,{zoomRate:z,rotateDeg:g,enableTransition:L}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...l};switch(t){case"zoomOut":o.value.scale>i&&(o.value.scale=Number.parseFloat((o.value.scale/z).toFixed(3)));break;case"zoomIn":o.value.scale<_&&(o.value.scale=Number.parseFloat((o.value.scale*z).toFixed(3)));break;case"clockwise":o.value.deg+=g,n("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=g,n("rotate",o.value.deg);break}o.value.enableTransition=L}return ue(V,()=>{we(()=>{const t=N.value[0];t!=null&&t.complete||(I.value=!0)})}),ue(d,t=>{J(),n("switch",t)}),he(()=>{var t,l;re(),(l=(t=E.value)==null?void 0:t.focus)==null||l.call(t)}),c({setActiveItem:F}),(t,l)=>(b(),de(De,{to:"body",disabled:!t.teleported},[v(Ve,{name:"viewer-fade",appear:""},{default:C(()=>[h("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:p(e(u).e("wrapper")),style:fe({zIndex:M.value})},[h("div",{class:p(e(u).e("mask")),onClick:l[0]||(l[0]=Ee(i=>t.hideOnClickModal&&P(),["self"]))},null,2),S(" CLOSE "),h("span",{class:p([e(u).e("btn"),e(u).e("close")]),onClick:P},[v(e(x),null,{default:C(()=>[v(e(Ne))]),_:1})],2),S(" ARROW "),e(le)?S("v-if",!0):(b(),T(te,{key:0},[h("span",{class:p(e(oe)),onClick:ee},[v(e(x),null,{default:C(()=>[v(e(Te))]),_:1})],2),h("span",{class:p(e(K)),onClick:a},[v(e(x),null,{default:C(()=>[v(e(xe))]),_:1})],2)],64)),S(" ACTIONS "),h("div",{class:p([e(u).e("btn"),e(u).e("actions")])},[h("div",{class:p(e(u).e("actions__inner"))},[v(e(x),{onClick:l[1]||(l[1]=i=>f("zoomOut"))},{default:C(()=>[v(e(Oe))]),_:1}),v(e(x),{onClick:l[2]||(l[2]=i=>f("zoomIn"))},{default:C(()=>[v(e(Re))]),_:1}),h("i",{class:p(e(u).e("actions__divider"))},null,2),v(e(x),{onClick:Q},{default:C(()=>[(b(),de($e(e(R).icon)))]),_:1}),h("i",{class:p(e(u).e("actions__divider"))},null,2),v(e(x),{onClick:l[3]||(l[3]=i=>f("anticlockwise"))},{default:C(()=>[v(e(Ae))]),_:1}),v(e(x),{onClick:l[4]||(l[4]=i=>f("clockwise"))},{default:C(()=>[v(e(Xe))]),_:1})],2)],2),S(" CANVAS "),h("div",{class:p(e(u).e("canvas"))},[(b(!0),T(te,null,Ye(t.urlList,(i,_)=>Be((b(),T("img",{ref_for:!0,ref:z=>N.value[_]=z,key:i,src:i,style:fe(e(D)),class:p(e(u).e("img")),crossorigin:t.crossorigin,onLoad:U,onError:Z,onMousedown:G},null,46,ta)),[[Me,_===d.value]])),128))],2),ae(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var la=ke(sa,[["__file","image-viewer.vue"]]);const oa=be(la),ra=pe({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:H([String,Object])},previewSrcList:{type:H(Array),default:()=>ve([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),ia={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>ce(s),close:()=>!0,show:()=>!0},ca=["src","loading","crossorigin"],ua={key:0},da=ne({name:"ElImage",inheritAttrs:!1}),fa=ne({...da,props:ra,emits:ia,setup(s,{emit:c}){const n=s;let m="";const{t:r}=ge(),y=ye("image"),se=Fe(),u=Ze(),B=k(),E=k(!1),N=k(!0),O=k(!1),I=k(),d=k(),R=X&&"loading"in HTMLImageElement.prototype;let o,M;const le=w(()=>[y.e("inner"),V.value&&y.e("preview"),N.value&&y.is("loading")]),W=w(()=>se.style),j=w(()=>{const{fit:a}=n;return X&&a?{objectFit:a}:{}}),V=w(()=>{const{previewSrcList:a}=n;return Array.isArray(a)&&a.length>0}),oe=w(()=>{const{previewSrcList:a,initialIndex:f}=n;let t=f;return f>a.length-1&&(t=0),t}),K=w(()=>n.loading==="eager"?!1:!R&&n.loading==="lazy"||n.lazy),D=()=>{X&&(N.value=!0,E.value=!1,B.value=n.src)};function P(a){N.value=!1,E.value=!1,c("load",a)}function re(a){N.value=!1,E.value=!0,c("error",a)}function q(){Je(I.value,d.value)&&(D(),G())}const U=He(q,200,!0);async function Z(){var a;if(!X)return;await we();const{scrollContainer:f}=n;je(f)?d.value=f:Ke(f)&&f!==""?d.value=(a=document.querySelector(f))!=null?a:void 0:I.value&&(d.value=Ge(I.value)),d.value&&(o=Y(d,"scroll",U),setTimeout(()=>q(),100))}function G(){!X||!d.value||!U||(o==null||o(),d.value=void 0)}function J(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}function Q(){V.value&&(M=Y("wheel",J,{passive:!1}),m=document.body.style.overflow,document.body.style.overflow="hidden",O.value=!0,c("show"))}function F(){M==null||M(),document.body.style.overflow=m,O.value=!1,c("close")}function ee(a){c("switch",a)}return ue(()=>n.src,()=>{K.value?(N.value=!0,E.value=!1,G(),Z()):D()}),he(()=>{K.value?Z():D()}),(a,f)=>(b(),T("div",{ref_key:"container",ref:I,class:p([e(y).b(),a.$attrs.class]),style:fe(e(W))},[E.value?ae(a.$slots,"error",{key:0},()=>[h("div",{class:p(e(y).e("error"))},qe(e(r)("el.image.error")),3)]):(b(),T(te,{key:1},[B.value!==void 0?(b(),T("img",We({key:0},e(u),{src:B.value,loading:a.loading,style:e(j),class:e(le),crossorigin:a.crossorigin,onClick:Q,onLoad:P,onError:re}),null,16,ca)):S("v-if",!0),N.value?(b(),T("div",{key:1,class:p(e(y).e("wrapper"))},[ae(a.$slots,"placeholder",{},()=>[h("div",{class:p(e(y).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),e(V)?(b(),T(te,{key:2},[O.value?(b(),de(e(oa),{key:0,"z-index":a.zIndex,"initial-index":e(oe),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"url-list":a.previewSrcList,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:F,onSwitch:ee},{default:C(()=>[a.$slots.viewer?(b(),T("div",ua,[ae(a.$slots,"viewer")])):S("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],6))}});var ma=ke(fa,[["__file","image.vue"]]);const Ia=be(ma);export{Ia as E,ka as g};
