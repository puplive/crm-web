import{d as A,l as p,s as S,o as y,b as g,O as v,R as e,i as a,P as r,Q as w,F as h,e as H,as as J,Y as K,a6 as W}from"./index-BCumuH2l.js";import{E as X}from"./el-dialog-Cr31W0vf.js";/* empty css                   */import{E as Z}from"./el-progress-BYlrxkw4.js";/* empty css                 */import{E as ee}from"./el-pagination-D4c8cSyo.js";/* empty css                 */import"./el-tag-BkIRG4gH.js";import"./el-select-Dn8g1hD5.js";import"./el-scrollbar-DYhKSyot.js";import"./el-popper-DuA7pbMX.js";import{E as te,a as oe}from"./el-table-column-BOkQkY76.js";import"./el-checkbox-CCbI2xFo.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{T as ae}from"./index-DzCNvIwH.js";import{_ as le}from"./GoodsOrderDetail.vue_vue_type_script_setup_true_lang-cmBo8B_3.js";import{c as b,b as re}from"./index-t0RjoPPn.js";import{u as ie}from"./index-OHwu8Osq.js";import{a as d}from"./request--qZdk5mN.js";/* empty css                       *//* empty css                   */import{E as B}from"./index-D3W99q7A.js";import{E as ne}from"./index-CGEPfdHm.js";import{E as se,a as pe}from"./index-C93lHvfN.js";import"./index-BBCR1adM.js";import"./index-BNMC9-9K.js";import"./use-form-item-DPxtBdX-.js";import"./scroll-DEYraRnD.js";import"./vnode-DjHHQFRY.js";import"./refs-DC4vuWkM.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-DaR3SEY2.js";import"./_baseClone-7GzUapHy.js";import"./_Uint8Array-CjJrf9_z.js";import"./_initCloneObject-B8PdS-lA.js";import"./isEqual-Du7s0shl.js";import"./index-x58V2ps9.js";import"./castArray--BTnThqL.js";import"./isArrayLikeObject-Y-BCkoqb.js";/* empty css                     *//* empty css                                                              *//* empty css                       *//* empty css                          */import"./index-KsNwzYtN.js";import"./index-DTTQnmv4.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./arrays-6TrVLtTe.js";import"./index-DMIrdWoP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./aria-KgdLjl5h.js";import"./validator-C_mxy1pJ.js";const de={class:"s-flex-col",style:{height:"100%"}},me={class:"s-table-operations"},ue={class:"s-flex-auto",style:{"min-height":"0"}},ce={class:"s-table-pagination"},ct=A({__name:"Goods",setup(fe){K();const $=W(),u=p(!1),c=S({page:1,perPage:10}),C=p(0),E=p({});$.query.id;const k=p([]),U=p(null),V=p([]),s=S({show:!1,file:"",type:1,orderId:0}),D=l=>{E.value=l,c.page=1,f()},f=()=>{b.getList({...c,...E.value}).then(l=>{l.code===0?(k.value=l.data.data,C.value=l.data.total):k.value=[{}]})},P=l=>{B.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.revoke({id:l}).then(t=>{t.code===0?(d.success("撤销成功"),f()):d.error(t.msg)})}).catch(()=>{})},L=l=>{B.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.del({id:l}).then(t=>{t.code===0?(d.success("删除成功"),f()):d.error(t.msg)})}).catch(()=>{})},z=()=>{},F=p(null);let m=p([]);const I=l=>{let t=l[0];m.value=[{name:t.name,size:t.size,uid:t.uid,status:"ready",percentage:0,raw:t}]},M=l=>{const t=l.size/1024/1024<3;return t||d.error("文件大小不能超过 3MB!"),t},x=l=>{s.show=!0,s.type=1,s.orderId=l,s.file="",m.value=[]},N=()=>{if(m.value.length===0){d.warning("请选择合同文件");return}u.value=!0;let l=new FormData;l.append("upload",m.value[0].raw),ie(l).then(t=>{t.code===0?re.receipt({orderId:s.orderId,type:s.type,url:t.data.url}).then(i=>{i.code===0?(d.success("上传成功"),s.show=!1,f()):d.error(i.msg),u.value=!1}).catch(()=>{u.value=!1}):(d.error(t.msg),u.value=!1)}).catch(()=>{u.value=!1})},T=p(null),q=l=>{T.value.getDetail(l)};return f(),(l,t)=>{const i=ne,n=te,G=oe,O=ee,R=se,j=pe,Q=Z,Y=X;return y(),g(h,null,[v("div",de,[e(ae,{data:V.value,onSearch:D},null,8,["data"]),v("div",me,[e(i,{size:"small",onClick:z},{default:a(()=>[r("批量下载合同")]),_:1}),e(i,{size:"small",onClick:z},{default:a(()=>[r("导出")]),_:1})]),v("div",ue,[e(G,{ref_key:"tableRef",ref:U,data:k.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:a(()=>[e(n,{type:"selection",width:"42",fixed:"left"}),e(n,{prop:"orderCode",label:"订单编号","min-width":"120"}),e(n,{prop:"companyName",label:"企业名称","min-width":"120"}),e(n,{prop:"hallCode",label:"展馆号"}),e(n,{prop:"positionCode",label:"展位号"}),e(n,{prop:"orderPrice",label:"订单金额","min-width":"120"}),e(n,{prop:"orderType",label:"下单方式","min-width":"120"},{default:a(o=>[r(w({1:"代下单",2:"展商下单"}[o.row.orderType]),1)]),_:1}),e(n,{prop:"payStatus",label:"付款状态","min-width":"120"},{default:a(o=>[r(w({0:"未付款",1:"部分付款",2:"已付款"}[o.row.payStatus]),1)]),_:1}),e(n,{prop:"receivedPrice",label:"到款金额","min-width":"120"}),e(n,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:a(o=>[r(w({0:"未签订",1:"已签订",2:"已回执"}[o.row.contractStatus]),1)]),_:1}),e(n,{prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:a(o=>[r(w({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[o.row.invoiceStatus]),1)]),_:1}),e(n,{prop:"clueUser",label:"所属人"}),e(n,{prop:"authUser",label:"下单人"}),e(n,{fixed:"right",label:"操作",width:"220"},{default:a(o=>[e(i,{link:"",type:"primary",size:"small",onClick:_=>q(o.row.id)},{default:a(()=>[r("详情")]),_:2},1032,["onClick"]),o.row.orderStatus!==0?(y(),g(h,{key:0},[o.row.contractStatus===0?(y(),g(h,{key:0},[e(i,{link:"",type:"primary",size:"small",onClick:_=>l.$router.push({name:"ContractTemplates",query:{id:o.row.id,type:2}})},{default:a(()=>[r("签订合同")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",size:"small",onClick:_=>x(o.row.id)},{default:a(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)):(y(),g(h,{key:1},[e(i,{link:"",type:"primary",size:"small",onClick:_=>l.$router.push({name:"ContractTemplates",query:{id:o.row.id,type:2}})},{default:a(()=>[r("更新合同")]),_:2},1032,["onClick"]),e(i,{link:"",type:"primary",size:"small",onClick:_=>x(o.row.id)},{default:a(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)),e(i,{link:"",type:"primary",size:"small",onClick:_=>P(o.row.id)},{default:a(()=>[r("撤销")]),_:2},1032,["onClick"])],64)):(y(),g(h,{key:1},[e(i,{link:"",type:"",size:"small",disabled:""},{default:a(()=>[r("已撤销")]),_:1}),e(i,{link:"",type:"primary",size:"small",onClick:_=>L(o.row.id)},{default:a(()=>[r("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),v("div",ce,[e(O,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:C.value,"current-page":c.page,"onUpdate:currentPage":t[0]||(t[0]=o=>c.page=o),"page-size":c.perPage,"onUpdate:pageSize":t[1]||(t[1]=o=>c.perPage=o),onChange:f},null,8,["total","current-page","page-size"])])]),e(Y,{modelValue:s.show,"onUpdate:modelValue":t[5]||(t[5]=o=>s.show=o),title:"上传合同",width:"400"},{footer:a(()=>[e(i,{type:"primary",onClick:N,loading:u.value},{default:a(()=>[r("确定")]),_:1},8,["loading"]),e(i,{onClick:t[4]||(t[4]=o=>s.show=!1)},{default:a(()=>[r("取消")]),_:1})]),default:a(()=>[e(j,{modelValue:s.type,"onUpdate:modelValue":t[2]||(t[2]=o=>s.type=o)},{default:a(()=>[e(R,{value:1},{default:a(()=>[r("电子合同")]),_:1}),e(R,{value:2},{default:a(()=>[r("纸质合同")]),_:1})]),_:1},8,["modelValue"]),e(Q,{ref_key:"uploadRef",ref:F,"auto-upload":!1,limit:1,"before-upload":M,"on-exceed":I,"file-list":H(m),"onUpdate:fileList":t[3]||(t[3]=o=>J(m)?m.value=o:m=o),style:{"margin-top":"10px"}},{default:a(()=>[e(i,{size:"small",type:"primary"},{default:a(()=>[r("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"]),e(le,{ref_key:"detailRef",ref:T},null,512)],64)}}});export{ct as default};
