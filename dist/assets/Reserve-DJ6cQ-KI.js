import{d as _e,l as m,s as Z,c as ee,t as le,b as _,O as p,Q as q,R as e,i as o,F as h,W as ve,a5 as he,N as oe,o as s,P as f,U as y,h as P,e as V,a3 as be,X as ge,Y as ye}from"./index-BSeRjlL0.js";import{E as Pe}from"./el-dialog-D62aWfLc.js";/* empty css                   */import{E as Ve}from"./el-col-Bty9mCzH.js";import{E as Ce}from"./el-scrollbar-CDUVL__c.js";import{a as we,E as Ee}from"./el-form-item-Dxp5Mq3S.js";/* empty css                 */import{E as Ne}from"./el-input-number-Dj_W2HB8.js";/* empty css                  */import"./el-tag-oeYT3PUu.js";import{E as ke,a as xe}from"./el-select-BUeBfc_4.js";import"./el-popper-DA8SJffM.js";/* empty css                       */import{E as Ie,a as Ue}from"./el-radio-lyeW03MP.js";import{E as Fe}from"./el-image-viewer-B_7zokE3.js";import{a as qe}from"./index-BFaAQMss.js";import{h as Se}from"./index-CfWbNgfQ.js";import{_ as C}from"./rules-F8IXRWD9.js";import{E as Be}from"./index-TKE8WzEN.js";import{E as Oe}from"./index-yaMcPIbY.js";import{b as Re}from"./request-CEpSDEan.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-LcKZKXgG.js";import"./use-form-item-oBGxJhVC.js";import"./scroll-C4gsyPeT.js";import"./vnode-SKn5ff3B.js";import"./refs-DASD4hpM.js";import"./event-BB_Ol6Sd.js";import"./castArray-DakQtpR0.js";import"./_baseClone-dZ0P3lf_.js";import"./_initCloneObject-BrB1fE8O.js";import"./index-CQxl7Tm8.js";import"./isEqual-pyqBTDe7.js";const Je=I=>(ge("data-v-6221ec3d"),I=I(),ye(),I),De={class:"booth-reserve"},Te={class:"l"},ze={class:"title"},Ge={class:"img-box"},je={class:"r"},Ae={class:"form-box"},He=Je(()=>p("div",null,"预定展位",-1)),Le={style:{"text-align":"center"}},Qe={style:{padding:"15px"}},We={class:"dialog-footer"},Xe=_e({__name:"Reserve",setup(I){const te=ve(),v=he(),z=v.query.clueId,S=v.query.exhibitionId,ae=v.query.exhibitorId,b=m(v.query.hallCode),B=m([]),U=m([]),G=m([]),j=m([]),A=m([]),H=m([]),L={1:"%",2:"￥"},t=Z({clueId:z,exhibitionId:S,exhibitorId:ae,add:[],discount:[],position:[{hallCode:b.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let n=JSON.parse(v.query.data);t.clueId=n.clueId,t.exhibitionId=n.exhibitionId,t.exhibitorId=n.exhibitorId,t.position=n.position,t.add=n.add,t.discount=n.discount}m({});const O=m(null),a=Z({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ie=n=>{a.form.unitPrice=Number(n.price),a.form.product=n.text,a.form.num=n.num},re=ee(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),ne=()=>{let n=t.position.length;R(b.value,n),t.position.push({hallCode:b.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},R=(n,l)=>{U.value[l]=[],Se({exhibitionId:S,hallCode:n}).then(c=>{U.value[l]=c.data})};R(b.value,0);const $=m(null),ue=()=>{$.value.validate().then(n=>{n&&te.push({name:"BoothCreateOrder",query:{...v.query,companyName:F.value,data:JSON.stringify(t)}})}).catch(()=>{})},de=n=>{a.index=n,a.form.product="",a.form.unitPrice="",a.form.length=0,a.form.width=0,a.form.num=1,a.show=!0},se=()=>{O.value.validate().then(n=>{if(!n)return;a.show=!1;let l=a.form.length*a.form.width,c=l*a.form.unitPrice/a.form.num,i=Q(c),g=W(c);t.position[a.index].product=a.form.product,t.position[a.index].unitPrice=a.form.unitPrice,t.position[a.index].length=a.form.length,t.position[a.index].width=a.form.width,t.position[a.index].area=l,t.position[a.index].costPrice=Number(c.toFixed(2)),t.position[a.index].addPrice=Number(i.toFixed(2)),t.position[a.index].discountPrice=Number(g.toFixed(2)),t.position[a.index].finalPrice=Number((c+i-g).toFixed(2)),$.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},Q=n=>{let l=0;return t.add.forEach(c=>{let i=JSON.parse(c);i.unit===1?l+=n*i.price/100:i.unit===2&&(l+=i.price)}),l},W=n=>{let l=0;return t.discount.forEach(c=>{let i=JSON.parse(c);i.unit===1?l+=n*i.price/100:i.unit===2&&(l+=i.price)}),l};le(()=>t.add,n=>{t.position.forEach(l=>{l.addPrice=Number(Q(l.costPrice).toFixed(2)),l.finalPrice=Number((l.costPrice+l.addPrice-l.discountPrice).toFixed(2))})}),le(()=>t.discount,n=>{t.position.forEach(l=>{l.discountPrice=Number(W(l.costPrice).toFixed(2)),l.finalPrice=Number((l.costPrice+l.addPrice-l.discountPrice).toFixed(2))})});const F=m(""),J=m(!0);qe({clueId:z,exhibitionId:S}).then(n=>{let l=n.data;G.value=l.attachPrice.add,j.value=l.attachPrice.discount,A.value=l.companyBrand,H.value=l.unitPrice,B.value=l.exhibitionHall,F.value=l.companyName,J.value=l.isNew});const X=ee(()=>{let n=B.value.find(l=>l.code===b.value);return n?n.img:""});return(n,l)=>{const c=Fe,i=we,g=Ie,Y=Ue,w=ke,E=xe,N=Be,k=Oe,D=Ne,pe=oe("DeleteFilled"),K=Re,M=Ee,ce=Ce,T=Ve,me=oe("Close"),fe=Pe;return s(),_(h,null,[p("div",De,[p("div",Te,[p("div",ze,[p("span",null,q(F.value),1),p("span",null,"展馆号："+q(b.value),1)]),p("div",Ge,[e(c,{style:{width:"100%",height:"100%"},src:X.value,"preview-src-list":[X.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),p("div",je,[p("div",Ae,[e(ce,{height:"100%"},{default:o(()=>[e(M,{ref_key:"formRef",ref:$,model:t,"label-width":"auto",class:"form","label-position":"left"},{default:o(()=>[He,e(i,{label:"企业名称"},{default:o(()=>[f(q(F.value),1)]),_:1}),e(i,{label:"新展商"},{default:o(()=>[e(Y,{modelValue:J.value,"onUpdate:modelValue":l[0]||(l[0]=r=>J.value=r),disabled:""},{default:o(()=>[e(g,{value:!0},{default:o(()=>[f("是")]),_:1}),e(g,{value:!1},{default:o(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"加收"},{default:o(()=>[e(E,{modelValue:t.add,"onUpdate:modelValue":l[1]||(l[1]=r=>t.add=r),multiple:"",placeholder:"请选择"},{default:o(()=>[(s(!0),_(h,null,y(G.value,(r,u)=>(s(),P(w,{key:u,label:r.text+" "+r.price+L[r.unit],value:JSON.stringify(r)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"折扣"},{default:o(()=>[e(E,{modelValue:t.discount,"onUpdate:modelValue":l[2]||(l[2]=r=>t.discount=r),multiple:"",placeholder:"请选择"},{default:o(()=>[(s(!0),_(h,null,y(j.value,(r,u)=>(s(),P(w,{key:u,label:r.text+" "+r.price+L[r.unit],value:JSON.stringify(r)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(i,{label:""},{default:o(()=>[e(N,{icon:"Plus",onClick:ne},{default:o(()=>[f("添加展位")]),_:1})]),_:1}),(s(!0),_(h,null,y(t.position,(r,u)=>(s(),_("div",{class:"item",key:u},[e(i,{label:"展馆号",prop:`position[${u}].hallCode`,rules:V(C).required},{default:o(()=>[e(E,{modelValue:t.position[u].hallCode,"onUpdate:modelValue":d=>t.position[u].hallCode=d,placeholder:"请选择",onChange:()=>{R(r.hallCode,u),b.value=r.hallCode}},{default:o(()=>[(s(!0),_(h,null,y(B.value,(d,x)=>(s(),P(w,{key:x,label:d.code,value:d.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),e(i,{label:"展位号",prop:`position[${u}].positionCode`,rules:V(C).required},{default:o(()=>[e(E,{modelValue:t.position[u].positionCode,"onUpdate:modelValue":d=>t.position[u].positionCode=d,filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择"},{default:o(()=>[(s(!0),_(h,null,y(U.value[u],(d,x)=>(s(),P(w,{key:x,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),e(i,{label:"品牌"},{default:o(()=>[e(E,{modelValue:t.position[u].companyBrand,"onUpdate:modelValue":d=>t.position[u].companyBrand=d,multiple:"",placeholder:"请选择"},{default:o(()=>[(s(!0),_(h,null,y(A.value,(d,x)=>(s(),P(w,{key:x,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{label:"展位类型"},{default:o(()=>[e(Y,{modelValue:t.position[u].type,"onUpdate:modelValue":d=>t.position[u].type=d},{default:o(()=>[e(g,{value:1},{default:o(()=>[f("标准")]),_:1}),e(g,{value:2},{default:o(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{label:"展位规格",prop:`position[${u}].product`,rules:V(C).required},{default:o(()=>[e(N,{size:"small",onClick:d=>de(u)},{default:o(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),t.position[u].product?(s(),P(i,{key:0,label:" "},{default:o(()=>[p("div",null,q(t.position[u].product+" "+t.position[u].area+"㎡"),1)]),_:2},1024)):be("",!0),e(i,{label:"展位原价"},{default:o(()=>[e(k,{modelValue:t.position[u].costPrice,"onUpdate:modelValue":d=>t.position[u].costPrice=d,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(i,{label:"加收金额"},{default:o(()=>[e(k,{"model-value":t.position[u].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),e(i,{label:"折扣金额"},{default:o(()=>[e(k,{"model-value":t.position[u].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),e(i,{label:"最终金额",prop:`position[${u}].finalPrice`,rules:V(C).required},{default:o(()=>[e(D,{modelValue:t.position[u].finalPrice,"onUpdate:modelValue":d=>t.position[u].finalPrice=d,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),p("div",Le,[e(N,{link:"",type:"danger",onClick:d=>{t.position.splice(u,1),U.value.splice(u,1)}},{default:o(()=>[e(K,null,{default:o(()=>[e(pe)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),p("div",Qe,[e(N,{type:"primary",onClick:ue,style:{width:"100%"}},{default:o(()=>[f("确认")]),_:1})])])]),e(fe,{modelValue:a.show,"onUpdate:modelValue":l[7]||(l[7]=r=>a.show=r),title:"添加规格",width:"500",draggable:"",onClose:l[8]||(l[8]=()=>{O.value.resetFields()})},{footer:o(()=>[p("div",We,[e(N,{onClick:l[6]||(l[6]=r=>a.show=!1)},{default:o(()=>[f("取消")]),_:1}),e(N,{type:"primary",onClick:se},{default:o(()=>[f("确定")]),_:1})])]),default:o(()=>[e(M,{ref_key:"ggFormRef",ref:O,model:a.form,"label-width":"auto","label-position":"left"},{default:o(()=>[e(i,{label:"产品名称",prop:"product",rules:V(C).required},{default:o(()=>[e(E,{modelValue:a.form.product,"onUpdate:modelValue":l[3]||(l[3]=r=>a.form.product=r),placeholder:"",onChange:ie},{default:o(()=>[(s(!0),_(h,null,y(H.value,r=>(s(),P(w,{key:r.id,label:r.text+" "+r.price+"/"+r.num+"/㎡",value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),e(i,{label:"单价",prop:"unitPrice"},{default:o(()=>[e(k,{"model-value":re.value,disabled:""},null,8,["model-value"])]),_:1}),e(i,{label:"尺寸"},{default:o(()=>[e(T,{span:11},{default:o(()=>[e(i,{label:"",prop:"length",rules:V(C).positive},{default:o(()=>[e(D,{modelValue:a.form.length,"onUpdate:modelValue":l[4]||(l[4]=r=>a.form.length=r),min:0,controls:!1,style:{flex:"1"}},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1}),e(T,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:o(()=>[e(K,null,{default:o(()=>[e(me)]),_:1})]),_:1}),e(T,{span:11},{default:o(()=>[e(i,{label:"",prop:"width",rules:V(C).positive},{default:o(()=>[e(D,{modelValue:a.form.width,"onUpdate:modelValue":l[5]||(l[5]=r=>a.form.width=r),min:0,controls:!1,style:{flex:"1"}},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1})]),_:1}),e(i,{label:"面积"},{default:o(()=>[e(k,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Il=$e(Xe,[["__scopeId","data-v-6221ec3d"]]);export{Il as default};
