import{d as X,l as p,s as B,b as k,O as v,R as l,i,F as I,W as Y,a5 as Z,o as x,P as n,U as z,h as D,e as ee}from"./index-DiU5jspA.js";import{g as le,E as te}from"./el-progress-Ce70387G.js";import{E as oe}from"./el-dialog-C6xm8-jm.js";/* empty css                   */import{a as ae,E as ie}from"./el-form-item-BSn47xVn.js";import{E as re}from"./el-row-BHHNq_-r.js";import{E as de}from"./el-col-Cr1uWYj1.js";/* empty css                 */import"./el-tag-XoV_hOru.js";import{E as se,a as ne}from"./el-select-OU7ku-vT.js";import"./el-scrollbar-D0OjMyv3.js";import"./el-popper-DF3OI6XX.js";import{E as ue}from"./el-pagination-DtRzwXqy.js";import{E as pe,a as me}from"./el-table-column-Bz48gUHk.js";import"./el-checkbox-HcrGNUtb.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                                                              */import{b as fe,a as ce,c as be,d as he,e as ge,f as _e}from"./index-HlQkAz-y.js";import{g as ve}from"./index-CzFVUlHy.js";import{g as xe}from"./index-DWTaIbLO.js";/* empty css                   *//* empty css                       */import{c as u}from"./request-B39XK5wk.js";import{E as we}from"./index-BDfPqMnF.js";import{E as Ee}from"./index-D-xk-Hvu.js";import{E as Ce}from"./index-zW-JjiHk.js";import"./use-form-item-CdswxiOe.js";import"./cloneDeep-D__QK5Kh.js";import"./_baseClone-D6Ia6Ckl.js";import"./_initCloneObject-CRJ4uPl2.js";import"./isEqual-BRAgbcLY.js";import"./index-BSbeS5rW.js";import"./scroll-dy446X4I.js";import"./vnode-BVBhQwRv.js";import"./refs-CjDdoRJ2.js";import"./event-BB_Ol6Sd.js";import"./castArray-DGXTHo-W.js";import"./aria-KgdLjl5h.js";import"./validator-K2Xi9CJC.js";const Ve={class:"s-flex-col",style:{height:"100%"}},ye={class:"s-table-operations"},ke={class:"s-flex-auto",style:{"min-height":"0"}},Ie={class:"s-table-pagination"},Ue={class:"dialog-footer"},gl=X({__name:"Manage",setup(Pe){Y();const f=Z().query.id,C=p([]),U=p(null),V=p(null),c=p(!1),w=p(!1),r=B({id:"",exhibitionId:f,hallCode:"",positionCode:"",standardPrice:0,specialPrice:0,specialUnit:1,length:0,width:0,remark:"",exhibitor:"",exhibitorId:""}),M={hallCode:[{required:!0,message:"请输入大厅号",trigger:"blur"}],positionCode:[{required:!0,message:"请输入位置号",trigger:"blur"}],standardPrice:[{required:!0,message:"请输入标准展位单价",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("不能小于0")):o()}}],specialPrice:[{required:!0,message:"请输入特装展位单价",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("不能小于0")):o()}}],specialUnit:[{required:!0,message:"请选择单位",trigger:"blur"}],length:[{required:!0,message:"请输入长度",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("必须大于0")):o()}}],width:[{required:!0,message:"请输入宽度",trigger:"blur"},{validator:(t,e,o)=>{e<=0?o(new Error("必须大于0")):o()}}]};let E=p([]);ve({exhibitionId:f}).then(t=>{t.code===0&&(E.value=t.data)}),p([]);const g=()=>{fe({exhibitionId:f}).then(t=>{t.code===0?C.value=t.data:C.value=[]})},S=async t=>{w.value=!0,c.value=!0,r.hallCode=t.hallCode,r.positionCode=t.positionCode,r.standardPrice=t.standardPrice,r.specialPrice=t.specialPrice,r.specialUnit=t.specialUnit.indexOf("个")>-1?2:1,r.length=t.length,r.width=t.width,r.remark=t.remark,r.exhibitor=t.exhibitor,r.exhibitorId=t.exhibitorId,r.id=t.id},T=()=>{let t=U.value.getSelectionRows().map(e=>e.id);if(t.length===0){u.warning("请选择需要删除的数据");return}P(t)},P=t=>{we.confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ce({id:t}).then(e=>{e.code===0?(u.success("删除成功"),g()):u.error(e.msg)})}).catch(()=>{})},$=async()=>{w.value=!1,c.value=!0,r.remark=""},L=()=>{V.value.validate(t=>{if(t)if(w.value){let e=r;e.exhibitor=e.exhibitorId?E.value.find(o=>o.id===r.exhibitorId).name:"",he(e).then(o=>{o.code===0?(u.success("编辑成功"),c.value=!1,g()):u.error(o.msg)})}else{let{id:e,...o}=r;o.exhibitor=o.exhibitorId?E.value.find(d=>d.id===r.exhibitorId).name:"",ge(o).then(d=>{d.code===0?(u.success("新增成功"),c.value=!1,g()):u.error(d.msg)})}else return!1})},F=p([]);xe({exhibitionId:f}).then(t=>{t.code===0&&(F.value=t.data)});const b=p(),s=B({show:!1,loading:!1,list:[],set:()=>{s.show=!0},sub:()=>{if(s.list.length===0){u.error("请选择文件");return}b.value.submit()},dowModel:()=>{window.open("https://crm-test-1256699835.cos.ap-shanghai.myqcloud.com/importTemplate/position.xlsx","_self")}}),O=t=>{b.value.clearFiles();const e=t[0];e.uid=le(),b.value.handleStart(e)},N=()=>{be({exhibitionId:f}).then(t=>{t.code===0?(window.open(t.data.url,"_self"),u.success("导出成功")):u.error(t.msg)})},A=t=>{const e=t.size/1024/1024<20;return e||u.error("文件大小不能超过 20MB!"),e},H=t=>{s.loading=!0;const e=new FormData;e.append("file",t.file),e.append("exhibitionId",f),_e(e).then(o=>{o.code===0?(u.success("导入成功"),s.show=!1,b.value.clearFiles(),g()):u.error(o.msg),s.loading=!1}).catch(o=>{s.loading=!1})};return f&&g(),(t,e)=>{const o=Ee,d=me,W=pe,j=ue,_=se,y=ne,m=ae,h=Ce,R=de,G=re,J=ie,q=oe,K=te;return x(),k(I,null,[v("div",Ve,[v("div",ye,[l(o,{size:"small",onClick:$},{default:i(()=>[n("新增")]),_:1}),l(o,{size:"small",onClick:e[0]||(e[0]=a=>s.set())},{default:i(()=>[n("导入")]),_:1}),l(o,{size:"small",onClick:N},{default:i(()=>[n("导出")]),_:1}),l(o,{size:"small",onClick:T},{default:i(()=>[n("删除")]),_:1})]),v("div",ke,[l(W,{ref_key:"tableRef",ref:U,data:C.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:i(()=>[l(d,{type:"selection",width:"42"}),l(d,{prop:"id",label:"ID",width:"50"}),l(d,{prop:"hallCode",label:"展馆号"}),l(d,{prop:"positionCode",label:"展位号"}),l(d,{prop:"standardPrice",label:"标摊/元","min-width":"120"}),l(d,{prop:"specialPrice",label:"特装/元","min-width":"120"}),l(d,{prop:"specialUnit",label:"特装/㎡/个","min-width":"120"}),l(d,{prop:"length",label:"长"}),l(d,{prop:"width",label:"宽"}),l(d,{prop:"remark",label:"备注"}),l(d,{prop:"exhibitor",label:"参展商"}),l(d,{prop:"time",label:"创建时间","min-width":"120"}),l(d,{fixed:"right",label:"操作",width:"150"},{default:i(a=>[l(o,{link:"",type:"primary",onClick:Q=>S(a.row)},{default:i(()=>[n("编辑")]),_:2},1032,["onClick"]),l(o,{link:"",type:"danger",onClick:Q=>P([a.row.id])},{default:i(()=>[n("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),v("div",Ie,[l(j,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:1e3})])]),l(q,{modelValue:c.value,"onUpdate:modelValue":e[11]||(e[11]=a=>c.value=a),title:w.value?"编辑":"新增展位信息",width:"500",draggable:"",onClose:e[12]||(e[12]=()=>V.value.resetFields())},{footer:i(()=>[v("div",Ue,[l(o,{onClick:e[10]||(e[10]=a=>c.value=!1)},{default:i(()=>[n("取消")]),_:1}),l(o,{type:"primary",onClick:L},{default:i(()=>[n("确定")]),_:1})])]),default:i(()=>[l(J,{ref_key:"formRef",ref:V,model:r,rules:M,"label-width":"auto","label-position":"left"},{default:i(()=>[l(m,{label:"展馆号",prop:"hallCode"},{default:i(()=>[l(y,{modelValue:r.hallCode,"onUpdate:modelValue":e[1]||(e[1]=a=>r.hallCode=a),placeholder:"请选择"},{default:i(()=>[(x(!0),k(I,null,z(F.value,a=>(x(),D(_,{key:a.code,label:a.code,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"展位号",prop:"positionCode"},{default:i(()=>[l(h,{modelValue:r.positionCode,"onUpdate:modelValue":e[2]||(e[2]=a=>r.positionCode=a),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(m,{label:"标准展位",prop:"standardPrice"},{default:i(()=>[l(h,{modelValue:r.standardPrice,"onUpdate:modelValue":e[3]||(e[3]=a=>r.standardPrice=a),autocomplete:"off",type:"number"},{append:i(()=>[n("元/个")]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"特装展位",prop:"specialPrice"},{default:i(()=>[l(h,{modelValue:r.specialPrice,"onUpdate:modelValue":e[5]||(e[5]=a=>r.specialPrice=a),autocomplete:"off",type:"number"},{append:i(()=>[l(y,{modelValue:r.specialUnit,"onUpdate:modelValue":e[4]||(e[4]=a=>r.specialUnit=a),placeholder:"请选择",style:{width:"120px"}},{default:i(()=>[l(_,{label:"元/㎡",value:1}),l(_,{label:"元/个",value:2})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(G,null,{default:i(()=>[l(R,{span:12},{default:i(()=>[l(m,{label:"长",prop:"length"},{default:i(()=>[l(h,{modelValue:r.length,"onUpdate:modelValue":e[6]||(e[6]=a=>r.length=a),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),l(R,{span:12},{default:i(()=>[l(m,{label:"宽",prop:"width"},{default:i(()=>[l(h,{modelValue:r.width,"onUpdate:modelValue":e[7]||(e[7]=a=>r.width=a),autocomplete:"off",type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(m,{label:"备注"},{default:i(()=>[l(h,{modelValue:r.remark,"onUpdate:modelValue":e[8]||(e[8]=a=>r.remark=a),autocomplete:"off",type:"textarea"},null,8,["modelValue"])]),_:1}),l(m,{label:"参展商",prop:"exhibitorId"},{default:i(()=>[l(y,{modelValue:r.exhibitorId,"onUpdate:modelValue":e[9]||(e[9]=a=>r.exhibitorId=a),placeholder:"请选择"},{default:i(()=>[l(_,{label:"无",value:""}),(x(!0),k(I,null,z(ee(E),a=>(x(),D(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(q,{modelValue:s.show,"onUpdate:modelValue":e[15]||(e[15]=a=>s.show=a),title:"导入展位信息",width:"500",draggable:"",onClose:e[16]||(e[16]=()=>{s.loading=!1,b.value.clearFiles()})},{footer:i(()=>[l(o,{onClick:e[14]||(e[14]=a=>s.show=!1)},{default:i(()=>[n("取消")]),_:1}),l(o,{type:"primary",onClick:s.sub,loading:s.loading},{default:i(()=>[n("确定")]),_:1},8,["onClick","loading"])]),default:i(()=>[l(o,{type:"",onClick:s.dowModel,style:{"margin-bottom":"20px"}},{default:i(()=>[n("下载导入模板")]),_:1},8,["onClick"]),l(K,{ref_key:"uploadRef",ref:b,"file-list":s.list,"onUpdate:fileList":e[13]||(e[13]=a=>s.list=a),"before-upload":A,"http-request":H,accept:".xls,.xlsx","on-exceed":O,limit:1,multiple:!1,"auto-upload":!1},{default:i(()=>[l(o,{type:"primary"},{default:i(()=>[n("选择文件")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])],64)}}});export{gl as default};
