import{d as ae,a0 as le,t as f,z as ie,y as M,b as x,X as h,$ as a,i as l,J as C,a5 as re,a7 as m,o as r,Y as s,a1 as D,Z as b,h as u,ak as p,a2 as ne,a3 as se}from"./index-C62Y5jI7.js";import{E as de}from"./dialog-DhFPGCBL.js";/* empty css                */import{E as ue}from"./radio-Bkc9metc.js";import{E as pe,a as me,_ as ce}from"./sx-Bug7S-2i.js";/* empty css              */import"./tag-CmESFHCf.js";import"./select-6TRvRKKL.js";import"./scrollbar-CM8r5mxf.js";import"./popper-P6szMbtS.js";import{E as he,a as fe}from"./table-column-NBUUWInL.js";import{E as _e,a as be}from"./checkbox-Bp95xrn6.js";/* empty css                */import{E as ge}from"./link-C9xsAOcm.js";/* empty css                       */import{E as ve}from"./button-BcEWd77Y.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-zXINP8hN.js";/* empty css                                              */import{E as ke}from"./ExhibitionChange-PLxLPCZh.js";import{_ as we}from"./Move.vue_vue_type_script_setup_true_lang-BUp8J024.js";import{a as g}from"./index-BC6PpNbC.js";import{j as L}from"./index-Jg7aYMQK.js";/* empty css                *//* empty css                    */import{E as xe}from"./index-Gdy8rpQJ.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BJ92ISnh.js";import"./use-form-item-Ci1hKOsT.js";import"./scroll-BLJOdboY.js";import"./vnode-C_iLhi56.js";import"./focus-trap-D2C5Uq4m.js";import"./refs-BrnsFT70.js";import"./event-BB_Ol6Sd.js";import"./isEqual-Be1KB0gC.js";import"./_initCloneObject-CziEyHNv.js";import"./index-CVJW_qQJ.js";import"./dropdown-DNvLLMQt.js";import"./castArray-OO4Q_jh_.js";import"./form-item-C7bXw_a9.js";import"./_baseClone-Bknis6l5.js";/* empty css                      */import"./index-CxCod-2w.js";import"./aria-KgdLjl5h.js";import"./validator-C0dpf7FR.js";const E=I=>(ne("data-v-10355be9"),I=I(),se(),I),Ce={class:"s-flex-col",style:{height:"100%"}},Ee={class:"",style:{"margin-bottom":"10px"}},Se={class:"s-table-operations"},Ne=E(()=>h("img",{style:{width:"17px"},src:ce,alt:""},null,-1)),Ve={class:"s-flex-auto",style:{"min-height":"0"}},Be={class:"s-table-pagination"},Re=E(()=>h("div",{style:{"font-size":"15px","margin-bottom":"2px",color:"#444"}},"请在下列线索中选择主线索，合并后：",-1)),Pe=E(()=>h("p",null,"1. 被合并线索下的动态迁移到主线索下",-1)),Te=E(()=>h("p",null,"2. 合并后的线索以主线索为主，并保留两条线索的所有记录",-1)),Ue={class:"dialog-footer"},$e=ae({__name:"Will",setup(I){const N=re(),V=le(),B=f(V.EXHIBITION_INFO);ie(()=>V.EXHIBITION_INFO,(e,o)=>{e.id!==o.id&&(B.value=e,_())},{deep:!0});const v=M({page:1,perPage:20}),R=f(0),P=f({}),T=f([]),y=f(null),U=f([]),O=e=>{P.value=e,v.page=1,_()},_=async()=>{g.getList({status:2,exhibitionId:B.value.id,...v,...P.value}).then(e=>{e.code===0&&(T.value=e.data.data,R.value=e.data.total)})},n=M({show:!1,data:[],masterId:"",mergeId:"",ref:null,set:()=>{let e=y.value.getSelectionRows();if(e.length!==2){m.error("请选择需要合并的线索，必须选择两个");return}n.show=!0,n.data=e,n.masterId=e[0].id,n.mergeId=e[1].id},sub:()=>{g.merge({masterId:n.masterId,mergeId:n.mergeId}).then(e=>{e.code===0?(m.success("合并成功"),n.show=!1,_()):m.error(e.msg)})}}),q=()=>{let e=y.value.getSelectionRows().map(o=>o.id);if(e.length===0){m.error("请选择需要删除的线索");return}xe.confirm("确定删除所选线索？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{g.del({id:e}).then(o=>{o.code===0?(m.success("删除成功"),_()):m.error(o.msg)})}).catch(()=>{})},$=f(null),j=()=>{let e=y.value.getSelectionRows().map(o=>o.id);if(e.length===0){m.error("请选择需要转移的线索");return}$.value.setMove(e)},G=()=>{let e=y.value.getSelectionRows().map(o=>o.id);if(e.length===0){m.error("请选择需要移至公海的线索");return}g.changePublic({id:e}).then(o=>{o.code===0?(m.success("移至公海成功"),_()):m.error(o.msg)})},H=()=>{g.clueExport({status:2}).then(e=>{e.code===0?(m.success("导出成功"),window.open(e.data.url,"_self")):m.error(e.msg)})};g.getSearchField().then(e=>{e.code===0&&(U.value=e.data)});const z=f([]),W=()=>{g.getCustomField().then(e=>{e.code===0&&(z.value=e.data,J())})},X=e=>{L({exhibitionId:e.exhibitionId}).then(o=>{o.code===0?N.push({name:"HallLayout",query:{clueId:e.id,exhibitionId:e.exhibitionId,exhibitorId:e.exhibitorId}}):m.error(o.msg)})},A=e=>{L({exhibitionId:e.exhibitionId}).then(o=>{o.code===0?N.push({name:"GoodsReserve",query:{clueId:e.id,exhibitionId:e.exhibitionId,exhibitorId:e.exhibitorId,hallCode:e.hallCode,positionCode:e.positionCode}}):m.error(o.msg)})};W(),_();const k=f([]),S=f([]),J=()=>{setTimeout(()=>{let e=[];y.value.columns.forEach(o=>{o.label&&e.push(o.label)}),S.value=e.join(",").split(","),k.value=e.join(",").split(",")},0)},d=e=>k.value.length===0&&S.value.length===0?!0:k.value.includes(e);return(e,o)=>{const c=ve,Y=_e,Z=be,K=pe,i=fe,Q=ge,F=he,ee=me,te=ue,oe=de;return r(),x(C,null,[h("div",Ce,[h("div",Ee,[a(ke)]),a(ye,{data:U.value,onSearch:O},null,8,["data"]),h("div",Se,[a(c,{onClick:j},{default:l(()=>[s("转移")]),_:1}),a(c,{onClick:G},{default:l(()=>[s("移至公海")]),_:1}),a(c,{onClick:n.set},{default:l(()=>[s("合并")]),_:1},8,["onClick"]),a(c,{onClick:H},{default:l(()=>[s("导出")]),_:1}),a(c,{onClick:q},{default:l(()=>[s("删除")]),_:1}),a(c,{onClick:o[0]||(o[0]=t=>e.$router.push({name:"CluesAdd",query:{status:2}}))},{default:l(()=>[s("新建线索")]),_:1}),a(c,{onClick:o[1]||(o[1]=t=>e.$router.push({name:"CluesImport",query:{status:2}}))},{default:l(()=>[s("导入线索")]),_:1}),a(K,{placement:"bottom-end",trigger:"click"},{reference:l(()=>[a(c,{size:"",link:""},{default:l(()=>[Ne]),_:1})]),default:l(()=>[a(Z,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=t=>k.value=t)},{default:l(()=>[h("ul",null,[(r(!0),x(C,null,D(S.value,t=>(r(),x("li",{class:"s-checkbox_item",key:t},[a(Y,{label:t,value:t},{default:l(()=>[s(b(t),1)]),_:2},1032,["label","value"])]))),128))])]),_:1},8,["modelValue"])]),_:1})]),h("div",Ve,[a(F,{ref_key:"tableRef",ref:y,data:T.value,border:"","table-layout":"fixed",height:"100%","cell-style":{minWidth:"120px"},"show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[a(i,{type:"selection",width:"42",fixed:"left"}),d("序号")?(r(),u(i,{key:0,type:"index",label:"序号",width:"60"})):p("",!0),d("企业名称")?(r(),u(i,{key:1,prop:"companyName",label:"企业名称",width:"180"},{default:l(t=>[a(Q,{href:"/market/clues/info?type=2&id="+t.row.id+"&exhibitionId="+t.row.exhibitionId+"&authUser="+t.row.authUser,type:"primary"},{default:l(()=>[s(b(t.row.companyName),1)]),_:2},1032,["href"])]),_:1})):p("",!0),d("展会名称")?(r(),u(i,{key:2,prop:"exhibitionName",label:"展会名称",width:"180"})):p("",!0),d("展位号")?(r(),u(i,{key:3,prop:"positionCode",label:"展位号"})):p("",!0),d("展位类型")?(r(),u(i,{key:4,prop:"positionType",label:"展位类型","min-width":"120"},{default:l(t=>[s(b({1:"标准",2:"特装"}[t.row.positionType]),1)]),_:1})):p("",!0),d("展位面积")?(r(),u(i,{key:5,prop:"positionArea",label:"展位面积","min-width":"120"})):p("",!0),d("展位合同")?(r(),u(i,{key:6,prop:"contractPosition",label:"展位合同","min-width":"120"},{default:l(t=>[s(b({0:"未签订",1:"已签订",2:"已回执"}[t.row.contractPosition]),1)]),_:1})):p("",!0),d("物料合同")?(r(),u(i,{key:7,prop:"contractMaterial",label:"物料合同","min-width":"120"},{default:l(t=>[s(b({0:"未签订",1:"已签订",2:"已回执"}[t.row.contractMaterial]),1)]),_:1})):p("",!0),d("是否退展")?(r(),u(i,{key:8,prop:"isExit",label:"是否退展","min-width":"120"},{default:l(t=>[s(b({0:"否",1:"是"}[t.row.isExit]),1)]),_:1})):p("",!0),d("展会联系人")?(r(),u(i,{key:9,prop:"exhibitionContact",label:"展会联系人","min-width":"120"})):p("",!0),d("职位")?(r(),u(i,{key:10,prop:"duties",label:"职位","min-width":"120"})):p("",!0),d("手机号")?(r(),u(i,{key:11,prop:"phone",label:"手机号","min-width":"120"})):p("",!0),(r(!0),x(C,null,D(z.value,t=>(r(),x(C,{key:t.key},[t.name=="通讯地址"||t.name=="主营业务"&&d(t.name)?(r(),u(i,{key:0,prop:t.key,label:t.name,"min-width":"120"},null,8,["prop","label"])):p("",!0)],64))),128)),d("持有人")?(r(),u(i,{key:12,prop:"authUser",label:"持有人"})):p("",!0),d("操作")?(r(),u(i,{key:13,fixed:"right",label:"操作",width:"220"},{default:l(t=>[a(c,{link:"",type:"primary",onClick:w=>X(t.row)},{default:l(()=>[s(b(t.row.orderPositionStatus?"新增":"")+"展位预定 ",1)]),_:2},1032,["onClick"]),a(c,{link:"",type:"primary",onClick:w=>A(t.row)},{default:l(()=>[s(b(t.row.orderMaterialStatus?"新增":"")+"物料预定 ",1)]),_:2},1032,["onClick"])]),_:1})):p("",!0)]),_:1},8,["data"])]),h("div",Be,[a(ee,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50,100],total:R.value,"current-page":v.page,"onUpdate:currentPage":o[3]||(o[3]=t=>v.page=t),"page-size":v.perPage,"onUpdate:pageSize":o[4]||(o[4]=t=>v.perPage=t),onChange:_},null,8,["total","current-page","page-size"])])]),a(oe,{modelValue:n.show,"onUpdate:modelValue":o[8]||(o[8]=t=>n.show=t),title:"合并销售线索",width:"500",draggable:""},{footer:l(()=>[h("div",Ue,[a(c,{onClick:o[7]||(o[7]=t=>n.show=!1)},{default:l(()=>[s("取消")]),_:1}),a(c,{type:"primary",onClick:n.sub},{default:l(()=>[s("确定")]),_:1},8,["onClick"])])]),default:l(()=>[Re,Pe,Te,a(F,{data:n.data,border:"","show-overflow-tooltip":"","header-row-class-name":"s-table-header",onCurrentChange:o[6]||(o[6]=t=>{let w=n.masterId;n.masterId=t.id,n.mergeId=w})},{default:l(()=>[a(i,{label:"主线索",width:"70"},{default:l(t=>[a(te,{value:t.row.id,modelValue:n.masterId,"onUpdate:modelValue":o[5]||(o[5]=w=>n.masterId=w)},null,8,["value","modelValue"])]),_:1}),a(i,{prop:"companyName",label:"公司名称","min-width":"120"}),a(i,{prop:"exhibitionName",label:"展会姓名","min-width":"120"}),a(i,{prop:"authUser",label:"线索所有人","min-width":"120"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),a(we,{ref_key:"moveRef",ref:$,onCallback:_},null,512)],64)}}}),Et=Ie($e,[["__scopeId","data-v-10355be9"]]);export{Et as default};
