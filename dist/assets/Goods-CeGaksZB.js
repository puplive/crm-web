import{d as K,a0 as Q,t as p,z as W,y as $,b as g,X as h,$ as t,i as l,J as y,a5 as ee,am as te,a7 as s,o as w,Y as i,Z as b,e as oe,aB as ae}from"./index-D6lb1vAv.js";import{E as le}from"./dialog-CEutNOMs.js";/* empty css                */import{E as ie}from"./progress-BDHTSMi0.js";/* empty css                    */import{E as re,a as ne}from"./radio-DpKKZ63o.js";import{E as se}from"./pagination-Dv5jXxzL.js";/* empty css              */import"./tag-DyRGJO6y.js";import"./select-C-KkSNyU.js";import"./scrollbar-DU4G5b5p.js";import"./popper-PtN5-UwR.js";import{E as de,a as pe}from"./table-column-Bdwx0tKL.js";import"./checkbox-DdrTfKwk.js";/* empty css                */import{E as me}from"./button-CnviZ8cJ.js";import{T as ue}from"./index-BE1XV_oV.js";import{_ as ce}from"./GoodsOrderDetail.vue_vue_type_script_setup_true_lang-CG936XCa.js";import{c as v,b as fe}from"./index-Du-JRtf8.js";import{u as _e}from"./index-DqmM9QAu.js";import{d as ge}from"./index-CabLtwQT.js";import{z as he}from"./fileZip-DEJh-8FU.js";import{E as ye}from"./ExhibitionChange-YbvqVwJW.js";/* empty css                    *//* empty css                */import{E as D}from"./index-DNji5aOk.js";import"./index-Dw_FUmZc.js";import"./use-form-item-D2gyIkin.js";import"./scroll-Cee1eboZ.js";import"./vnode-CWLT-RKK.js";import"./focus-trap-BL2pMCUV.js";import"./refs-BbH7IMmI.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-CQWJaEaZ.js";import"./_baseClone-B5IZTI-u.js";import"./_initCloneObject-DxFeGeIP.js";import"./isEqual-DtkQ-0cD.js";import"./index-DtV3tWyM.js";import"./castArray-CqaCZPGK.js";import"./form-item-CSzeSa22.js";/* empty css                      */import"./index-DQNmj_SX.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./index-CNcb9o6C.js";import"./aria-KgdLjl5h.js";import"./validator-BJ7NuE-R.js";const we={class:"s-flex-col",style:{height:"100%"}},ve={class:"",style:{"margin-bottom":"10px"}},be={class:"s-table-operations"},ke={class:"s-flex-auto",style:{"min-height":"0"}},Ce={class:"s-table-pagination"},wt=K({__name:"Goods",setup(xe){const C=Q(),x=p(C.EXHIBITION_INFO);W(()=>C.EXHIBITION_INFO,(o,e)=>{o.id!==e.id&&(x.value=o,u())},{deep:!0}),ee();const N=te(),c=p(!1),f=$({page:1,perPage:10}),E=p(0),I=p({}),U=N.query.id,k=p([]),S=p(null),T=p([]),d=$({show:!1,file:"",type:1,orderId:0}),V=o=>{I.value=o,f.page=1,u()},u=()=>{v.getList({exhibitionId:x.value.id,...f,...I.value}).then(o=>{o.code===0?(k.value=o.data.data,E.value=o.data.total):k.value=[{}]})},F=o=>{D.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.revoke({id:o}).then(e=>{e.code===0?(s.success("撤销成功"),u()):s.error(e.msg)})}).catch(()=>{})},P=o=>{D.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{v.del({id:o}).then(e=>{e.code===0?(s.success("删除成功"),u()):s.error(e.msg)})}).catch(()=>{})},L=()=>{let o=S.value.getSelectionRows().map(e=>e.id);if(o.length===0){s.warning("请选择需要下载的数据");return}ge({orderId:o}).then(e=>{if(e.code===0){if(e.data.length===0){s.warning("无数据");return}he(e.data)}else s.error(e.msg)})},O=()=>{v.export({exhibitionId:U}).then(o=>{o.code===0?(window.open(o.data.url,"_self"),s.success("导出成功")):s.error(o.msg)})},M=p(null);let m=p([]);const q=o=>{let e=o[0];m.value=[{name:e.name,size:e.size,uid:e.uid,status:"ready",percentage:0,raw:e}]},X=o=>{const e=o.size/1024/1024<3;return e||s.error("文件大小不能超过 3MB!"),e},z=o=>{d.show=!0,d.type=1,d.orderId=o,d.file="",m.value=[]},G=()=>{if(d.type===1&&m.value.length===0){s.warning("请选择合同文件");return}c.value=!0;let o=new FormData;o.append("upload",m.value[0].raw),_e(o).then(e=>{e.code===0?fe.receipt({orderId:d.orderId,type:d.type,url:e.data.url}).then(r=>{r.code===0?(s.success("上传成功"),d.show=!1,u()):s.error(r.msg),c.value=!1}).catch(()=>{c.value=!1}):(s.error(e.msg),c.value=!1)}).catch(()=>{c.value=!1})},B=p(null),H=o=>{B.value.getDetail(o)};return v.getSearchField().then(o=>{o.code===0&&(T.value=o.data)}),u(),(o,e)=>{const r=me,n=pe,j=de,J=se,R=re,Y=ne,Z=ie,A=le;return w(),g(y,null,[h("div",we,[h("div",ve,[t(ye)]),t(ue,{data:T.value,onSearch:V},null,8,["data"]),h("div",be,[t(r,{size:"small",onClick:L},{default:l(()=>[i("批量下载合同")]),_:1}),t(r,{size:"small",onClick:O},{default:l(()=>[i("导出")]),_:1})]),h("div",ke,[t(j,{ref_key:"tableRef",ref:S,data:k.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[t(n,{type:"selection",width:"42",fixed:"left"}),t(n,{prop:"orderCode",label:"订单编号","min-width":"120"}),t(n,{prop:"companyName",label:"企业名称","min-width":"120"}),t(n,{prop:"exhibitionName",label:"展会名称","min-width":"120"}),t(n,{prop:"hallCode",label:"展馆号"}),t(n,{prop:"positionCode",label:"展位号"}),t(n,{prop:"orderPrice",label:"订单金额","min-width":"120"}),t(n,{prop:"orderType",label:"下单方式","min-width":"120"},{default:l(a=>[i(b({1:"代下单",2:"展商下单"}[a.row.orderType]),1)]),_:1}),t(n,{prop:"payStatus",label:"付款状态","min-width":"120"},{default:l(a=>[i(b({0:"未付款",1:"部分付款",2:"已付款"}[a.row.payStatus]),1)]),_:1}),t(n,{prop:"receivedPrice",label:"到款金额","min-width":"120"}),t(n,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:l(a=>[i(b({0:"未签订",1:"已签订",2:"已回执(电子)",3:"已回执(纸质)"}[a.row.contractStatus]),1)]),_:1}),t(n,{prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:l(a=>[i(b({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[a.row.invoiceStatus]),1)]),_:1}),t(n,{prop:"clueUser",label:"所属人"}),t(n,{prop:"authUser",label:"下单人"}),t(n,{fixed:"right",label:"操作",width:"250"},{default:l(a=>[t(r,{link:"",type:"primary",onClick:_=>H(a.row.id)},{default:l(()=>[i("详情")]),_:2},1032,["onClick"]),a.row.orderStatus!==0?(w(),g(y,{key:0},[a.row.contractStatus===0?(w(),g(y,{key:0},[t(r,{link:"",type:"primary",onClick:_=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:2}})},{default:l(()=>[i("签订合同")]),_:2},1032,["onClick"]),t(r,{link:"",type:"primary",onClick:_=>z(a.row.id)},{default:l(()=>[i("上传合同")]),_:2},1032,["onClick"])],64)):(w(),g(y,{key:1},[t(r,{link:"",type:"primary",onClick:_=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:2}})},{default:l(()=>[i("更新合同")]),_:2},1032,["onClick"]),t(r,{link:"",type:"primary",onClick:_=>z(a.row.id)},{default:l(()=>[i("上传合同")]),_:2},1032,["onClick"])],64)),t(r,{link:"",type:"primary",onClick:_=>F(a.row.id)},{default:l(()=>[i("撤销")]),_:2},1032,["onClick"])],64)):(w(),g(y,{key:1},[t(r,{link:"",type:"",disabled:""},{default:l(()=>[i("已撤销")]),_:1}),t(r,{link:"",type:"danger",onClick:_=>P(a.row.id)},{default:l(()=>[i("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),h("div",Ce,[t(J,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:E.value,"current-page":f.page,"onUpdate:currentPage":e[0]||(e[0]=a=>f.page=a),"page-size":f.perPage,"onUpdate:pageSize":e[1]||(e[1]=a=>f.perPage=a),onChange:u},null,8,["total","current-page","page-size"])])]),t(A,{modelValue:d.show,"onUpdate:modelValue":e[5]||(e[5]=a=>d.show=a),title:"上传合同",width:"400",draggable:""},{footer:l(()=>[t(r,{type:"primary",onClick:G,loading:c.value},{default:l(()=>[i("确定")]),_:1},8,["loading"]),t(r,{onClick:e[4]||(e[4]=a=>d.show=!1)},{default:l(()=>[i("取消")]),_:1})]),default:l(()=>[t(Y,{modelValue:d.type,"onUpdate:modelValue":e[2]||(e[2]=a=>d.type=a)},{default:l(()=>[t(R,{value:1},{default:l(()=>[i("电子合同")]),_:1}),t(R,{value:2},{default:l(()=>[i("纸质合同")]),_:1})]),_:1},8,["modelValue"]),t(Z,{ref_key:"uploadRef",ref:M,"auto-upload":!1,limit:1,"before-upload":X,"on-exceed":q,"file-list":oe(m),"onUpdate:fileList":e[3]||(e[3]=a=>ae(m)?m.value=a:m=a),style:{"margin-top":"10px"}},{default:l(()=>[t(r,{size:"small",type:"primary"},{default:l(()=>[i("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"]),t(ce,{ref_key:"detailRef",ref:B},null,512)],64)}}});export{wt as default};
