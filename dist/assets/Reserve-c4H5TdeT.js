import{d as ue,l as d,s as re,t as N,c as ce,b as p,O as t,R as o,i,F as w,U as C,P as _,Q as b,Y as pe,a5 as me,o as s,h as z,n as ve,V as _e,W as he}from"./index-rdy0OYRO.js";import{E as be,a as fe}from"./table-column-_ZPGVE9m.js";import"./checkbox-BmtYc19h.js";/* empty css                */import"./popper-C1dJVMHe.js";import{E as ge}from"./scrollbar-CSo9-bN8.js";/* empty css              */import{E as xe}from"./input-number-NSICRcg1.js";import"./tag-BRxh4fB-.js";import{E as we}from"./button-BoEhTCqL.js";import{E as Ce}from"./image-viewer-DXxSlsaA.js";import{a as ye,E as Ie}from"./form-item-BokEJ3cU.js";/* empty css                      */import{E as Ee,a as Ve}from"./select-CExuIoDN.js";import{c as f}from"./request-Lvc6RqUG.js";import{g as ke,c as y}from"./index-CLHhQf4P.js";import{e as ze}from"./index-C0ANg5tD.js";import{g as Se}from"./index-r4t2FPxk.js";import{h as Ue}from"./index-CqdlnLfC.js";/* empty css                */import{E as qe}from"./index-C2sd-v8d.js";import{E as De,a as Ne,b as Be}from"./index-ClviQmnJ.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-form-item-N45HEDO7.js";import"./_initCloneObject-sB_DMj1P.js";import"./event-BB_Ol6Sd.js";import"./isEqual-BVzc1rHc.js";import"./focus-trap-C2II57zL.js";import"./index-BgP6lWe4.js";import"./scroll-_wDhAng0.js";import"./castArray-CeqcRjz9.js";import"./_baseClone-CCxL846H.js";import"./refs-L3Q9uv7g.js";const j=S=>(_e("data-v-1d3dfbba"),S=S(),he(),S),Me={class:"goods-reserve"},je={class:"s-top_bar"},Fe={key:1,style:{width:"166px","text-align":"center",padding:"10px"}},Le={class:"row"},Te={class:"col col1"},Ze={class:"goods-type"},$e=["onClick"],Oe={class:"col col2"},Pe={class:"goods-list"},Ae={class:"msg"},He=["title"],Qe=["title"],We=j(()=>t("label",{for:""},"规格(尺寸)：",-1)),Ye=["title"],Ge=j(()=>t("label",{for:""},"单  价：",-1)),Je={class:"p"},Ke=j(()=>t("label",{for:""},"库  存：",-1)),Xe={class:"col col3"},el={class:"table"},ll={class:"bottom-bar"},ol={class:"p1"},tl={class:"p2"},al=ue({__name:"Reserve",setup(S){const H=pe(),g=me(),n=d(g.query.exhibitionId?Number(g.query.exhibitionId):""),m=d(g.query.exhibitorId?Number(g.query.exhibitorId):""),r=d(g.query.hallCode||""),u=d(g.query.positionCode||""),Q=g.query.clueId,U=d(0),I=d([]),E=d({}),x=d([]),F=d([]),L=d([]),T=d([]),q=d([]);re({});const W=(l,a=1)=>{y.addCart({exhibitorId:m.value,exhibitionId:n.value,hallCode:r.value,positionCode:u.value,id:l.id,num:a}).then(v=>{v.code===0?(f.success("添加成功"),h()):f.error(v.msg)})},Y=(l,a=1)=>{y.editCart({exhibitorId:m.value,exhibitionId:n.value,hallCode:r.value,positionCode:u.value,id:l.id,num:a}).then(v=>{v.code===0?f.success("成功"):f.error(v.msg),h()})},G=l=>{y.delCart({exhibitorId:m.value,exhibitionId:n.value,hallCode:r.value,positionCode:u.value,id:l.id,num:l.num}).then(a=>{a.code===0?(f.success("删除成功"),h()):f.error(a.msg)})},J=l=>{E.value=I.value[l]},K=()=>{ze().then(l=>{l.code===0&&(F.value=l.data)})},Z=()=>{Se({exhibitionId:n.value}).then(l=>{l.code===0&&(L.value=l.data)})},$=()=>{ke({exhibitionId:n.value}).then(l=>{l.code===0&&(T.value=l.data)})},B=()=>{q.value=[],Ue({exhibitionId:n.value,hallCode:r.value}).then(l=>{l.code===0&&(q.value=l.data)})},O=()=>{y.getMaterial({exhibitionId:n.value}).then(l=>{l.code===0&&(I.value=l.data,I.value.length>0?E.value=I.value[0]:E.value={})})},h=()=>{if(!n.value||!r.value||!u.value){x.value=[];return}y.getCart({exhibitorId:m.value,exhibitionId:n.value,hallCode:r.value,positionCode:u.value}).then(l=>{l.code===0&&(x.value=l.data)})},D=d(!1),X=()=>{D.value=!0,y.create({clueId:Q,exhibitionId:n.value,exhibitorId:m.value,hallCode:r.value,positionCode:u.value,price:U.value,data:x.value.map(l=>({...l,remark:""}))}).then(l=>{l.code===0?(f.success("提交成功"),H.go(-1)):f.error(l.msg),D.value=!1}).catch(l=>{D.value=!1})};N(()=>n.value,l=>{r.value="",u.value="",m.value="",Z(),$(),B(),O(),h()}),N(()=>m.value,l=>{h()}),N(()=>r.value,l=>{u.value="",B(),h()}),N(()=>u.value,l=>{h()});const ee=ce(()=>{let l=0;return x.value.forEach(a=>{l+=a.price*a.num}),U.value=l,l});return K(),Z(),$(),B(),O(),h(),(l,a)=>{const v=Ee,R=Ve,V=ye,P=qe,le=De,oe=Ne,te=Be,ae=Ie,ie=Ce,M=we,se=ge,k=fe,ne=xe,de=be;return s(),p("div",Me,[t("div",je,[o(ae,{inline:!0},{default:i(()=>[o(V,{label:"展会名称",style:{width:"220px"}},{default:i(()=>[o(R,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),placeholder:"请选择展会名称",disabled:""},{default:i(()=>[(s(!0),p(w,null,C(F.value,e=>(s(),z(v,{key:e.id,label:e.exhibitionName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"参展企业",style:{width:"220px"}},{default:i(()=>[o(R,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),placeholder:"请选择参展企业",disabled:""},{default:i(()=>[(s(!0),p(w,null,C(L.value,e=>(s(),z(v,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"展馆",style:{width:"220px"}},{default:i(()=>[o(R,{modelValue:r.value,"onUpdate:modelValue":a[2]||(a[2]=e=>r.value=e),placeholder:"请选择展馆"},{default:i(()=>[(s(!0),p(w,null,C(T.value,e=>(s(),z(v,{key:e.code,label:e.code,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"展位号",style:{width:"220px"}},{default:i(()=>[o(te,{trigger:"click",style:{width:"100%"},"max-height":"300px",onCommand:a[4]||(a[4]=e=>{u.value=e})},{dropdown:i(()=>[q.value.length?(s(),z(oe,{key:0},{default:i(()=>[(s(!0),p(w,null,C(q.value,(e,c)=>(s(),z(le,{key:c,style:{width:"166px"},command:e},{default:i(()=>[_(b(e),1)]),_:2},1032,["command"]))),128))]),_:1})):(s(),p("div",Fe,"无数据"))]),default:i(()=>[o(P,{modelValue:u.value,"onUpdate:modelValue":a[3]||(a[3]=e=>u.value=e),autocomplete:"off","suffix-icon":"ArrowDown"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),t("div",Le,[t("div",Te,[t("ul",Ze,[(s(!0),p(w,null,C(I.value,(e,c)=>(s(),p("li",{key:c,onClick:A=>J(c),class:ve({active:e.project===E.value.project})},b(e.project),11,$e))),128))])]),t("div",Oe,[o(se,null,{default:i(()=>[t("div",Pe,[(s(!0),p(w,null,C(E.value.data,(e,c)=>(s(),p("li",{key:c},[o(ie,{style:{width:"100%",height:"200px"},src:e.img,"preview-src-list":[e.img],fit:"contain"},null,8,["src","preview-src-list"]),t("div",Ae,[t("p",{class:"title",title:e.position},b(e.position),9,He),t("p",{class:"p",title:e.size},[We,_(b(e.size),1)],8,Qe),t("p",{class:"p",title:e.price+"元/"+e.unit},[Ge,t("span",null,b(e.price+"元/"+e.unit),1)],8,Ye),t("p",Je,[Ke,_(b(e.stock),1)])]),o(M,{type:"primary",onClick:A=>W(e),disabled:e.stock<=0,style:{width:"100%"}},{default:i(()=>[_("加入购物车")]),_:2},1032,["onClick","disabled"])]))),128))])]),_:1})]),t("div",Xe,[t("div",el,[o(de,{data:x.value,border:""},{default:i(()=>[o(k,{label:"服务项目",prop:"project","min-width":"120"}),o(k,{label:"位置/版面",prop:"position","min-width":"120"}),o(k,{label:"规格",prop:"size"}),o(k,{label:"单价(RMB)",prop:"price","min-width":"120"}),o(k,{label:"数量",width:"200px"},{default:i(e=>[o(ne,{modelValue:e.row.num,"onUpdate:modelValue":c=>e.row.num=c,min:1,size:"small",onChange:(c,A)=>{Y(e.row,c)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),o(M,{type:"danger",link:"",onClick:c=>G(e.row),style:{"margin-left":"10px"},icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),t("div",ll,[t("div",ol,[t("span",null,[_("已选物料 "),t("b",null,b(x.value.length),1),_(" 项")]),_(),t("span",null,[_("物料金额 "),t("b",null,"¥"+b(ee.value),1)])]),t("div",tl,[o(V,{label:"最终金额",style:{width:"100%","margin-bottom":"0"}},{default:i(()=>[o(P,{modelValue:U.value,"onUpdate:modelValue":a[5]||(a[5]=e=>U.value=e)},null,8,["modelValue"])]),_:1})]),o(M,{type:"primary",style:{width:"100%"},onClick:X,loading:D.value,disabled:x.value.length<=0},{default:i(()=>[_("提交")]),_:1},8,["loading","disabled"])])])])])}}}),Fl=Re(al,[["__scopeId","data-v-1d3dfbba"]]);export{Fl as default};
