import{d as A,S as J,l as d,t as K,s as R,b as g,O as y,R as t,i as l,F as w,W as Y,a5 as Z,o as v,P as r,Q as b,e as ee,ai as te}from"./index-BgyAZvUt.js";import{E as oe}from"./el-dialog-CrHQF44X.js";/* empty css                   */import{E as ae}from"./el-progress-Cf38t9K3.js";/* empty css                       */import{E as le,a as re}from"./el-radio-BUbTR3Ls.js";import{E as ie}from"./el-pagination-yaz31Ocb.js";/* empty css                 */import"./el-tag-DEVuN4Hv.js";import"./el-select-oKGMiqGO.js";import"./el-scrollbar-HjInS6QP.js";import"./el-popper-BpTaYU20.js";import{E as ne,a as se}from"./el-table-column-DuJ8cpfO.js";import"./el-checkbox-B_5_CmJi.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import{T as pe}from"./index-B7fo2GEf.js";import{b as _}from"./index-xU4fImAO.js";import{u as de}from"./index-B9-25RlL.js";import{d as me}from"./index-BRdYTn37.js";import{z as ue}from"./fileZip-BL5mChJn.js";import{_ as ce}from"./ExhibitionChange.vue_vue_type_script_setup_true_lang-DKKrFs_4.js";/* empty css                       *//* empty css                   */import{c as s}from"./request-D6fvGTDh.js";import{E as fe}from"./index-Z1v5JTS_.js";import{E as $}from"./index-DtGwBMso.js";import"./index-B52ECxk7.js";import"./use-form-item-Dm97kLAn.js";import"./scroll-ByT-L5SG.js";import"./vnode-ptL780bU.js";import"./refs-CuZ_QrPr.js";import"./event-BB_Ol6Sd.js";import"./cloneDeep-_hS19oGl.js";import"./_baseClone-DBDXGBzA.js";import"./_initCloneObject-D27w6Cg6.js";import"./isEqual-Bds9XCaA.js";import"./index-CunGH_dN.js";import"./castArray-DOsbaNJB.js";import"./el-form-item-w7WYBo5V.js";/* empty css                                                              */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";/* empty css                        */import"./el-dropdown-item-9G17iIa_.js";import"./index-BA48cLjW.js";import"./aria-KgdLjl5h.js";import"./validator-BkA75A30.js";const he={class:"s-flex-col",style:{height:"100%"}},_e={class:"",style:{"margin-bottom":"10px"}},ge={class:"s-table-operations"},ye={class:"s-flex-auto",style:{"min-height":"0"}},we={class:"s-table-pagination"},ht=A({__name:"Booth",setup(ve){const C=J(),E=d(C.EXHIBITION_INFO);K(()=>C.EXHIBITION_INFO,(o,e)=>{o.id!==e.id&&(E.value=o,c())},{deep:!0}),Y();const F=Z(),u=d(!1),f=R({page:1,perPage:10}),x=d(0),I=d({}),N=F.query.id,k=d([]),S=d(null),T=d([]),p=R({show:!1,file:"",type:1,orderId:""}),U=o=>{I.value=o,f.page=1,c()},c=()=>{_.getList({exhibitionId:E.value.id,...f,...I.value}).then(o=>{o.code===0?(k.value=o.data.data,x.value=o.data.total):k.value=[{}]})},V=o=>{$.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.revoke({id:o}).then(e=>{e.code===0?(s.success("撤销成功"),c()):s.error(e.msg)})}).catch(()=>{})},D=o=>{$.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_.del({id:o}).then(e=>{e.code===0?(s.success("删除成功"),c()):s.error(e.msg)})}).catch(()=>{})},P=()=>{let o=S.value.getSelectionRows().map(e=>e.id);if(o.length===0){s.warning("请选择需要下载的数据");return}me({orderId:o}).then(e=>{if(e.code===0){if(e.data.length===0){s.warning("无数据");return}ue(e.data)}else s.error(e.msg)})},O=()=>{_.export({exhibitionId:N}).then(o=>{o.code===0?(window.open(o.data.url,"_self"),s.success("导出成功")):s.error(o.msg)})},L=d(null);let m=d([]);const q=o=>{let e=o[0];m.value=[{name:e.name,size:e.size,uid:e.uid,status:"ready",percentage:0,raw:e}]},M=o=>{const e=o.size/1024/1024<3;return e||s.error("文件大小不能超过 3MB!"),e},B=o=>{p.show=!0,p.type=1,p.orderId=o,p.file="",m.value=[]},H=()=>{if(p.type===1&&m.value.length===0){s.warning("请选择合同文件");return}u.value=!0;let o=new FormData;o.append("upload",m.value[0].raw),de(o).then(e=>{e.code===0?_.receipt({orderId:p.orderId,type:p.type,url:e.data.url}).then(n=>{n.code===0?(s.success("上传成功"),p.show=!1,c()):s.error(n.msg),u.value=!1,console.log(u.value)}).catch(()=>{u.value=!1}):(s.error(e.msg),u.value=!1)}).catch(()=>{u.value=!1})};return _.getSearchField().then(o=>{o.code===0&&(T.value=o.data)}),c(),(o,e)=>{const n=fe,i=se,X=ne,j=ie,z=le,G=re,Q=ae,W=oe;return v(),g(w,null,[y("div",he,[y("div",_e,[t(ce)]),t(pe,{data:T.value,onSearch:U},null,8,["data"]),y("div",ge,[t(n,{size:"small",onClick:P},{default:l(()=>[r("批量下载合同")]),_:1}),t(n,{size:"small",onClick:O},{default:l(()=>[r("导出")]),_:1})]),y("div",ye,[t(X,{ref_key:"tableRef",ref:S,data:k.value,border:"",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[t(i,{type:"selection",width:"40",fixed:"left"}),t(i,{prop:"orderCode",label:"订单编号",width:"280"}),t(i,{prop:"companyName",label:"企业名称","min-width":"120"}),t(i,{prop:"exhibitionName",label:"展会名称","min-width":"120"}),t(i,{prop:"hallCode",label:"展馆号"}),t(i,{prop:"positionCode",label:"展位号"}),t(i,{prop:"area",label:"面积"}),t(i,{prop:"num",label:"展位数量","min-width":"120"}),t(i,{prop:"orderPrice",label:"订单金额","min-width":"120"}),t(i,{prop:"orderType",label:"下单方式","min-width":"120"},{default:l(a=>[r(b(a.row.orderType===1?"代下单":"展商下单"),1)]),_:1}),t(i,{prop:"payStatus",label:"付款状态","min-width":"120"},{default:l(a=>[r(b({0:"未付款",1:"部分付款",2:"已付款"}[a.row.payStatus]),1)]),_:1}),t(i,{prop:"receivedPrice",label:"到款金额","min-width":"120"}),t(i,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:l(a=>[r(b({0:"未签订",1:"已签订",2:"已回执(电子)",3:"已回执(纸质)"}[a.row.contractStatus]),1)]),_:1}),t(i,{prop:"invoiceStatus",label:"发票状态","min-width":"120"},{default:l(a=>[r(b({0:"未申请",1:"待开票",2:"部分开票",3:"已开票"}[a.row.invoiceStatus]),1)]),_:1}),t(i,{prop:"clueUser",label:"所属人"}),t(i,{prop:"authUser",label:"下单人"}),t(i,{fixed:"right",label:"操作",width:"250"},{default:l(a=>[t(n,{link:"",type:"primary",onClick:h=>o.$router.push({name:"OrderBoothDetail",query:{id:a.row.id}})},{default:l(()=>[r("详情")]),_:2},1032,["onClick"]),a.row.orderStatus!==0?(v(),g(w,{key:0},[a.row.contractStatus===0?(v(),g(w,{key:0},[t(n,{link:"",type:"primary",onClick:h=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:1}})},{default:l(()=>[r("签订合同")]),_:2},1032,["onClick"]),t(n,{link:"",type:"primary",onClick:h=>B(a.row.id)},{default:l(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)):(v(),g(w,{key:1},[t(n,{link:"",type:"primary",onClick:h=>o.$router.push({name:"ContractTemplates",query:{id:a.row.id,type:1}})},{default:l(()=>[r("更新合同")]),_:2},1032,["onClick"]),t(n,{link:"",type:"primary",onClick:h=>B(a.row.id)},{default:l(()=>[r("上传合同")]),_:2},1032,["onClick"])],64)),t(n,{link:"",type:"primary",onClick:h=>V(a.row.id)},{default:l(()=>[r("撤销")]),_:2},1032,["onClick"])],64)):(v(),g(w,{key:1},[t(n,{link:"",type:"",disabled:""},{default:l(()=>[r("已撤销")]),_:1}),t(n,{link:"",type:"danger",onClick:h=>D(a.row.id)},{default:l(()=>[r("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),y("div",we,[t(j,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:x.value,"current-page":f.page,"onUpdate:currentPage":e[0]||(e[0]=a=>f.page=a),"page-size":f.perPage,"onUpdate:pageSize":e[1]||(e[1]=a=>f.perPage=a),onChange:c},null,8,["total","current-page","page-size"])])]),t(W,{modelValue:p.show,"onUpdate:modelValue":e[5]||(e[5]=a=>p.show=a),title:"上传合同",width:"400",draggable:""},{footer:l(()=>[t(n,{type:"primary",onClick:H,loading:u.value},{default:l(()=>[r("确定")]),_:1},8,["loading"]),t(n,{onClick:e[4]||(e[4]=a=>p.show=!1)},{default:l(()=>[r("取消")]),_:1})]),default:l(()=>[t(G,{modelValue:p.type,"onUpdate:modelValue":e[2]||(e[2]=a=>p.type=a)},{default:l(()=>[t(z,{value:1},{default:l(()=>[r("电子合同")]),_:1}),t(z,{value:2},{default:l(()=>[r("纸质合同")]),_:1})]),_:1},8,["modelValue"]),t(Q,{ref_key:"uploadRef",ref:L,"auto-upload":!1,limit:1,"before-upload":M,"on-exceed":q,"file-list":ee(m),"onUpdate:fileList":e[3]||(e[3]=a=>te(m)?m.value=a:m=a),style:{"margin-top":"10px"}},{default:l(()=>[t(n,{size:"small",type:"primary"},{default:l(()=>[r("点击上传")]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])],64)}}});export{ht as default};
