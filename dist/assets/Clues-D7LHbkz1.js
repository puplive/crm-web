import{p as me,ao as fe,d as q,c as F,a as ve,t as s,e as P,ae as he,o as n,h as m,i as a,b as y,n as be,Z as B,ak as f,r as Q,Y as i,m as ge,_ as we,az as _e,w as ye,y as ke,aA as Ee,X as C,$ as r,J as U,a5 as Ce,am as Ve,a7 as u,a1 as N}from"./index-DEM1Q7ah.js";import{E as Se}from"./dialog-OvK7FIEd.js";/* empty css                */import{a as Pe,E as Ue}from"./form-item-BqEwLgzp.js";/* empty css              */import"./tag-BOE4AccX.js";import{E as Re,a as xe}from"./select-DycYLwTT.js";import"./scrollbar-CyicQk5x.js";import{a as ee,u as k,E as ze}from"./popper-6cDUjaRW.js";import{E as Fe}from"./pagination-CxeK4p13.js";import{E as Be,a as $e}from"./table-column-wBiq0U5n.js";import{E as De,a as Ie}from"./checkbox-URtfrshM.js";/* empty css                */import{E as Ne}from"./link-BNrb30ws.js";/* empty css                       */import{E as Te}from"./button-BhsazfUD.js";import{_ as He}from"./index.vue_vue_type_script_setup_true_lang-DP3pQG-h.js";/* empty css                                              */import{a as E}from"./index-D-WV_ICy.js";import{e as Ae}from"./index-DvSBF-rc.js";/* empty css                *//* empty css                    */import{E as Le}from"./index-B9pqzlZv.js";import{d as G}from"./index-AZNK1TTm.js";import"./index-apjzc23w.js";import"./use-form-item-FEc-havy.js";import"./scroll-CzTDrJbU.js";import"./vnode-Bod1Q6cQ.js";import"./focus-trap-OSNMQz79.js";import"./refs-D-YtBsDp.js";import"./event-BB_Ol6Sd.js";import"./castArray-DHLwE7Nc.js";import"./_baseClone-CM4Uj5KP.js";import"./_initCloneObject-B0so-X2S.js";import"./isEqual-Dnbp5P_R.js";import"./index-rUWjPUE6.js";/* empty css                      */import"./aria-KgdLjl5h.js";import"./validator-Cf7VM-w_.js";const Me=me({trigger:ee.trigger,placement:G.placement,disabled:ee.disabled,visible:k.visible,transition:k.transition,popperOptions:G.popperOptions,tabindex:G.tabindex,content:k.content,popperStyle:k.popperStyle,popperClass:k.popperClass,enterable:{...k.enterable,default:!0},effect:{...k.effect,default:"light"},teleported:k.teleported,title:String,width:{type:[String,Number],default:150},offset:{type:Number,default:void 0},showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200},autoClose:{type:Number,default:0},showArrow:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},"onUpdate:visible":{type:Function}}),Oe={"update:visible":h=>fe(h),"before-enter":()=>!0,"before-leave":()=>!0,"after-enter":()=>!0,"after-leave":()=>!0},Ge="onUpdate:visible",qe=q({name:"ElPopover"}),je=q({...qe,props:Me,emits:Oe,setup(h,{expose:p,emit:v}){const d=h,$=F(()=>d[Ge]),b=ve("popover"),R=s(),D=F(()=>{var l;return(l=P(R))==null?void 0:l.popperRef}),T=F(()=>[{width:he(d.width)},d.popperStyle]),w=F(()=>[b.b(),d.popperClass,{[b.m("plain")]:!!d.content}]),V=F(()=>d.transition===`${b.namespace.value}-fade-in-linear`),S=()=>{var l;(l=R.value)==null||l.hide()},I=()=>{v("before-enter")},H=()=>{v("before-leave")},A=()=>{v("after-enter")},L=()=>{v("update:visible",!1),v("after-leave")};return p({popperRef:D,hide:S}),(l,x)=>(n(),m(P(ze),ge({ref_key:"tooltipRef",ref:R},l.$attrs,{trigger:l.trigger,placement:l.placement,disabled:l.disabled,visible:l.visible,transition:l.transition,"popper-options":l.popperOptions,tabindex:l.tabindex,content:l.content,offset:l.offset,"show-after":l.showAfter,"hide-after":l.hideAfter,"auto-close":l.autoClose,"show-arrow":l.showArrow,"aria-label":l.title,effect:l.effect,enterable:l.enterable,"popper-class":P(w),"popper-style":P(T),teleported:l.teleported,persistent:l.persistent,"gpu-acceleration":P(V),"onUpdate:visible":P($),onBeforeShow:I,onBeforeHide:H,onShow:A,onHide:L}),{content:a(()=>[l.title?(n(),y("div",{key:0,class:be(P(b).e("title")),role:"title"},B(l.title),3)):f("v-if",!0),Q(l.$slots,"default",{},()=>[i(B(l.content),1)])]),default:a(()=>[l.$slots.reference?Q(l.$slots,"reference",{key:0}):f("v-if",!0)]),_:3},16,["trigger","placement","disabled","visible","transition","popper-options","tabindex","content","offset","show-after","hide-after","auto-close","show-arrow","aria-label","effect","enterable","popper-class","popper-style","teleported","persistent","gpu-acceleration","onUpdate:visible"]))}});var Ye=we(je,[["__file","popover.vue"]]);const te=(h,p)=>{const v=p.arg||p.value,d=v==null?void 0:v.popperRef;d&&(d.triggerRef=h)};var Je={mounted(h,p){te(h,p)},updated(h,p){te(h,p)}};const Ke="popover",We=_e(Je,Ke),Xe=ye(Ye,{directive:We}),Ze="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1723262854264'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='5989'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M482.12992%2064v418.12992H64V64h418.12992z%20m-59.72992%2059.72992H123.72992V422.4H422.4V123.72992zM123.72992%20541.87008h59.74016V960h-59.74016z%20m238.94016%200h59.72992V960h-59.72992z%20m238.92992%200h59.72992V960H601.6z%20m238.92992%200h59.74016V960h-59.74016zM960%2064v418.12992H541.87008V64H960z%20m-59.72992%2059.72992H601.6V422.4h298.67008V123.72992z'%20p-id='5990'%20fill='%23606266'%3e%3c/path%3e%3c/svg%3e",Qe={class:"s-flex-col",style:{height:"100%"}},et={class:"s-table-operations"},tt=C("img",{style:{width:"17px"},src:Ze,alt:""},null,-1),ot={class:"s-flex-auto",style:{"min-height":"0"}},lt={class:"s-table-pagination"},at={class:"dialog-footer"},rt={class:"dialog-footer"},Yt=q({__name:"Clues",setup(h){Ce(),Ve();const p=ke({page:1,perPage:20}),v=s(0),d=s({}),$=s([]),b=s(null),R=s([]),D=s([]),T=e=>{d.value=e,p.page=1,w()},w=async()=>{E.getList({status:1,...p,...d.value}).then(e=>{e.code===0&&($.value=e.data.data,v.value=e.data.total)})},V=s({}),S=s(!1),I=s(null),H=e=>{V.value.id=e.id,S.value=!0},A=()=>{I.value.validate(e=>{e&&E.changeIntention(V.value).then(o=>{o.code===0?(u.success("转为意向成功"),w(),S.value=!1):u.error(o.msg)})})},L=()=>{let e=b.value.getSelectionRows().map(o=>o.id);if(e.length===0){u.warning("请选择需要删除的线索");return}Le.confirm("确定删除所选线索？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{E.del({id:e}).then(o=>{o.code===0?(u.success("删除成功"),w()):u.error(o.msg)})}).catch(()=>{})},l=s({}),x=s(!1),j=s(null),Y=s([]),oe=()=>{let e=b.value.getSelectionRows().map(o=>o.id);if(e.length===0){u.warning("请选择需要转移的线索");return}l.value.id=e,x.value=!0},le=()=>{j.value.validate(e=>{e&&E.changeUser(l.value).then(o=>{o.code===0?(u.success("转移成功"),x.value=!1,w()):u.error(o.msg)})})},ae=()=>{let e=b.value.getSelectionRows().map(o=>o.id);if(e.length===0){u.warning("请选择需要移至公海的线索");return}E.changePublic({id:e}).then(o=>{o.code===0?(u.success("移至公海成功"),w()):u.error(o.msg)})},re=()=>{E.clueExport({status:1}).then(e=>{e.code===0?(u.success("导出成功"),window.open(e.data.url,"_self")):u.error(e.msg)})};E.getSearchField().then(e=>{e.code===0&&(R.value=e.data)}),Ae().then(e=>{e.code===0&&(D.value=e.data)}),Ee().then(e=>{e.code===0&&(Y.value=e.data)});const J=s([]);(()=>{E.getCustomField().then(e=>{e.code===0&&(J.value=e.data,ne())})})(),w();const z=s([]),M=s([]),ne=()=>{setTimeout(()=>{let e=[];b.value.columns.forEach(o=>{o.label&&e.push(o.label)}),M.value=e.join(",").split(","),z.value=e.join(",").split(",")},0)},_=e=>z.value.length===0&&M.value.length===0?!0:z.value.includes(e);return(e,o)=>{const c=Te,se=De,ie=Ie,pe=Xe,g=$e,ue=Ne,de=Be,ce=Fe,K=Re,W=xe,O=Pe,X=Ue,Z=Se;return n(),y(U,null,[C("div",Qe,[r(He,{data:R.value,onSearch:T},null,8,["data"]),C("div",et,[r(c,{onClick:o[0]||(o[0]=t=>e.$router.push("/market/clues/add"))},{default:a(()=>[i("新建线索")]),_:1}),r(c,{onClick:o[1]||(o[1]=t=>e.$router.push({name:"CluesImport",query:{status:1}}))},{default:a(()=>[i("导入")]),_:1}),r(c,{onClick:re},{default:a(()=>[i("导出")]),_:1}),r(c,{onClick:oe},{default:a(()=>[i("转移给他人")]),_:1}),r(c,{onClick:ae},{default:a(()=>[i("移至公海")]),_:1}),r(c,{onClick:L},{default:a(()=>[i("删除")]),_:1}),r(pe,{placement:"bottom-end",trigger:"click"},{reference:a(()=>[r(c,{size:"",link:""},{default:a(()=>[tt]),_:1})]),default:a(()=>[r(ie,{modelValue:z.value,"onUpdate:modelValue":o[2]||(o[2]=t=>z.value=t)},{default:a(()=>[C("ul",null,[(n(!0),y(U,null,N(M.value,t=>(n(),y("li",{class:"s-checkbox_item",key:t},[r(se,{label:t,value:t},{default:a(()=>[i(B(t),1)]),_:2},1032,["label","value"])]))),128))])]),_:1},8,["modelValue"])]),_:1})]),C("div",ot,[r(de,{ref_key:"tableRef",ref:b,data:$.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:a(()=>[r(g,{type:"selection",width:"42"}),_("序号")?(n(),m(g,{key:0,type:"index",label:"序号",width:"60"})):f("",!0),_("企业名称")?(n(),m(g,{key:1,prop:"companyName",label:"企业名称",width:"180"},{default:a(t=>[r(ue,{href:"/market/clues/info?type=1&id="+t.row.id+"&exhibitionId="+t.row.exhibitionId+"&authUser="+t.row.authUser,type:"primary"},{default:a(()=>[i(B(t.row.companyName),1)]),_:2},1032,["href"])]),_:1})):f("",!0),_("展会联系人")?(n(),m(g,{key:2,prop:"exhibitionContact",label:"展会联系人","min-width":"120"})):f("",!0),_("职位")?(n(),m(g,{key:3,prop:"duties",label:"职位"})):f("",!0),_("手机号")?(n(),m(g,{key:4,prop:"phone",label:"手机号","min-width":"120"})):f("",!0),_("跟进状态")?(n(),m(g,{key:5,prop:"recordStatus",label:"跟进状态","min-width":"120"},{default:a(t=>[i(B({0:"无",1:"电话邀约",2:"客户拜访",3:"初步方案",4:"停滞"}[t.row.recordStatus]),1)]),_:1})):f("",!0),_("持有人")?(n(),m(g,{key:6,prop:"authUser",label:"持有人"})):f("",!0),(n(!0),y(U,null,N(J.value,t=>(n(),y(U,{key:t.key},[_(t.name)?(n(),m(g,{key:0,prop:t.key,label:t.name,"min-width":"120"},null,8,["prop","label"])):f("",!0)],64))),128)),_("操作")?(n(),m(g,{key:7,fixed:"right",label:"操作",width:"120"},{default:a(t=>[r(c,{link:"",type:"primary",onClick:st=>H(t.row)},{default:a(()=>[i(" 转为意向客户 ")]),_:2},1032,["onClick"])]),_:1})):f("",!0)]),_:1},8,["data"])]),C("div",lt,[r(ce,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50],total:v.value,"current-page":p.page,"onUpdate:currentPage":o[3]||(o[3]=t=>p.page=t),"page-size":p.perPage,"onUpdate:pageSize":o[4]||(o[4]=t=>p.perPage=t),onChange:w},null,8,["total","current-page","page-size"])])]),r(Z,{modelValue:S.value,"onUpdate:modelValue":o[7]||(o[7]=t=>S.value=t),title:"转为意向客户",width:"500",draggable:""},{footer:a(()=>[C("div",at,[r(c,{onClick:o[6]||(o[6]=t=>S.value=!1)},{default:a(()=>[i("取消")]),_:1}),r(c,{type:"primary",onClick:A},{default:a(()=>[i("确定")]),_:1})])]),default:a(()=>[r(X,{ref_key:"willFormRef",ref:I,model:V.value,"label-width":"auto","label-position":"left"},{default:a(()=>[r(O,{label:"项目",prop:"exhibitionId",rules:[{required:!0,message:"请选择项目"}]},{default:a(()=>[r(W,{modelValue:V.value.exhibitionId,"onUpdate:modelValue":o[5]||(o[5]=t=>V.value.exhibitionId=t),placeholder:"",filterable:""},{default:a(()=>[(n(!0),y(U,null,N(D.value,t=>(n(),y(U,{key:t.id},[t.status===1?(n(),m(K,{key:0,label:t.exhibitionName,value:t.id},null,8,["label","value"])):f("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(Z,{modelValue:x.value,"onUpdate:modelValue":o[10]||(o[10]=t=>x.value=t),title:"转移销售线索",width:"500",draggable:""},{footer:a(()=>[C("div",rt,[r(c,{onClick:o[9]||(o[9]=t=>x.value=!1)},{default:a(()=>[i("取消")]),_:1}),r(c,{type:"primary",onClick:le},{default:a(()=>[i("确定")]),_:1})])]),default:a(()=>[r(X,{ref_key:"moveFormRef",ref:j,model:l.value,"label-width":"auto","label-position":"left"},{default:a(()=>[r(O,{label:""},{default:a(()=>[i("是否将选中的销售线索转移？")]),_:1}),r(O,{label:"销售线索所有人",prop:"userId",rules:[{required:!0,message:"请选择销售线索所有人"}]},{default:a(()=>[r(W,{modelValue:l.value.userId,"onUpdate:modelValue":o[8]||(o[8]=t=>l.value.userId=t),placeholder:"",filterable:""},{default:a(()=>[(n(!0),y(U,null,N(Y.value,t=>(n(),m(K,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{Yt as default};
