import{d as le,y as oe,t as n,az as ae,b as f,X as _,$ as a,i as o,J as v,a5 as re,am as ne,a7 as u,o as r,Y as d,a1 as V,Z as q,h as s,ak as m}from"./index-BRmrzHEr.js";import{E as se}from"./dialog-D3ab6NuW.js";/* empty css                */import{a as ie,E as ue}from"./form-item-DcIcwg5x.js";/* empty css              */import"./tag-CfYxiI55.js";import{E as de,a as me}from"./select-CQmxgpqw.js";import"./scrollbar-Dj3-w51a.js";import"./popper-BZ6z93ru.js";import{E as pe,a as ce,_ as fe}from"./sx-mn4ff5xs.js";import{E as _e,a as ve}from"./table-column-CRHe0LvB.js";import{E as he,a as ge}from"./checkbox-CVldrTYR.js";/* empty css                */import{E as be}from"./link-DExaJ3ev.js";/* empty css                       */import{E as ke}from"./button-BEIJe6IA.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-R5MyVMSB.js";/* empty css                                              */import{a as h}from"./index-wKy_4Lj4.js";import{e as we}from"./index-C0FEPTx2.js";/* empty css                *//* empty css                    */import"./index-p5kWracg.js";import"./use-form-item-BUiD0iLk.js";import"./scroll-B55m7Woe.js";import"./vnode-B08h92LP.js";import"./focus-trap-ClUrTywZ.js";import"./refs-IN7oNn-D.js";import"./event-BB_Ol6Sd.js";import"./castArray-xc9fyNme.js";import"./_baseClone-OfWWqZFx.js";import"./_initCloneObject-8SIgaqUT.js";import"./isEqual-_GDidDbO.js";import"./index-DDCl2Vg9.js";import"./dropdown-DhwMkGrw.js";/* empty css                      */import"./index-Oi64E0Wl.js";const xe={class:"s-flex-col",style:{height:"100%"}},Ee={class:"s-table-operations"},Ce=_("img",{style:{width:"17px"},src:fe,alt:""},null,-1),Ve={class:"s-flex-auto",style:{"min-height":"0"}},Fe={class:"s-table-pagination"},Se={class:"dialog-footer"},Ue={class:"dialog-footer"},_t=le({__name:"Historical",setup(Ie){re(),ne();const g=oe({page:1,perPage:20}),U=n(0),I=n({}),R=n([]),x=n(null),N=n([]),z=n([]),G=t=>{I.value=t,g.page=1,b()},b=async()=>{h.getList({status:4,...g,...I.value}).then(t=>{t.code===0&&(R.value=t.data.data,U.value=t.data.total)})},E=n({}),C=n(!1),P=n(null),H=()=>{P.value.validate(t=>{t&&h.changeIntention(E.value).then(l=>{l.code===0?(u.success("转为意向成功"),b(),C.value=!1):u.error(l.msg)})})},k=n({}),y=n(!1),T=n(null),B=n([]),J=()=>{let t=x.value.getSelectionRows().map(l=>l.id);if(t.length===0){u.error("请选择需要转移的线索");return}k.value.id=t,y.value=!0},O=()=>{T.value.validate(t=>{t&&h.changeUser(k.value).then(l=>{l.code===0?(u.success("转移成功"),y.value=!1,b()):u.error(l.msg)})})},X=()=>{let t=x.value.getSelectionRows().map(l=>l.id);if(t.length===0){u.error("请选择需要移至公海的线索");return}h.changePublic({id:t}).then(l=>{l.code===0?(u.success("移至公海成功"),b()):u.error(l.msg)})},Y=()=>{h.clueExport({status:4}).then(t=>{t.code===0?(u.success("导出成功"),window.open(t.data.url,"_self")):u.error(t.msg)})};h.getSearchField().then(t=>{t.code===0&&(N.value=t.data)}),we().then(t=>{t.code===0&&(z.value=t.data)}),ae().then(t=>{t.code===0&&(B.value=t.data)});const D=n([]);(()=>{h.getCustomField().then(t=>{t.code===0&&(D.value=t.data,Z())})})(),b();const w=n([]),F=n([]),Z=()=>{setTimeout(()=>{let t=[];x.value.columns.forEach(l=>{l.label&&t.push(l.label)}),F.value=t.join(",").split(","),w.value=t.join(",").split(",")},0)},p=t=>w.value.length===0&&F.value.length===0?!0:w.value.includes(t);return(t,l)=>{const c=ke,A=he,K=ge,Q=pe,i=ve,W=be,ee=_e,te=ce,L=de,M=me,S=ie,$=ue,j=se;return r(),f(v,null,[_("div",xe,[a(ye,{data:N.value,onSearch:G},null,8,["data"]),_("div",Ee,[a(c,{onClick:Y},{default:o(()=>[d("导出")]),_:1}),a(c,{onClick:J},{default:o(()=>[d("转移给他人")]),_:1}),a(c,{onClick:X},{default:o(()=>[d("移至公海")]),_:1}),a(Q,{placement:"bottom-end",trigger:"click"},{reference:o(()=>[a(c,{size:"",link:""},{default:o(()=>[Ce]),_:1})]),default:o(()=>[a(K,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e)},{default:o(()=>[_("ul",null,[(r(!0),f(v,null,V(F.value,e=>(r(),f("li",{class:"s-checkbox_item",key:e},[a(A,{label:e,value:e},{default:o(()=>[d(q(e),1)]),_:2},1032,["label","value"])]))),128))])]),_:1},8,["modelValue"])]),_:1})]),_("div",Ve,[a(ee,{ref_key:"tableRef",ref:x,data:R.value,border:"","table-layout":"fixed",height:"100%","show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:o(()=>[a(i,{type:"selection",width:"42"}),p("公司名称")?(r(),s(i,{key:0,prop:"companyName",label:"公司名称",width:"180"},{default:o(e=>[a(W,{href:"/market/clues/info?type=1&id="+e.row.id+"&exhibitionId="+e.row.exhibitionId+"&authUser="+e.row.authUser,type:"primary"},{default:o(()=>[d(q(e.row.companyName),1)]),_:2},1032,["href"])]),_:1})):m("",!0),p("联系方式")?(r(),s(i,{key:1,prop:"exhibitionContact",label:"联系方式",width:"180"})):m("",!0),p("职务")?(r(),s(i,{key:2,prop:"duties",label:"职务"})):m("",!0),p("电话")?(r(),s(i,{key:3,prop:"phone",label:"电话"})):m("",!0),p("记录时间")?(r(),s(i,{key:4,prop:"recordTime",label:"记录时间",width:"180"})):m("",!0),p("记录内容")?(r(),s(i,{key:5,prop:"recordText",label:"记录内容","min-width":"120"})):m("",!0),p("持有人")?(r(),s(i,{key:6,prop:"authUser",label:"持有人","min-width":"120"})):m("",!0),p("参展次数")?(r(),s(i,{key:7,prop:"orderNum",label:"参展次数","min-width":"120"})):m("",!0),(r(!0),f(v,null,V(D.value,e=>(r(),f(v,{key:e.key},[p(e.name)?(r(),s(i,{key:0,prop:e.key,label:e.name,"min-width":"120"},null,8,["prop","label"])):m("",!0)],64))),128))]),_:1},8,["data"])]),_("div",Fe,[a(te,{layout:"total, sizes, prev, pager, next","page-sizes":[10,20,50,100],total:U.value,"current-page":g.page,"onUpdate:currentPage":l[1]||(l[1]=e=>g.page=e),"page-size":g.perPage,"onUpdate:pageSize":l[2]||(l[2]=e=>g.perPage=e),onChange:b},null,8,["total","current-page","page-size"])])]),a(j,{modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=e=>C.value=e),title:"转为意向客户",width:"500",draggable:""},{footer:o(()=>[_("div",Se,[a(c,{onClick:l[4]||(l[4]=e=>C.value=!1)},{default:o(()=>[d("取消")]),_:1}),a(c,{type:"primary",onClick:H},{default:o(()=>[d("确定")]),_:1})])]),default:o(()=>[a($,{ref_key:"willFormRef",ref:P,model:E.value,"label-width":"auto","label-position":"left"},{default:o(()=>[a(S,{label:"项目",prop:"exhibitionId",rules:[{required:!0,message:"请选择项目"}]},{default:o(()=>[a(M,{modelValue:E.value.exhibitionId,"onUpdate:modelValue":l[3]||(l[3]=e=>E.value.exhibitionId=e),placeholder:""},{default:o(()=>[(r(!0),f(v,null,V(z.value,e=>(r(),f(v,{key:e.id},[e.status===1?(r(),s(L,{key:0,label:e.exhibitionName,value:e.id},null,8,["label","value"])):m("",!0)],64))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(j,{modelValue:y.value,"onUpdate:modelValue":l[8]||(l[8]=e=>y.value=e),title:"转移销售线索",width:"500",draggable:""},{footer:o(()=>[_("div",Ue,[a(c,{onClick:l[7]||(l[7]=e=>y.value=!1)},{default:o(()=>[d("取消")]),_:1}),a(c,{type:"primary",onClick:O},{default:o(()=>[d("确定")]),_:1})])]),default:o(()=>[a($,{ref_key:"moveFormRef",ref:T,model:k.value,"label-width":"auto","label-position":"left"},{default:o(()=>[a(S,{label:""},{default:o(()=>[d("是否将选中的销售线索转移？")]),_:1}),a(S,{label:"销售线索所有人",prop:"userId",rules:[{required:!0,message:"请选择销售线索所有人"}]},{default:o(()=>[a(M,{modelValue:k.value.userId,"onUpdate:modelValue":l[6]||(l[6]=e=>k.value.userId=e),placeholder:""},{default:o(()=>[(r(!0),f(v,null,V(B.value,e=>(r(),s(L,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{_t as default};
