import{d as ae,t as V,b as y,X as r,$ as e,i as l,a7 as f,o as u,J as R,a1 as H,h as C,Y as s,Z as p,a2 as ne,a3 as se,c as be,y as ee,e as T,aj as z,a5 as ye,al as he}from"./index-Burj71Mz.js";import{E as ke}from"./dialog-CE1vbSJ8.js";/* empty css                *//* empty css              */import"./tag-BMbTJcvT.js";import{a as ie,E as re}from"./select-C6REEyqW.js";import{E as we}from"./scrollbar-BBvbl3-b.js";import"./popper-DN7jCsAx.js";import{E as ge,a as Ce}from"./tab-pane-Dr6bRo73.js";import{a as Ve,E as xe}from"./form-item-BgXu7TbV.js";import{a as Ee,E as Ie}from"./table-column-BIWm4N41.js";import"./checkbox-BId4FXGy.js";/* empty css                */import{E as de}from"./button-Bh1aP2J2.js";/* empty css                    */import{a as $e,E as Te}from"./radio-CepCdyd7.js";import{b as le,d as j,e as Be,f as Ue,h as Ne,i as Re,j as Se}from"./index-D6cOPOhz.js";/* empty css                */import{E as ue}from"./index-BBQhpRIJ.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Fe}from"./Move.vue_vue_type_script_setup_true_lang-CGVfjrGq.js";import{_ as Le}from"./GoodsOrderDetail.vue_vue_type_script_setup_true_lang-BVOIa3rs.js";import{b as te,c as oe}from"./index-DUm3-gKa.js";import{a as Pe}from"./index-BYVKLfFu.js";import{_ as qe}from"./rules-F8IXRWD9.js";/* empty css                    */import{E as P}from"./index-BxGM2uX3.js";import"./index-CvsXQ4m2.js";import"./use-form-item-tjLgBssR.js";import"./scroll-dalFB88l.js";import"./vnode-B8ooRqKJ.js";import"./focus-trap-BKKcV_7_.js";import"./refs-BGTEdiMJ.js";import"./event-BB_Ol6Sd.js";import"./_initCloneObject-DkUEurvZ.js";import"./isEqual-BP9o_BCC.js";import"./castArray-UQdrNKdR.js";import"./index-BRW4hph6.js";import"./_baseClone-ag1-RHwQ.js";import"./aria-KgdLjl5h.js";import"./validator-g63KIeJx.js";const pe=x=>(ne("data-v-d448d0ad"),x=x(),se(),x),De={class:"follow-up"},ze=pe(()=>r("div",{class:"title"},"跟进记录",-1)),je={class:"form"},Ae={class:"item"},Me=pe(()=>r("label",null,"跟进状态",-1)),Oe={class:"record"},Ge={class:"list"},Je={class:"p1"},Xe={class:"p2"},Ye=ae({__name:"FollowUp",props:["clueId"],setup(x,{expose:A}){const U=x,I=V(""),b=V(0),d=V(0),S=V(""),M=()=>{le.add({clueId:U.clueId,text:I.value,status:b.value,contactId:d.value,contactName:S.value}).then(v=>{v.code===0?(f.success("跟进记录添加成功"),$()):f.error(v.msg)})},O=V([]),$=()=>{le.getList({clueId:U.clueId}).then(v=>{v.code===0&&(O.value=v.data)})};$();const q=V([]),G=()=>{j.getList({clueId:U.clueId}).then(v=>{v.code===0&&(q.value=v.data)})};return G(),A({getContactList:G}),(v,k)=>{const a=ue,w=re,D=ie,Y=de,F=we;return u(),y("div",De,[ze,r("div",je,[e(a,{type:"textarea",placeholder:"请输入跟进内容",modelValue:I.value,"onUpdate:modelValue":k[0]||(k[0]=m=>I.value=m)},null,8,["modelValue"]),r("div",Ae,[Me,e(D,{modelValue:b.value,"onUpdate:modelValue":k[1]||(k[1]=m=>b.value=m),placeholder:"跟进状态"},{default:l(()=>[e(w,{label:"未跟进",value:0}),e(w,{label:"电话邀约",value:1}),e(w,{label:"客户拜访",value:2}),e(w,{label:"初步方案",value:3}),e(w,{label:"停滞",value:4})]),_:1},8,["modelValue"]),e(D,{modelValue:d.value,"onUpdate:modelValue":k[2]||(k[2]=m=>d.value=m),placeholder:"联系人",onChange:k[3]||(k[3]=m=>{if(m===0)S.value="";else{let N=q.value.find(J=>J.id===m);S.value=N?N.name:""}})},{default:l(()=>[e(w,{label:"联系人",value:0}),(u(!0),y(R,null,H(q.value,m=>(u(),C(w,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(Y,{type:"primary",onClick:M},{default:l(()=>[s("提交")]),_:1})])]),r("div",Oe,[e(F,null,{default:l(()=>[r("ul",Ge,[(u(!0),y(R,null,H(O.value,(m,N)=>(u(),y("li",{key:N,class:"item"},[r("div",Je,[s(p(m.time)+" ",1),r("span",null,p(m.authUser),1),s(),r("span",null,p({0:"无",1:"电话邀约",2:"客户拜访",3:"初步方案",4:"停滞"}[m.status]),1)]),r("div",Xe,"（联系人："+p(m.contact)+"）"+p(m.text),1)]))),128))])]),_:1})])])}}}),Ze=ce(Ye,[["__scopeId","data-v-d448d0ad"]]),K=x=>(ne("data-v-1ce444ac"),x=x(),se(),x),He={class:"clues-info"},Ke={class:"clues-info-header"},Qe={class:"clues-info-header-left"},We={class:"p1"},el={class:"p2"},ll={key:0},tl={key:1},ol={class:"clues-info-header-right"},al={class:"clues-info-content"},nl={class:"clues-info-left"},sl={style:{}},il={class:"title-bar"},rl=K(()=>r("label",{for:""},"公司信息",-1)),dl={key:0},ul={key:1},cl={key:2},pl=K(()=>r("p",{style:{padding:"10px 0"}},"展位订单",-1)),ml=K(()=>r("p",{style:{padding:"10px 0","margin-top":"10px"}},"物料订单",-1)),fl={class:"clues-info-right"},_l=ae({__name:"CluesInfo",setup(x){const A=ye(),U=he(),I=U.query.type,b=U.query.id;U.query.exhibitionId;const d=V({customField:[],orderPosition:[],orderMaterial:[],contract:[]}),S=V([]),M=()=>{Be().then(n=>{n.code===0&&(S.value=n.data)})},O=be(()=>{let n=[];for(let o in d.value.customFieldTrans){let g=d.value.customFieldTrans[o],h=S.value.find(c=>c.key===o);n.push({key:o,value:g,type:h?h.type:1,name:h?h.name:""})}return n}),$=()=>{Ue({id:b}).then(n=>{n.code===0&&(d.value=n.data)})},q=()=>{P.confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Se({id:[b]}).then(n=>{n.code===0?(f.success("删除成功"),setTimeout(()=>{A.go(-1)},1e3)):f.error(n.msg)})}).catch(()=>{console.log("cancel")})},G=()=>{console.log(d.value.isNew),Ne({id:b,status:d.value.isNew}).then(n=>{n.code===0?f.success("修改成功"):f.error(n.msg)})},v=()=>{j.getList({clueId:b}).then(n=>{n.code===0&&(a.list=n.data)})},k=V(null),a=ee({show:!1,isEdit:!1,list:[],form:{clueId:b,name:"",duties:"",type:0,mobile:"",tel:"",email:"",wechat:"",status:1,isExhibitionContact:1},setAdd:()=>{a.show=!0,a.isEdit=!1,a.form={clueId:b,name:"",duties:"",type:0,mobile:"",tel:"",email:"",wechat:"",status:1,isExhibitionContact:1}},setEdit:n=>{a.show=!0,a.isEdit=!0,a.form=n,a.form.clueId=b},add:()=>{k.value.validate().then(n=>{if(!n)return!1;j.add(a.form).then(o=>{o.code===0?(f.success("添加成功"),a.show=!1,v(),w.value.getContactList()):f.error(o.msg)})}).catch(()=>{})},edit:()=>{k.value.validate().then(n=>{if(!n)return!1;j.edit(a.form).then(o=>{o.code===0?(f.success("修改成功"),a.show=!1,v(),w.value.getContactList()):(f.error(o.msg),v())})}).catch(()=>{})},del:n=>{P.confirm("确定删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{j.del({id:n}).then(o=>{o.code===0?(f.success("删除成功"),v(),w.value.getContactList()):f.error(o.msg)})})}}),w=V(null),D=V(null),Y=()=>{P.confirm("确定退展？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Re({id:b}).then(n=>{n.code===0?(f.success("退展成功"),setTimeout(()=>{A.go(-1)},1e3)):f.error(n.msg)})})},F=ee({activeName:1,change:n=>{F.activeName=n,n===1&&(M(),v()),$()}}),m=(n,o)=>{P.confirm("是否确认要撤销订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let g=te.revoke;o===2&&(g=oe.revoke),g({id:n}).then(h=>{h.code===0?(f.success("撤销成功"),$()):f.error(h.msg)})}).catch(()=>{})},N=(n,o)=>{P.confirm("是否确认要删除订单?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let g=te.del;o===2&&(g=oe.del),g({id:n}).then(h=>{h.code===0?(f.success("删除成功"),$()):f.error(h.msg)})}).catch(()=>{})},J=V(null),me=n=>{J.value.getDetail(n)},fe=n=>{P.confirm("是否确认要撤销合同?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Pe.revoke({orderId:n}).then(o=>{o.code===0?(f.success("撤销成功"),$()):f.error(o.msg)})}).catch(()=>{})};return $(),M(),v(),(n,o)=>{const g=Te,h=$e,c=de,_=Ve,i=Ee,X=Ie,Q=xe,Z=Ce,_e=ge,L=ue,B=re,W=ie,ve=ke;return u(),y(R,null,[r("div",He,[r("div",Ke,[r("div",Qe,[r("div",We,p(d.value.companyName),1),r("div",el,[T(I)==="2"?(u(),y("span",ll,"所属展商："+p(d.value.companyName),1)):z("",!0),T(I)==="2"?(u(),y("span",tl,[s("新展商： "),e(h,{"model-value":d.value.isNew,"onUpdate:modelValue":o[0]||(o[0]=t=>d.value.isNew=t),onChange:G},{default:l(()=>[e(g,{value:!0,style:{"margin-right":"10px"}},{default:l(()=>[s("是")]),_:1}),e(g,{value:!1},{default:l(()=>[s("否")]),_:1})]),_:1},8,["model-value"])])):z("",!0),r("span",null,"客户经理："+p(d.value.authUser),1)])]),r("div",ol,[T(I)==="2"?(u(),y(R,{key:0},[d.value.isExit?(u(),C(c,{key:0,type:"info",size:"small",plain:"",disabled:""},{default:l(()=>[s("已退展")]),_:1})):(u(),C(c,{key:1,type:"primary",size:"small",onClick:Y},{default:l(()=>[s("退展")]),_:1}))],64)):z("",!0),e(c,{type:"primary",size:"small",onClick:o[1]||(o[1]=()=>{D.value.setMove([T(b)])})},{default:l(()=>[s("转他人")]),_:1})])]),r("div",al,[r("div",nl,[e(_e,{modelValue:F.activeName,"onUpdate:modelValue":o[3]||(o[3]=t=>F.activeName=t),onTabChange:F.change,type:"border-card",class:"demo-tabs",style:{height:"100%"}},{default:l(()=>[e(Z,{label:"资料",name:1},{default:l(()=>[r("div",sl,[e(Q,{ref_key:"form",ref:d,"label-width":"auto","label-position":"left"},{default:l(()=>[r("div",il,[rl,e(c,{type:"default",onClick:o[2]||(o[2]=t=>n.$router.push({name:"CluesEdit",query:{id:T(b)}})),size:"small"},{default:l(()=>[s("编辑")]),_:1}),e(c,{type:"default",onClick:q,size:"small"},{default:l(()=>[s("删除")]),_:1})]),e(_,{label:"企业名称"},{default:l(()=>[r("span",null,p(d.value.companyName),1)]),_:1}),e(_,{label:"联系人"},{default:l(()=>[r("span",null,p(d.value.contactName),1)]),_:1}),e(_,{label:"国家"},{default:l(()=>[r("span",null,p(d.value.country),1)]),_:1}),e(_,{label:"省份"},{default:l(()=>[r("span",null,p(d.value.province),1)]),_:1}),e(_,{label:"城市"},{default:l(()=>[r("span",null,p(d.value.city),1)]),_:1}),e(_,{label:"详细地址",prop:"address"},{default:l(()=>[r("span",null,p(d.value.address),1)]),_:1}),e(_,{label:"企业品牌",prop:""},{default:l(()=>[r("span",null,p(d.value.companyBrand&&d.value.companyBrand.length>0?d.value.companyBrand.join(","):""),1)]),_:1}),(u(!0),y(R,null,H(O.value,(t,E)=>(u(),C(_,{key:t.key,label:t.name},{default:l(()=>[t.type===5?(u(),y("span",dl,p(t.value instanceof Array?t.value.join("，"):t.value),1)):t.type===7?(u(),y("span",ul,p(t.value instanceof Array?t.value.join("，"):t.value),1)):(u(),y("span",cl,p(t.value),1))]),_:2},1032,["label"]))),128)),e(_,{label:"参展联系人",prop:""},{default:l(()=>[e(c,{size:"small",onClick:a.setAdd},{default:l(()=>[s("添加")]),_:1},8,["onClick"])]),_:1}),e(X,{border:"",data:a.list,"show-overflow-tooltip":"","header-row-class-name":"s-table-header"},{default:l(()=>[e(i,{prop:"name",label:"姓名"}),e(i,{prop:"duties",label:"职务"}),e(i,{prop:"type",label:"类别"},{default:l(t=>[s(p(["无","展位","财务","市场","现场"][t.row.type]),1)]),_:1}),e(i,{prop:"mobile",label:"手机号"}),e(i,{prop:"tel",label:"电话"}),e(i,{prop:"email",label:"邮箱"}),e(i,{prop:"wechat",label:"微信"}),e(i,{prop:"status",label:"在职状态","min-width":"120"},{default:l(t=>[s(p(["","在职","离职","调岗"][t.row.status]),1)]),_:1}),e(i,{prop:"isExhibitionContact",label:"展会联系人"},{default:l(t=>[s(p(t.row.isExhibitionContact===1?"是":"否"),1)]),_:1}),e(i,{label:"操作",fixed:"right",width:"150"},{default:l(t=>[e(c,{link:"",type:"primary",onClick:E=>a.setEdit(t.row)},{default:l(()=>[s("编辑")]),_:2},1032,["onClick"]),e(c,{link:"",type:"danger",onClick:E=>a.del(t.row.id)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},512)])]),_:1}),T(I)==="2"?(u(),C(Z,{key:0,label:"订单",name:2},{default:l(()=>[pl,e(X,{data:d.value.orderPosition,border:"","show-overflow-tooltip":""},{default:l(()=>[e(i,{prop:"orderCode",label:"订单编号","min-width":"120"}),e(i,{prop:"brand",label:"品牌"}),e(i,{prop:"positionCode",label:"展位号"}),e(i,{prop:"price",label:"订单金额","min-width":"120"}),e(i,{label:"操作",width:"150",fixed:"right"},{default:l(t=>[e(c,{link:"",type:"primary",onClick:E=>n.$router.push({name:"OrderBoothDetail",query:{id:t.row.id}})},{default:l(()=>[s("详情")]),_:2},1032,["onClick"]),t.row.orderStatus===1?(u(),C(c,{key:0,link:"",type:"primary",onClick:E=>m(t.row.id,1)},{default:l(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),y(R,{key:1},[e(c,{link:"",type:"info",disabled:""},{default:l(()=>[s("已撤销")]),_:1}),e(c,{link:"",type:"danger",onClick:E=>N(t.row.id,1)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"]),ml,e(X,{data:d.value.orderMaterial,border:"","show-overflow-tooltip":""},{default:l(()=>[e(i,{prop:"orderCode",label:"订单编号","min-width":"120"}),e(i,{prop:"positionCode",label:"展位号"}),e(i,{prop:"price",label:"订单金额","min-width":"120"}),e(i,{label:"操作",width:"150",fixed:"right"},{default:l(t=>[e(c,{link:"",type:"primary",onClick:E=>me(t.row.id)},{default:l(()=>[s("详情")]),_:2},1032,["onClick"]),t.row.orderStatus===1?(u(),C(c,{key:0,link:"",type:"primary",onClick:E=>m(t.row.id,2)},{default:l(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),y(R,{key:1},[e(c,{link:"",type:"info",disabled:""},{default:l(()=>[s("已撤销")]),_:1}),e(c,{link:"",type:"danger",onClick:E=>N(t.row.id,2)},{default:l(()=>[s("删除")]),_:2},1032,["onClick"])],64))]),_:1})]),_:1},8,["data"])]),_:1})):z("",!0),T(I)==="2"?(u(),C(Z,{key:1,label:"合同",name:3},{default:l(()=>[e(X,{data:d.value.contract,border:"","show-overflow-tooltip":""},{default:l(()=>[e(i,{prop:"contractCode",label:"合同编号","min-width":"120"}),e(i,{prop:"contractType",label:"合同类型","min-width":"120"},{default:l(t=>[s(p({1:"展位合同",2:"物料合同",3:"展位+物料"}[t.row.contractType]),1)]),_:1}),e(i,{prop:"contractAmount",label:"合同金额","min-width":"120"}),e(i,{prop:"deposit",label:"预定金"}),e(i,{prop:"",label:"抵扣"}),e(i,{prop:"firstPayPrice",label:"一期款"}),e(i,{prop:"firstPayTime",label:"期限"}),e(i,{prop:"finalPayPrice",label:"尾款"}),e(i,{prop:"finalPayTime",label:"期限"}),e(i,{prop:"receivedPrice",label:"已收款"}),e(i,{prop:"unknownPrice",label:"未收款"}),e(i,{prop:"contractStatus",label:"合同状态","min-width":"120"},{default:l(t=>[s(p({0:"撤销",1:"已完成"}[t.row.contractStatus]),1)]),_:1}),e(i,{label:"操作",width:"200",fixed:"right"},{default:l(t=>[e(c,{link:"",type:"primary",onClick:E=>n.$router.push({name:"ContractDetail",query:{orderId:t.row.orderId}})},{default:l(()=>[s("详情")]),_:2},1032,["onClick"]),t.row.contractStatus===1?(u(),C(c,{key:0,link:"",type:"primary",onClick:E=>fe(t.row.orderId)},{default:l(()=>[s("撤销")]),_:2},1032,["onClick"])):(u(),C(c,{key:1,link:"",type:"info",disabled:""},{default:l(()=>[s("已撤销")]),_:1}))]),_:1})]),_:1},8,["data"])]),_:1})):z("",!0)]),_:1},8,["modelValue","onTabChange"])]),r("div",fl,[e(Ze,{ref_key:"followUp",ref:w,clueId:T(b)},null,8,["clueId"])])])]),e(ve,{title:a.isEdit?"编辑":"添加联系人",modelValue:a.show,"onUpdate:modelValue":o[16]||(o[16]=t=>a.show=t),width:"500px",draggable:""},{footer:l(()=>[e(c,{type:"default",onClick:o[13]||(o[13]=t=>a.show=!1)},{default:l(()=>[s("取消")]),_:1}),a.isEdit?(u(),C(c,{key:0,type:"primary",onClick:o[14]||(o[14]=()=>a.edit())},{default:l(()=>[s("修改")]),_:1})):(u(),C(c,{key:1,type:"primary",onClick:o[15]||(o[15]=()=>a.add())},{default:l(()=>[s("添加")]),_:1}))]),default:l(()=>[e(Q,{ref_key:"lxrRef",ref:k,model:a.form,"label-width":"auto","label-position":"left"},{default:l(()=>[e(_,{label:"姓名",prop:"name",rules:[{required:!0,message:"请输入姓名"}]},{default:l(()=>[e(L,{modelValue:a.form.name,"onUpdate:modelValue":o[4]||(o[4]=t=>a.form.name=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"职务",prop:"duties",rules:[{required:!0,message:"请输入职务"}]},{default:l(()=>[e(L,{modelValue:a.form.duties,"onUpdate:modelValue":o[5]||(o[5]=t=>a.form.duties=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"类别"},{default:l(()=>[e(W,{modelValue:a.form.type,"onUpdate:modelValue":o[6]||(o[6]=t=>a.form.type=t)},{default:l(()=>[e(B,{label:"无",value:0}),e(B,{label:"展位",value:1}),e(B,{label:"财务",value:2}),e(B,{label:"市场",value:3}),e(B,{label:"现场",value:4})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"手机号",prop:"mobile",rules:T(qe).phone},{default:l(()=>[e(L,{modelValue:a.form.mobile,"onUpdate:modelValue":o[7]||(o[7]=t=>a.form.mobile=t)},null,8,["modelValue"])]),_:1},8,["rules"]),e(_,{label:"电话"},{default:l(()=>[e(L,{modelValue:a.form.tel,"onUpdate:modelValue":o[8]||(o[8]=t=>a.form.tel=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"邮箱"},{default:l(()=>[e(L,{modelValue:a.form.email,"onUpdate:modelValue":o[9]||(o[9]=t=>a.form.email=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"微信"},{default:l(()=>[e(L,{modelValue:a.form.wechat,"onUpdate:modelValue":o[10]||(o[10]=t=>a.form.wechat=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"在职状态",prop:"status",rules:[{required:!0,message:"请选择在职状态"}]},{default:l(()=>[e(W,{modelValue:a.form.status,"onUpdate:modelValue":o[11]||(o[11]=t=>a.form.status=t)},{default:l(()=>[e(B,{label:"在职",value:1}),e(B,{label:"离职",value:2}),e(B,{label:"调岗",value:3})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"展会联系人",prop:"isExhibitionContact",rules:[{required:!0,message:"请选择展会联系人"}]},{default:l(()=>[e(h,{modelValue:a.form.isExhibitionContact,"onUpdate:modelValue":o[12]||(o[12]=t=>a.form.isExhibitionContact=t),class:"ml-4"},{default:l(()=>[e(g,{value:1},{default:l(()=>[s("是")]),_:1}),e(g,{value:0},{default:l(()=>[s("否")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(Fe,{ref_key:"moveRef",ref:D,onCallback:$},null,512),e(Le,{ref_key:"detailRef",ref:J},null,512)],64)}}}),ot=ce(_l,[["__scopeId","data-v-1ce444ac"]]);export{ot as default};
