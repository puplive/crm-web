import{d as Pe,t as m,y as Q,c as ee,z as oe,b as h,X as c,Z as k,$ as o,i as l,J as g,a5 as Ve,am as we,W as le,o as p,Y as f,a1 as w,h as y,e as I,ak as Ce,G as Ee,a2 as xe,a3 as Ne}from"./index-BNkqEfoU.js";import{E as ke}from"./dialog-Z78uJnLH.js";/* empty css                */import{E as Ie}from"./col-DGLz2LHQ.js";import{E as Ue}from"./scrollbar-Cht2dskf.js";import{a as Fe,E as qe}from"./form-item-O0FrXFJW.js";/* empty css              */import{E as Se}from"./input-number-BipWg8WS.js";import{E as Be}from"./button-C0aLSh8R.js";/* empty css                      */import"./popper-C8CX-T0n.js";import"./tag-xRCCyOex.js";import{E as Oe,a as Re}from"./select-C-mo98Vu.js";/* empty css                    */import{E as De,a as $e}from"./radio-BWirGVb2.js";import{E as Je}from"./image-viewer-w3MdeC_W.js";import{a as ze}from"./index-PjUlzoVp.js";import{h as Ge,p as Le}from"./index-D3LxmoTP.js";import{_ as U}from"./rules-F8IXRWD9.js";import{E as Te}from"./index-BuLTirWP.js";import{E as Ae,a as je,b as He}from"./index-kSBkZP7z.js";import{_ as Me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DT1b9Vs-.js";import"./use-form-item-B2e8hH_L.js";import"./scroll-Dq_ED7dH.js";import"./vnode-ooUzQUNj.js";import"./focus-trap-DVaSfSrk.js";import"./refs-CAsDqbpf.js";import"./event-BB_Ol6Sd.js";import"./castArray-WJLM_QfY.js";import"./_baseClone-D_XquCZ4.js";import"./_initCloneObject-CQCbbkYz.js";import"./index-DHYXQXaz.js";import"./isEqual-aN3fHMqT.js";const We=F=>(xe("data-v-1aa2819e"),F=F(),Ne(),F),Xe={class:"booth-reserve"},Ye={class:"l"},Ze={class:"title"},Ke={class:"img-box"},Qe={class:"r"},eo={class:"form-box"},oo=We(()=>c("div",null,"预定展位",-1)),lo={key:1,style:{width:"270px","text-align":"center",padding:"10px"}},to={style:{"text-align":"center"}},ao={style:{padding:"15px"}},io={class:"dialog-footer"},no=Pe({__name:"Reserve",setup(F){const te=Ve(),v=we(),z=v.query.clueId,q=v.query.exhibitionId,G=v.query.exhibitorId,P=m(v.query.hallCode),B=m([]),E=m([]),L=m([]),T=m([]),A=m([]),j=m([]),H={1:"%",2:"￥"},t=Q({clueId:z,exhibitionId:q,exhibitorId:G,add:[],discount:[],position:[{hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});if(v.query.data&&typeof v.query.data=="string"){let n=JSON.parse(v.query.data);t.clueId=n.clueId,t.exhibitionId=n.exhibitionId,t.exhibitorId=n.exhibitorId,t.position=n.position,t.add=n.add,t.discount=n.discount}m({});const O=m(null),a=Q({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ae=n=>{a.form.unitPrice=Number(n.price),a.form.product=n.text,a.form.num=n.num},ie=ee(()=>a.form.unitPrice?a.form.unitPrice+"元/"+(a.form.num===1?"":a.form.num)+"㎡":""),ne=(n,e,s)=>{e.length===""||a.form.width===""?s(new Error("请填写尺寸")):e.length<=0||a.form.width<=0?s(new Error("尺寸不可为0和负数")):s()},re=()=>{let n=t.position.length;R(P.value,n),t.position.push({hallCode:P.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},R=(n,e)=>{E.value[e]=[],Ge({exhibitionId:q,hallCode:n}).then(s=>{E.value[e]=s.data})};R(P.value,0);const de=(n,e,s,i)=>{if(!e)return s(new Error("必填项"));Le({exhibitionId:q,exhibitorId:G,hallCode:i,positionCode:e}).then(_=>{_.code===0&&_.data.status?s():s(new Error("该展位已锁定"))})},D=m(null),ue=()=>{D.value.validate().then(n=>{n&&te.push({name:"BoothCreateOrder",query:{...v.query,companyName:S.value,data:JSON.stringify(t)}})}).catch(()=>{})},se=n=>{a.index=n,a.form.product="",a.form.unitPrice="",a.form.length="",a.form.width="",a.form.num=1,a.show=!0},pe=()=>{O.value.validate().then(n=>{if(!n)return;a.show=!1;let e=a.form.length*a.form.width,s=e*a.form.unitPrice/a.form.num,i=M(s),_=W(s);t.position[a.index].product=a.form.product,t.position[a.index].unitPrice=a.form.unitPrice,t.position[a.index].length=a.form.length,t.position[a.index].width=a.form.width,t.position[a.index].area=e,t.position[a.index].costPrice=Number(s.toFixed(2)),t.position[a.index].addPrice=Number(i.toFixed(2)),t.position[a.index].discountPrice=Number(_.toFixed(2)),t.position[a.index].finalPrice=Number((s+i-_).toFixed(2)),D.value.clearValidate(["position["+a.index+"].product"])}).catch(()=>{})},M=n=>{let e=0;return t.add.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=n*i.price/100:i.unit===2&&(e+=i.price)}),e},W=n=>{let e=0;return t.discount.forEach(s=>{let i=JSON.parse(s);i.unit===1?e+=n*i.price/100:i.unit===2&&(e+=i.price)}),e};oe(()=>t.add,n=>{t.position.forEach(e=>{e.addPrice=Number(M(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),oe(()=>t.discount,n=>{t.position.forEach(e=>{e.discountPrice=Number(W(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const S=m(""),$=m(!0);ze({clueId:z,exhibitionId:q}).then(n=>{let e=n.data;L.value=e.attachPrice.add,T.value=e.attachPrice.discount,A.value=e.companyBrand,j.value=e.unitPrice,B.value=e.exhibitionHall,S.value=e.companyName,$.value=e.isNew});const X=ee(()=>{let n=B.value.find(e=>e.code===P.value);return n?n.img:""});return(n,e)=>{const s=Je,i=Fe,_=De,Y=$e,x=Oe,N=Re,C=Be,b=Te,ce=Ae,me=je,fe=He,_e=Se,he=le("DeleteFilled"),Z=Ee,K=qe,ve=Ue,J=Ie,be=le("Close"),ge=ke;return p(),h(g,null,[c("div",Xe,[c("div",Ye,[c("div",Ze,[c("span",null,k(S.value),1),c("span",null,"展馆号："+k(P.value),1)]),c("div",Ke,[o(s,{style:{width:"100%",height:"100%"},src:X.value,"preview-src-list":[X.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",Qe,[c("div",eo,[o(ve,{height:"100%"},{default:l(()=>[o(K,{ref_key:"formRef",ref:D,model:t,"label-width":"auto",class:"form","label-position":"left"},{default:l(()=>[oo,o(i,{label:"企业名称"},{default:l(()=>[f(k(S.value),1)]),_:1}),o(i,{label:"新展商"},{default:l(()=>[o(Y,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=d=>$.value=d),disabled:""},{default:l(()=>[o(_,{value:!0},{default:l(()=>[f("是")]),_:1}),o(_,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"加收"},{default:l(()=>[o(N,{modelValue:t.add,"onUpdate:modelValue":e[1]||(e[1]=d=>t.add=d),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(L.value,(d,r)=>(p(),y(x,{key:r,label:d.text+" "+d.price+H[d.unit],value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣"},{default:l(()=>[o(N,{modelValue:t.discount,"onUpdate:modelValue":e[2]||(e[2]=d=>t.discount=d),multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(T.value,(d,r)=>(p(),y(x,{key:r,label:d.text+" "+d.price+H[d.unit],value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:re},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(p(!0),h(g,null,w(t.position,(d,r)=>(p(),h("div",{class:"item",key:r},[o(i,{label:"展馆号",prop:`position[${r}].hallCode`,rules:I(U).required},{default:l(()=>[o(N,{modelValue:t.position[r].hallCode,"onUpdate:modelValue":u=>t.position[r].hallCode=u,placeholder:"请选择",onChange:()=>{R(d.hallCode,r),P.value=d.hallCode}},{default:l(()=>[(p(!0),h(g,null,w(B.value,(u,V)=>(p(),y(x,{key:V,label:u.code,value:u.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop","rules"]),o(i,{label:"展位号",prop:`position[${r}].positionCode`,rules:[...I(U).required,{validator:(u,V,ye)=>de(u,V,ye,t.position[r].hallCode),trigger:"change"}]},{default:l(()=>[o(fe,{trigger:"click",style:{width:"100%"},"max-height":"300px",onCommand:u=>{t.position[r].positionCode=u}},{dropdown:l(()=>[E.value[r].length?(p(),y(me,{key:0},{default:l(()=>[(p(!0),h(g,null,w(E.value[r],(u,V)=>(p(),y(ce,{key:V,style:{width:"270px"},command:u},{default:l(()=>[f(k(u),1)]),_:2},1032,["command"]))),128))]),_:2},1024)):(p(),h("div",lo,"无数据"))]),default:l(()=>[o(b,{modelValue:t.position[r].positionCode,"onUpdate:modelValue":u=>t.position[r].positionCode=u,autocomplete:"off","suffix-icon":"ArrowDown"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["onCommand"])]),_:2},1032,["prop","rules"]),o(i,{label:"品牌"},{default:l(()=>[o(N,{modelValue:t.position[r].companyBrand,"onUpdate:modelValue":u=>t.position[r].companyBrand=u,multiple:"",placeholder:"请选择"},{default:l(()=>[(p(!0),h(g,null,w(A.value,(u,V)=>(p(),y(x,{key:V,label:u,value:u},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位类型"},{default:l(()=>[o(Y,{modelValue:t.position[r].type,"onUpdate:modelValue":u=>t.position[r].type=u},{default:l(()=>[o(_,{value:1},{default:l(()=>[f("标准")]),_:1}),o(_,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"展位规格",prop:`position[${r}].product`,rules:I(U).required},{default:l(()=>[o(C,{size:"small",onClick:u=>se(r)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1032,["prop","rules"]),t.position[r].product?(p(),y(i,{key:0,label:" "},{default:l(()=>[c("div",null,k(t.position[r].product+" "+t.position[r].area+"㎡"),1)]),_:2},1024)):Ce("",!0),o(i,{label:"展位原价"},{default:l(()=>[o(b,{modelValue:t.position[r].costPrice,"onUpdate:modelValue":u=>t.position[r].costPrice=u,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(i,{label:"加收金额"},{default:l(()=>[o(b,{"model-value":t.position[r].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"折扣金额"},{default:l(()=>[o(b,{"model-value":t.position[r].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(i,{label:"最终金额",prop:`position[${r}].finalPrice`,rules:I(U).required},{default:l(()=>[o(_e,{modelValue:t.position[r].finalPrice,"onUpdate:modelValue":u=>t.position[r].finalPrice=u,min:0,controls:!1,class:"s-number-input"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"]),c("div",to,[o(C,{link:"",type:"danger",onClick:u=>{t.position.splice(r,1),E.value.splice(r,1)}},{default:l(()=>[o(Z,null,{default:l(()=>[o(he)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",ao,[o(C,{type:"primary",onClick:ue,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(ge,{modelValue:a.show,"onUpdate:modelValue":e[7]||(e[7]=d=>a.show=d),title:"添加规格",width:"500",draggable:"",onClose:e[8]||(e[8]=()=>{O.value.resetFields()})},{footer:l(()=>[c("div",io,[o(C,{onClick:e[6]||(e[6]=d=>a.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:pe},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(K,{ref_key:"ggFormRef",ref:O,model:a.form,"label-width":"auto","label-position":"left"},{default:l(()=>[o(i,{label:"产品名称",prop:"product",rules:I(U).required},{default:l(()=>[o(N,{modelValue:a.form.product,"onUpdate:modelValue":e[3]||(e[3]=d=>a.form.product=d),placeholder:"",onChange:ae},{default:l(()=>[(p(!0),h(g,null,w(j.value,d=>(p(),y(x,{key:d.id,label:d.text+" "+d.price+"/"+d.num+"/㎡",value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["rules"]),o(i,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(b,{"model-value":ie.value,disabled:""},null,8,["model-value"])]),_:1}),o(i,{label:"尺寸",prop:"length",required:"",rules:[{validator:ne,trigger:"blur"}]},{default:l(()=>[o(J,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.length,"onUpdate:modelValue":e[4]||(e[4]=d=>a.form.length=d),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"长： 例如3"},null,8,["modelValue"])]),_:1})]),_:1}),o(J,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(Z,null,{default:l(()=>[o(be)]),_:1})]),_:1}),o(J,{span:11},{default:l(()=>[o(i,{label:""},{default:l(()=>[o(b,{type:"number",modelValue:a.form.width,"onUpdate:modelValue":e[5]||(e[5]=d=>a.form.width=d),style:{flex:"1"},"input-style":"text-align: center;",placeholder:"宽： 例如3"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["rules"]),o(i,{label:"面积"},{default:l(()=>[o(b,{"model-value":Number((a.form.length*a.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Lo=Me(no,[["__scopeId","data-v-1aa2819e"]]);export{Lo as default};
