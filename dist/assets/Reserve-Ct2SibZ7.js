import{d as ie,l as i,s as ne,t as N,c as de,b as v,O as o,R as t,i as s,F as x,U as y,P as h,Q as C,W as ue,a5 as re,o as n,h as B,n as ce,X as pe,Y as ve}from"./index-Dq6rVDqy.js";/* empty css                 */import{E as me,a as _e}from"./el-table-column-BengnAmV.js";import"./el-checkbox-D7Sj22Qv.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-BYln7j3_.js";import{E as he}from"./el-scrollbar-CmJEL3k0.js";import{E as be}from"./el-input-number-fsBCNoD0.js";import"./el-tag-D_RbI-aO.js";/* empty css                  */import{E as fe}from"./el-image-viewer-DVxRrTEX.js";import{a as ge,E as Ce}from"./el-form-item-BCtkdkXS.js";import{E as xe,a as ye}from"./el-select-DV42nEQ9.js";import{c as b}from"./request-CY8mjEUJ.js";import{g as Ie,c as I}from"./index-CRJpfIOv.js";import{e as we}from"./index-X-ozfK4R.js";import{g as Ee}from"./index-D0qn-n3n.js";import{g as Ve}from"./index-By7cBnvV.js";/* empty css                   */import{E as ke}from"./index-DxL-bode.js";import{E as ze}from"./index-ChvCN2rV.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-form-item-BA4TQU29.js";import"./_initCloneObject-DHqfe5ka.js";import"./isArrayLikeObject-BQHP5C3w.js";import"./event-BB_Ol6Sd.js";import"./isEqual-D3d5L5fz.js";import"./index-CvKXdF-7.js";import"./scroll-CRrDqPcp.js";import"./castArray-BWFiwkNr.js";import"./_baseClone-D0Q4sOpU.js";const L=z=>(pe("data-v-de91bc76"),z=z(),ve(),z),Ue={class:"goods-reserve"},qe={class:"s-top_bar"},Ne={class:"row"},Be={class:"col col1"},Re={class:"goods-type"},je=["onClick"],Fe={class:"col col2"},Le={class:"goods-list"},Me={class:"msg"},Te=["title"],Ze=["title"],De=L(()=>o("label",{for:""},"规格(尺寸)：",-1)),$e=["title"],Oe=L(()=>o("label",{for:""},"单  价：",-1)),Pe={class:"p"},He=L(()=>o("label",{for:""},"库  存：",-1)),Qe={class:"col col3"},We={class:"table"},Xe={class:"bottom-bar"},Ye={class:"p1"},Ae={class:"p2"},Ge=ie({__name:"Reserve",setup(z){const P=ue(),f=re(),d=i(f.query.exhibitionId?Number(f.query.exhibitionId):""),m=i(f.query.exhibitorId?Number(f.query.exhibitorId):""),u=i(f.query.hallCode||""),r=i(f.query.positionCode||""),H=f.query.clueId,S=i(0),w=i([]),E=i({}),g=i([]),M=i([]),T=i([]),Z=i([]),R=i([]);ne({});const Q=(l,a=1)=>{I.addCart({exhibitorId:m.value,exhibitionId:d.value,hallCode:u.value,positionCode:r.value,id:l.id,num:a}).then(c=>{c.code===0?(b.success("添加成功"),_()):b.error(c.msg)})},W=(l,a=1)=>{I.editCart({exhibitorId:m.value,exhibitionId:d.value,hallCode:u.value,positionCode:r.value,id:l.id,num:a}).then(c=>{c.code===0?b.success("成功"):b.error(c.msg),_()})},X=l=>{I.delCart({exhibitorId:m.value,exhibitionId:d.value,hallCode:u.value,positionCode:r.value,id:l.id,num:l.num}).then(a=>{a.code===0?(b.success("删除成功"),_()):b.error(a.msg)})},Y=l=>{E.value=w.value[l]},A=()=>{we().then(l=>{l.code===0&&(M.value=l.data)})},G=()=>{Ee().then(l=>{l.code===0&&(T.value=l.data)})},D=()=>{Ie({exhibitionId:d.value}).then(l=>{l.code===0&&(Z.value=l.data)})},j=()=>{R.value=[],Ve({exhibitionId:d.value,hallCode:u.value}).then(l=>{l.code===0&&(R.value=l.data)})},$=()=>{I.getMaterial({exhibitionId:d.value}).then(l=>{l.code===0&&(w.value=l.data,w.value.length>0?E.value=w.value[0]:E.value={})})},_=()=>{if(!d.value||!u.value||!r.value){g.value=[];return}I.getCart({exhibitorId:m.value,exhibitionId:d.value,hallCode:u.value,positionCode:r.value}).then(l=>{l.code===0&&(g.value=l.data)})},U=i(!1),J=()=>{U.value=!0,I.create({clueId:H,exhibitionId:d.value,exhibitorId:m.value,hallCode:u.value,positionCode:r.value,price:S.value,data:g.value.map(l=>({...l,remark:""}))}).then(l=>{l.code===0?(b.success("提交成功"),P.go(-1)):b.error(l.msg),U.value=!1}).catch(l=>{U.value=!1})};N(()=>d.value,l=>{u.value="",r.value="",D(),j(),$(),_()}),N(()=>m.value,l=>{_()}),N(()=>u.value,l=>{r.value="",j(),_()}),N(()=>r.value,l=>{_()});const K=de(()=>{let l=0;return g.value.forEach(a=>{l+=a.price*a.num}),S.value=l,l});return A(),G(),D(),j(),$(),_(),(l,a)=>{const c=xe,q=ye,V=ge,ee=Ce,le=fe,F=ke,oe=he,k=_e,te=be,ae=me,se=ze;return n(),v("div",Ue,[o("div",qe,[t(ee,{inline:!0},{default:s(()=>[t(V,{label:"展会名称",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"请选择展会名称",disabled:""},{default:s(()=>[(n(!0),v(x,null,y(M.value,e=>(n(),B(c,{key:e.id,label:e.exhibitionName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"参展企业",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),placeholder:"请选择参展企业",disabled:""},{default:s(()=>[(n(!0),v(x,null,y(T.value,e=>(n(),B(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"展馆",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),placeholder:"请选择展馆"},{default:s(()=>[(n(!0),v(x,null,y(Z.value,e=>(n(),B(c,{key:e.code,label:e.code,value:e.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"展位号",style:{width:"220px"}},{default:s(()=>[t(q,{modelValue:r.value,"onUpdate:modelValue":a[3]||(a[3]=e=>r.value=e),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"添加展位号",style:{width:"240px"}},{default:s(()=>[(n(!0),v(x,null,y(R.value,e=>(n(),B(c,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),o("div",Ne,[o("div",Be,[o("ul",Re,[(n(!0),v(x,null,y(w.value,(e,p)=>(n(),v("li",{key:p,onClick:O=>Y(p),class:ce({active:e.project===E.value.project})},C(e.project),11,je))),128))])]),o("div",Fe,[t(oe,null,{default:s(()=>[o("div",Le,[(n(!0),v(x,null,y(E.value.data,(e,p)=>(n(),v("li",{key:p},[t(le,{style:{width:"100%",height:"200px"},src:e.img,"preview-src-list":[e.img],fit:"contain"},null,8,["src","preview-src-list"]),o("div",Me,[o("p",{class:"title",title:e.position},C(e.position),9,Te),o("p",{class:"p",title:e.size},[De,h(C(e.size),1)],8,Ze),o("p",{class:"p",title:e.price+"元/"+e.unit},[Oe,o("span",null,C(e.price+"元/"+e.unit),1)],8,$e),o("p",Pe,[He,h(C(e.num),1)])]),t(F,{type:"primary",onClick:O=>Q(e),disabled:e.num<=0,style:{width:"100%"}},{default:s(()=>[h("加入购物车")]),_:2},1032,["onClick","disabled"])]))),128))])]),_:1})]),o("div",Qe,[o("div",We,[t(ae,{data:g.value,border:""},{default:s(()=>[t(k,{label:"服务项目",prop:"project","min-width":"120"}),t(k,{label:"位置/版面",prop:"position","min-width":"120"}),t(k,{label:"规格",prop:"size"}),t(k,{label:"单价(RMB)",prop:"price","min-width":"120"}),t(k,{label:"数量",width:"200px"},{default:s(e=>[t(te,{modelValue:e.row.num,"onUpdate:modelValue":p=>e.row.num=p,min:1,size:"small",onChange:(p,O)=>{W(e.row,p)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),t(F,{type:"danger",link:"",onClick:p=>X(e.row),style:{"margin-left":"10px"},icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),o("div",Xe,[o("div",Ye,[o("span",null,[h("已选物料 "),o("b",null,C(g.value.length),1),h(" 项")]),h(),o("span",null,[h("物料金额 "),o("b",null,"¥"+C(K.value),1)])]),o("div",Ae,[t(V,{label:"最终金额",style:{width:"100%","margin-bottom":"0"}},{default:s(()=>[t(se,{modelValue:S.value,"onUpdate:modelValue":a[4]||(a[4]=e=>S.value=e)},null,8,["modelValue"])]),_:1})]),t(F,{type:"primary",style:{width:"100%"},onClick:J,loading:U.value,disabled:g.value.length<=0},{default:s(()=>[h("提交")]),_:1},8,["loading","disabled"])])])])])}}}),Sl=Se(Ge,[["__scopeId","data-v-de91bc76"]]);export{Sl as default};
