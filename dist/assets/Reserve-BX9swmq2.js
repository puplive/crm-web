import{j as Ee,a2 as xe,aa as F,L as X,d as me,a4 as Se,u as ke,l as y,s as Ne,e as $,ae as ne,v as Y,y as Fe,af as Pe,o as m,f as V,C as fe,a as s,n as ie,a5 as se,r as _e,W as he,S as r,a8 as pe,B as ze,w as f,c as B,p as Ae,ag as Be,ah as Te,ai as De,h as Ue,O as $e,P as c,F as K,V as j,Q as S,R as U,Z as Le,a7 as Me,_ as qe,$ as Oe}from"./index-Q273XHf8.js";import"./el-input-Dg3qt5Bb.js";import{E as Re,a as Ke}from"./el-table-column-DSWDUPh9.js";import"./el-checkbox-CUmpTspT.js";import"./el-tooltip-l0sNRNKZ.js";import{a as je}from"./el-scrollbar-0l_cZ0S_.js";import"./el-tag-DqRVPKx1.js";import{C as Ie,I as de,U as J,u as Ze,a as We,b as Ge}from"./el-button-DXeH7ULc.js";import{E as He}from"./el-image-viewer-G1g_jTJ1.js";/* empty css                     *//* empty css                  */import{E as re}from"./request-CQ37sLB9.js";import{a as ue,c as Qe}from"./index-Bar3g9kv.js";import{e as Ye}from"./index-DPQZKfRy.js";import{e as Je}from"./index-CpYqEctc.js";import{b as Xe}from"./index-B1Yzqv3z.js";import"./index-BseM5vZU.js";/* empty css                   */import{E as el,a as ll}from"./index-Bkne1dct.js";import{E as tl,a as al}from"./index-Bvt8dlHX.js";import{E as ol}from"./index-nVic9h1r.js";import{E as we}from"./index-j8eE0ruH.js";import{u as nl,_ as sl,E as ge}from"./index-CRFYaBQA.js";import{u as rl,t as ul,d as ye}from"./constants-D7u2-Egf.js";import{v as Ve}from"./index-mpwgweJ1.js";import{_ as il}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./isArrayLikeObject-BKJ0Asn3.js";import"./typescript-CjU46sqC.js";import"./isEqual-DPHZFWxr.js";import"./scroll-BIoQ-qBU.js";import"./rules-BWEfMqzk.js";import"./index-r5W6hzzQ.js";const dl=Ee({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.POSITIVE_INFINITY},min:{type:Number,default:Number.NEGATIVE_INFINITY},modelValue:Number,readonly:Boolean,disabled:Boolean,size:xe,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:u=>u===null||F(u)||["min","max"].includes(u),default:null},name:String,label:String,placeholder:String,precision:{type:Number,validator:u=>u>=0&&u===Number.parseInt(`${u}`,10)},validateEvent:{type:Boolean,default:!0},...rl(["ariaLabel"])}),cl={[Ie]:(u,L)=>L!==u,blur:u=>u instanceof FocusEvent,focus:u=>u instanceof FocusEvent,[de]:u=>F(u)||X(u),[J]:u=>F(u)||X(u)},pl=["aria-label","onKeydown"],ml=["aria-label","onKeydown"],vl=me({name:"ElInputNumber"}),bl=me({...vl,props:dl,emits:cl,setup(u,{expose:L,emit:_}){const a=u,{t:N}=Se(),v=ke("input-number"),h=y(),d=Ne({currentValue:a.modelValue,userInput:null}),{formItem:I}=Ze(),ee=$(()=>F(a.modelValue)&&a.modelValue<=a.min),P=$(()=>F(a.modelValue)&&a.modelValue>=a.max),T=$(()=>{const e=W(a.step);return ne(a.precision)?Math.max(W(a.modelValue),e):(e>a.precision,a.precision)}),C=$(()=>a.controls&&a.controlsPosition==="right"),Z=We(),z=Ge(),M=$(()=>{if(d.userInput!==null)return d.userInput;let e=d.currentValue;if(X(e))return"";if(F(e)){if(Number.isNaN(e))return"";ne(a.precision)||(e=e.toFixed(a.precision))}return e}),q=(e,l)=>{if(ne(l)&&(l=T.value),l===0)return Math.round(e);let n=String(e);const p=n.indexOf(".");if(p===-1||!n.replace(".","").split("")[p+l])return e;const E=n.length;return n.charAt(E-1)==="5"&&(n=`${n.slice(0,Math.max(0,E-1))}6`),Number.parseFloat(Number(n).toFixed(l))},W=e=>{if(X(e))return 0;const l=e.toString(),n=l.indexOf(".");let p=0;return n!==-1&&(p=l.length-n-1),p},le=(e,l=1)=>F(e)?q(e+a.step*l):d.currentValue,G=()=>{if(a.readonly||z.value||P.value)return;const e=Number(M.value)||0,l=le(e);D(l),_(de,d.currentValue),b()},H=()=>{if(a.readonly||z.value||ee.value)return;const e=Number(M.value)||0,l=le(e,-1);D(l),_(de,d.currentValue),b()},Q=(e,l)=>{const{max:n,min:p,step:i,precision:w,stepStrictly:E,valueOnClear:R}=a;n<p&&ul("InputNumber","min should not be greater than max.");let g=Number(e);if(X(e)||Number.isNaN(g))return null;if(e===""){if(R===null)return null;g=ze(R)?{min:p,max:n}[R]:R}return E&&(g=q(Math.round(g/i)*i,w)),ne(w)||(g=q(g,w)),(g>n||g<p)&&(g=g>n?n:p,l&&_(J,g)),g},D=(e,l=!0)=>{var n;const p=d.currentValue,i=Q(e);if(!l){_(J,i);return}p===i&&e||(d.userInput=null,_(J,i),p!==i&&_(Ie,i,p),a.validateEvent&&((n=I==null?void 0:I.validate)==null||n.call(I,"change").catch(w=>ye())),d.currentValue=i)},te=e=>{d.userInput=e;const l=e===""?null:Number(e);_(de,l),D(l,!1)},A=e=>{const l=e!==""?Number(e):"";(F(l)&&!Number.isNaN(l)||e==="")&&D(l),b(),d.userInput=null},O=()=>{var e,l;(l=(e=h.value)==null?void 0:e.focus)==null||l.call(e)},ce=()=>{var e,l;(l=(e=h.value)==null?void 0:e.blur)==null||l.call(e)},ae=e=>{_("focus",e)},o=e=>{var l;d.userInput=null,_("blur",e),a.validateEvent&&((l=I==null?void 0:I.validate)==null||l.call(I,"blur").catch(n=>ye()))},b=()=>{d.currentValue!==a.modelValue&&(d.currentValue=a.modelValue)},k=e=>{document.activeElement===e.target&&e.preventDefault()};return Y(()=>a.modelValue,(e,l)=>{const n=Q(e,!0);d.userInput===null&&n!==l&&(d.currentValue=n)},{immediate:!0}),Fe(()=>{var e;const{min:l,max:n,modelValue:p}=a,i=(e=h.value)==null?void 0:e.input;if(i.setAttribute("role","spinbutton"),Number.isFinite(n)?i.setAttribute("aria-valuemax",String(n)):i.removeAttribute("aria-valuemax"),Number.isFinite(l)?i.setAttribute("aria-valuemin",String(l)):i.removeAttribute("aria-valuemin"),i.setAttribute("aria-valuenow",d.currentValue||d.currentValue===0?String(d.currentValue):""),i.setAttribute("aria-disabled",String(z.value)),!F(p)&&p!=null){let w=Number(p);Number.isNaN(w)&&(w=null),_(J,w)}i.addEventListener("wheel",k,{passive:!1})}),Pe(()=>{var e,l;const n=(e=h.value)==null?void 0:e.input;n==null||n.setAttribute("aria-valuenow",`${(l=d.currentValue)!=null?l:""}`)}),nl({from:"label",replacement:"aria-label",version:"2.8.0",scope:"el-input-number",ref:"https://element-plus.org/en-US/component/input-number.html"},$(()=>!!a.label)),L({focus:O,blur:ce}),(e,l)=>(m(),V("div",{class:ie([s(v).b(),s(v).m(s(Z)),s(v).is("disabled",s(z)),s(v).is("without-controls",!e.controls),s(v).is("controls-right",s(C))]),onDragstart:l[0]||(l[0]=pe(()=>{},["prevent"]))},[e.controls?fe((m(),V("span",{key:0,role:"button","aria-label":s(N)("el.inputNumber.decrease"),class:ie([s(v).e("decrease"),s(v).is("disabled",s(ee))]),onKeydown:se(H,["enter"])},[_e(e.$slots,"decrease-icon",{},()=>[r(s(ge),null,{default:f(()=>[s(C)?(m(),B(s(Ae),{key:0})):(m(),B(s(Be),{key:1}))]),_:1})])],42,pl)),[[s(Ve),H]]):he("v-if",!0),e.controls?fe((m(),V("span",{key:1,role:"button","aria-label":s(N)("el.inputNumber.increase"),class:ie([s(v).e("increase"),s(v).is("disabled",s(P))]),onKeydown:se(G,["enter"])},[_e(e.$slots,"increase-icon",{},()=>[r(s(ge),null,{default:f(()=>[s(C)?(m(),B(s(Te),{key:0})):(m(),B(s(De),{key:1}))]),_:1})])],42,ml)),[[s(Ve),G]]):he("v-if",!0),r(s(we),{id:e.id,ref_key:"input",ref:h,type:"number",step:e.step,"model-value":s(M),placeholder:e.placeholder,readonly:e.readonly,disabled:s(z),size:s(Z),max:e.max,min:e.min,name:e.name,"aria-label":e.label||e.ariaLabel,"validate-event":!1,onKeydown:[se(pe(G,["prevent"]),["up"]),se(pe(H,["prevent"]),["down"])],onBlur:o,onFocus:ae,onInput:te,onChange:A},null,8,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],34))}});var fl=sl(bl,[["__file","input-number.vue"]]);const _l=Ue(fl),ve=u=>(qe("data-v-3ca0e1fc"),u=u(),Oe(),u),hl={class:"goods-reserve"},gl={class:"s-top_bar"},yl={class:"row"},Vl={class:"col col1"},Nl={class:"goods-type"},Il=["onClick"],wl={class:"col col2"},Cl={class:"goods-list"},El={class:"msg"},xl=["title"],Sl=["title"],kl=ve(()=>c("label",{for:""},"规格(尺寸)：",-1)),Fl=["title"],Pl=ve(()=>c("label",{for:""},"单  价：",-1)),zl={class:"p"},Al=ve(()=>c("label",{for:""},"库  存：",-1)),Bl={class:"col col3"},Tl={class:"table"},Dl={class:"bottom-bar"},Ul={class:"p1"},$l={class:"p2"},Ll=me({__name:"Reserve",setup(u){const L=Le(),_=Me(),a=y(_.query.exhibitionId?Number(_.query.exhibitionId):""),N=y(_.query.exhibitorId?Number(_.query.exhibitorId):""),v=y(_.query.hallCode||""),h=y(_.query.positionCode||""),d=_.query.clueId,I=y(0),ee=()=>{L.push({query:{exhibitorId:N.value,hallCode:v.value,positionCode:h.value}})},P=y([]),T=y({}),C=y([]),Z=y([]),z=y([]),M=y([]),q=y([]);Ne({});const W=(o,b=1)=>{ue.addCart({exhibitorId:N.value,exhibitionId:a.value,hallCode:v.value,positionCode:h.value,id:o.id,num:b}).then(k=>{k.code===0?(re.success("添加成功"),A()):re.error(k.msg)})},le=o=>{T.value=P.value[o]},G=()=>{Ye().then(o=>{o.code===0&&(Z.value=o.data)})},H=()=>{Je().then(o=>{o.code===0&&(z.value=o.data)})},Q=()=>{Qe({exhibitionId:a.value}).then(o=>{o.code===0&&(M.value=o.data)})},D=()=>{Xe({exhibitionId:a.value}).then(o=>{o.code===0&&(q.value=o.data)})},te=()=>{ue.getMaterial({exhibitionId:a.value}).then(o=>{o.code===0&&(P.value=o.data,P.value.length>0?T.value=P.value[0]:T.value={})})},A=()=>{if(console.log("getCart"),!a.value||!N.value||!v.value||!h.value){C.value=[];return}ue.getCart({exhibitorId:N.value,exhibitionId:a.value,hallCode:v.value,positionCode:h.value}).then(o=>{o.code===0&&(C.value=o.data)})},O=y(!1),ce=()=>{O.value=!0,ue.create({clueId:d,exhibitionId:a.value,exhibitorId:N.value,hallCode:v.value,positionCode:h.value,price:I.value,data:C.value.map(o=>({...o,remark:""}))}).then(o=>{o.code===0?(re.success("提交成功"),L.go(-1)):re.error(o.msg),O.value=!1}).catch(o=>{O.value=!1})};Y(()=>a.value,o=>{v.value="",h.value="",Q(),D(),te(),A()}),Y(()=>N.value,o=>{A()}),Y(()=>v.value,o=>{A()}),Y(()=>h.value,o=>{A()});const ae=$(()=>{let o=0;return C.value.forEach(b=>{o+=b.price*b.num}),I.value=o,o});return G(),H(),Q(),D(),te(),A(),(o,b)=>{const k=ll,e=el,l=tl,n=al,p=He,i=ol,w=je,E=Re,R=_l,g=Ke,be=$e("font"),Ce=we;return m(),V("div",hl,[c("div",gl,[r(n,{inline:!0},{default:f(()=>[r(l,{label:"展会名称",style:{width:"220px"}},{default:f(()=>[r(e,{modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=t=>a.value=t),placeholder:"请选择展会名称"},{default:f(()=>[(m(!0),V(K,null,j(Z.value,t=>(m(),B(k,{key:t.id,label:t.exhibitionName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"参展企业",style:{width:"220px"}},{default:f(()=>[r(e,{modelValue:N.value,"onUpdate:modelValue":b[1]||(b[1]=t=>N.value=t),placeholder:"请选择参展企业"},{default:f(()=>[(m(!0),V(K,null,j(z.value,t=>(m(),B(k,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"展馆",style:{width:"220px"}},{default:f(()=>[r(e,{modelValue:v.value,"onUpdate:modelValue":b[2]||(b[2]=t=>v.value=t),placeholder:"请选择展馆"},{default:f(()=>[(m(!0),V(K,null,j(M.value,t=>(m(),B(k,{key:t.code,label:t.code,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"展位号",style:{width:"220px"}},{default:f(()=>[r(e,{modelValue:h.value,"onUpdate:modelValue":b[3]||(b[3]=t=>h.value=t),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"添加展位号",style:{width:"240px"}},{default:f(()=>[(m(!0),V(K,null,j(q.value,t=>(m(),B(k,{key:t.positionCode,label:t.positionCode,value:t.positionCode},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),c("div",yl,[c("div",Vl,[c("ul",Nl,[(m(!0),V(K,null,j(P.value,(t,x)=>(m(),V("li",{key:x,onClick:oe=>le(x),class:ie({active:t.project===T.value.project})},U(t.project),11,Il))),128))])]),c("div",wl,[r(w,null,{default:f(()=>[c("div",Cl,[(m(!0),V(K,null,j(T.value.data,(t,x)=>(m(),V("li",{key:x},[r(p,{style:{width:"100%",height:"200px"},src:t.img,"preview-src-list":[t.img],fit:"contain"},null,8,["src","preview-src-list"]),c("div",El,[c("p",{class:"title",title:t.position},U(t.position),9,xl),c("p",{class:"p",title:t.size},[kl,S(U(t.size),1)],8,Sl),c("p",{class:"p",title:t.price+"元/"+t.unit},[Pl,c("span",null,U(t.price+"元/"+t.unit),1)],8,Fl),c("p",zl,[Al,S(U(t.num),1)])]),r(i,{type:"primary",onClick:oe=>W(t),disabled:t.num<=0,style:{width:"100%"}},{default:f(()=>[S("加入购物车")]),_:2},1032,["onClick","disabled"])]))),128))])]),_:1})]),c("div",Bl,[c("div",Tl,[r(g,{data:C.value,border:""},{default:f(()=>[r(E,{label:"服务项目",prop:"project"}),r(E,{label:"位置/版面",prop:"position"}),r(E,{label:"规格",prop:"size"}),r(E,{label:"单价(RMB)",prop:"price"}),r(E,{label:"数量",width:"200px"},{default:f(t=>[r(R,{modelValue:t.row.num,"onUpdate:modelValue":x=>t.row.num=x,min:1,size:"small",onChange:(x,oe)=>{console.log(x,oe),W(t.row,x-oe)}},null,8,["modelValue","onUpdate:modelValue","onChange"]),r(i,{type:"danger",link:"",onClick:x=>ee({positionCode:t.row.positionCode}),style:{"margin-left":"10px"},icon:"Delete"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),c("div",Dl,[c("div",Ul,[c("span",null,[S("已选物料 "),r(be,null,{default:f(()=>[S(U(C.value.length),1)]),_:1}),S(" 项")]),S(),c("span",null,[S("物料金额 "),r(be,null,{default:f(()=>[S("¥"+U(ae.value),1)]),_:1})])]),c("div",$l,[r(l,{label:"最终金额",style:{width:"100%","margin-bottom":"0"}},{default:f(()=>[r(Ce,{modelValue:I.value,"onUpdate:modelValue":b[4]||(b[4]=t=>I.value=t)},null,8,["modelValue"])]),_:1})]),r(i,{type:"primary",style:{width:"100%"},onClick:ce,loading:O.value,disabled:ae.value<=0},{default:f(()=>[S("提交")]),_:1},8,["loading","disabled"])])])])])}}}),ht=il(Ll,[["__scopeId","data-v-3ca0e1fc"]]);export{ht as default};
