import{d as se,l as m,s as W,c as Y,t as Z,N as K,o as s,b as _,O as c,Q as F,R as o,i as l,P as f,F as h,V as g,Y as ce,a6 as pe,h as P,W as me,Z as fe,_ as _e}from"./index-BCumuH2l.js";import{E as ve}from"./el-dialog-Cr31W0vf.js";/* empty css                   */import{E as he}from"./el-col-2WUFzs03.js";import{E as be}from"./el-scrollbar-DYhKSyot.js";/* empty css                     *//* empty css                 *//* empty css                  */import"./el-tag-BkIRG4gH.js";import{E as ge,a as Pe}from"./el-select-Dn8g1hD5.js";import"./el-popper-DuA7pbMX.js";/* empty css                 */import{E as Ve}from"./el-image-viewer-CHpRcp5m.js";import{a as ye}from"./index-t0RjoPPn.js";import{g as Ce}from"./index-ru7l1VIz.js";import{E as we,a as Ee}from"./index-KsNwzYtN.js";import{E as Ne,a as ke}from"./index-C93lHvfN.js";import{E as xe}from"./index-CGEPfdHm.js";import{E as Ue}from"./index-x58V2ps9.js";import{E as Fe}from"./index-BNMC9-9K.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BBCR1adM.js";import"./use-form-item-DPxtBdX-.js";import"./scroll-DEYraRnD.js";import"./vnode-DjHHQFRY.js";import"./refs-DC4vuWkM.js";import"./event-BB_Ol6Sd.js";import"./_Uint8Array-CjJrf9_z.js";import"./isEqual-Du7s0shl.js";import"./request--qZdk5mN.js";import"./castArray--BTnThqL.js";import"./_baseClone-7GzUapHy.js";import"./_initCloneObject-B8PdS-lA.js";const Se=N=>(fe("data-v-a85f42be"),N=N(),_e(),N),Be={class:"booth-reserve"},Oe={class:"l"},Re={class:"title"},qe={class:"img-box"},Je={class:"r"},De={class:"form-box"},$e=Se(()=>c("div",null,"预定展位",-1)),Te={style:{"text-align":"center"}},ze={style:{padding:"15px"}},Ge={class:"dialog-footer"},je=se({__name:"Reserve",setup(N){const M=ce(),w=pe(),q=w.query.clueId,I=w.query.exhibitionId,X=w.query.exhibitorId,b=m(w.query.hallCode),S=m([]),k=m([]),J=m([]),D=m([]),$=m([]),T=m([]),z={1:"%",2:"￥"},a=W({clueId:q,exhibitionId:I,exhibitorId:X,add:[],discount:[],position:[{hallCode:b.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0}]});m({});const t=W({show:!1,index:0,form:{product:"",unitPrice:"",num:1,length:"",width:""}}),ee=d=>{t.form.unitPrice=Number(d.price),t.form.product=d.text,t.form.num=d.num},oe=Y(()=>t.form.unitPrice?t.form.unitPrice+"元/"+(t.form.num===1?"":t.form.num)+"㎡":""),le=()=>{let d=a.position.length;B(b.value,d),a.position.push({hallCode:b.value,positionCode:"",companyBrand:[],product:"",unitPrice:"",type:1,length:0,width:0,costPrice:0,addPrice:0,discountPrice:0,finalPrice:0,deposit:0,isOffset:1,payType:1,ratio:0})},B=(d,e)=>{k.value[e]=[],Ce({exhibitionId:I,hallCode:d}).then(p=>{k.value[e]=p.data})};B(b.value,0);const te=()=>{M.push({name:"BoothCreateOrder",query:{...w.query,companyName:x.value,data:JSON.stringify(a)}})},ae=d=>{t.show=!0,t.index=d,t.form.product="",t.form.unitPrice="",t.form.length="",t.form.width="",t.form.num=1},ie=()=>{t.show=!1;let d=t.form.length*t.form.width,e=d*t.form.unitPrice/t.form.num,p=G(e),n=j(e);a.position[t.index].product=t.form.product,a.position[t.index].unitPrice=t.form.unitPrice,a.position[t.index].length=t.form.length,a.position[t.index].width=t.form.width,a.position[t.index].area=d,a.position[t.index].costPrice=Number(e.toFixed(2)),a.position[t.index].addPrice=Number(p.toFixed(2)),a.position[t.index].discountPrice=Number(n.toFixed(2)),a.position[t.index].finalPrice=Number((e+p-n).toFixed(2))},G=d=>{let e=0;return a.add.forEach(p=>{let n=JSON.parse(p);n.unit===1?e+=d*n.price/100:n.unit===2&&(e+=n.price)}),e},j=d=>{let e=0;return a.discount.forEach(p=>{let n=JSON.parse(p);n.unit===1?e+=d*n.price/100:n.unit===2&&(e+=n.price)}),e};Z(()=>a.add,d=>{a.position.forEach(e=>{e.addPrice=Number(G(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})}),Z(()=>a.discount,d=>{a.position.forEach(e=>{e.discountPrice=Number(j(e.costPrice).toFixed(2)),e.finalPrice=Number((e.costPrice+e.addPrice-e.discountPrice).toFixed(2))})});const x=m(""),O=m(!0);ye({clueId:q,exhibitionId:I}).then(d=>{let e=d.data;J.value=e.attachPrice.add,D.value=e.attachPrice.discount,$.value=e.companyBrand,T.value=e.unitPrice,S.value=e.exhibitionHall,x.value=e.companyName,O.value=e.isNew});const A=Y(()=>{let d=S.value.find(e=>e.code===b.value);return d?d.img:""});return(d,e)=>{const p=Ve,n=we,U=Ne,H=ke,V=Pe,y=ge,C=xe,v=Ue,ne=K("DeleteFilled"),L=Fe,Q=Ee,ue=be,R=he,de=K("Close"),re=ve;return s(),_(h,null,[c("div",Be,[c("div",Oe,[c("div",Re,[c("span",null,F(x.value),1),c("span",null,"展馆号："+F(b.value),1)]),c("div",qe,[o(p,{style:{width:"100%",height:"100%"},src:A.value,"preview-src-list":[A.value],fit:"scale-down",alt:"展馆图片"},null,8,["src","preview-src-list"])])]),c("div",Je,[c("div",De,[o(ue,{height:"100%"},{default:l(()=>[o(Q,{model:a,"label-width":"auto",class:"form"},{default:l(()=>[$e,o(n,{label:"企业名称"},{default:l(()=>[f(F(x.value),1)]),_:1}),o(n,{label:"新展商"},{default:l(()=>[o(H,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=i=>O.value=i),disabled:""},{default:l(()=>[o(U,{value:!0},{default:l(()=>[f("是")]),_:1}),o(U,{value:!1},{default:l(()=>[f("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"加收"},{default:l(()=>[o(y,{modelValue:a.add,"onUpdate:modelValue":e[1]||(e[1]=i=>a.add=i),multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(h,null,g(J.value,(i,u)=>(s(),P(V,{key:u,label:i.text+" "+i.price+z[i.unit],value:JSON.stringify(i)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"折扣"},{default:l(()=>[o(y,{modelValue:a.discount,"onUpdate:modelValue":e[2]||(e[2]=i=>a.discount=i),multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(h,null,g(D.value,(i,u)=>(s(),P(V,{key:u,label:i.text+" "+i.price+z[i.unit],value:JSON.stringify(i)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:""},{default:l(()=>[o(C,{icon:"Plus",onClick:le},{default:l(()=>[f("添加展位")]),_:1})]),_:1}),(s(!0),_(h,null,g(a.position,(i,u)=>(s(),_("div",{class:"item",key:u},[o(n,{label:"展馆号"},{default:l(()=>[o(y,{modelValue:a.position[u].hallCode,"onUpdate:modelValue":r=>a.position[u].hallCode=r,placeholder:"请选择",onChange:r=>{B(i.hallCode,u),b.value=i.hallCode}},{default:l(()=>[(s(!0),_(h,null,g(S.value,(r,E)=>(s(),P(V,{key:E,label:r.code,value:r.code},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),o(n,{label:"展位号"},{default:l(()=>[o(y,{modelValue:a.position[u].positionCode,"onUpdate:modelValue":r=>a.position[u].positionCode=r,filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择"},{default:l(()=>[(s(!0),_(h,null,g(k.value[u],(r,E)=>(s(),P(V,{key:E,label:r,value:r},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(n,{label:"品牌"},{default:l(()=>[o(y,{modelValue:a.position[u].companyBrand,"onUpdate:modelValue":r=>a.position[u].companyBrand=r,multiple:"",placeholder:"请选择"},{default:l(()=>[(s(!0),_(h,null,g($.value,(r,E)=>(s(),P(V,{key:E,label:r,value:r},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(n,{label:"展位类型"},{default:l(()=>[o(H,{modelValue:a.position[u].type,"onUpdate:modelValue":r=>a.position[u].type=r},{default:l(()=>[o(U,{value:1},{default:l(()=>[f("标准")]),_:1}),o(U,{value:2},{default:l(()=>[f("特装")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(n,{label:"展位规格"},{default:l(()=>[o(C,{size:"small",onClick:r=>ae(u)},{default:l(()=>[f("添加")]),_:2},1032,["onClick"])]),_:2},1024),a.position[u].product?(s(),P(n,{key:0,label:" "},{default:l(()=>[c("div",null,F(a.position[u].product+" "+a.position[u].area+"㎡"),1)]),_:2},1024)):me("",!0),o(n,{label:"展位原价"},{default:l(()=>[o(v,{modelValue:a.position[u].costPrice,"onUpdate:modelValue":r=>a.position[u].costPrice=r,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(n,{label:"加收金额"},{default:l(()=>[o(v,{"model-value":a.position[u].addPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(n,{label:"折扣金额"},{default:l(()=>[o(v,{"model-value":a.position[u].discountPrice,disabled:""},null,8,["model-value"])]),_:2},1024),o(n,{label:"最终金额"},{default:l(()=>[o(v,{modelValue:a.position[u].finalPrice,"onUpdate:modelValue":r=>a.position[u].finalPrice=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),c("div",Te,[o(C,{link:"",type:"danger",onClick:r=>{a.position.splice(u,1),k.value.splice(u,1)}},{default:l(()=>[o(L,null,{default:l(()=>[o(ne)]),_:1})]),_:2},1032,["onClick"])])]))),128))]),_:1},8,["model"])]),_:1})]),c("div",ze,[o(C,{type:"primary",onClick:te,style:{width:"100%"}},{default:l(()=>[f("确认")]),_:1})])])]),o(re,{modelValue:t.show,"onUpdate:modelValue":e[7]||(e[7]=i=>t.show=i),title:"添加规格",width:"500",draggable:""},{footer:l(()=>[c("div",Ge,[o(C,{onClick:e[6]||(e[6]=i=>t.show=!1)},{default:l(()=>[f("取消")]),_:1}),o(C,{type:"primary",onClick:ie},{default:l(()=>[f("确定")]),_:1})])]),default:l(()=>[o(Q,{ref:"ggFormRef",model:t.form,"label-width":"auto"},{default:l(()=>[o(n,{label:"产品名称",prop:"product"},{default:l(()=>[o(y,{modelValue:t.form.product,"onUpdate:modelValue":e[3]||(e[3]=i=>t.form.product=i),placeholder:"",onChange:ee},{default:l(()=>[(s(!0),_(h,null,g(T.value,i=>(s(),P(V,{key:i.id,label:i.text+" "+i.price+"/"+i.num+"/㎡",value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"单价",prop:"unitPrice"},{default:l(()=>[o(v,{"model-value":oe.value,disabled:""},null,8,["model-value"])]),_:1}),o(n,{label:"尺寸"},{default:l(()=>[o(R,{span:11},{default:l(()=>[o(v,{modelValue:t.form.length,"onUpdate:modelValue":e[4]||(e[4]=i=>t.form.length=i),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(R,{span:2,style:{display:"flex","align-items":"center","justify-content":"center","font-size":"20px"}},{default:l(()=>[o(L,null,{default:l(()=>[o(de)]),_:1})]),_:1}),o(R,{span:11},{default:l(()=>[o(v,{modelValue:t.form.width,"onUpdate:modelValue":e[5]||(e[5]=i=>t.form.width=i),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),o(n,{label:"面积"},{default:l(()=>[o(v,{"model-value":Number((t.form.length*t.form.width).toFixed(2)),autocomplete:"off",disabled:""},null,8,["model-value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),wo=Ie(je,[["__scopeId","data-v-a85f42be"]]);export{wo as default};
